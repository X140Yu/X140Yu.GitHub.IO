<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>X140Yu&#39;s Blog</title>
  <icon>https://www.gravatar.com/avatar/ceda53888b8ef623959d14c61af2d1c0</icon>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://x140yu.github.io/"/>
  <updated>2019-09-18T09:34:34.488Z</updated>
  <id>https://x140yu.github.io/</id>
  
  <author>
    <name>X140Yu</name>
    <email>zhaoxinyu1994@gmail.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ä½¿ç”¨ VSCode debug CocoaPods å’Œæ’ä»¶æºç </title>
    <link href="https://x140yu.github.io/2019-08-19-debug-cocoapods/"/>
    <id>https://x140yu.github.io/2019-08-19-debug-cocoapods/</id>
    <published>2019-08-18T16:00:00.000Z</published>
    <updated>2019-09-18T09:34:34.488Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>2019-09-18 æ›´æ–°ï¼šGitHub ä¸­å·²æ·»åŠ äº†ä½¿ç”¨ bundler è¾…åŠ© debug çš„æ–¹å¼ï¼Œå·²ä¸éœ€è¦ä¸‹é¢è¿™äº› dirty hackï¼Œæ‰€ä»¥æœ¬æ–‡å·²æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰ ğŸ˜³</p></blockquote><blockquote><p>å…·ä½“æ­¥éª¤å¯ä»¥çœ‹è¿™ä¸ª <a href="https://github.com/X140Yu/debug_cocoapods_plugins_in_vscode" target="_blank" rel="noopener">GitHub ä»“åº“</a></p></blockquote><p>å‰ä¸€æ®µæ—¶é—´åŒäº‹ä»‹ç»äº†å¯ä»¥ç”¨ <a href="https://www.jetbrains.com/ruby/" target="_blank" rel="noopener">RubyMine</a> è°ƒè¯• CocoaPods æºç çš„æ–¹æ³•ï¼Œçœ‹åæ„Ÿè§‰å¾ˆç¥å¥‡ã€‚å› ä¸ºä¹‹å‰è¯» CocoaPods æºç ä¸çŸ¥é“å¦‚ä½•è°ƒè¯• Ruby ç¨‹åºï¼Œéƒ½æ˜¯ç”¨æ¯”è¾ƒåŸå§‹çš„æ‰“ log æ–¹å¼ï¼Œå…¶å®æŒºä½æ•ˆçš„ï¼Œæ¯•ç«Ÿ log + æ–­ç‚¹ç»“åˆèµ·æ¥æ‰æ˜¯å¼€å‘ debug çš„æœ€å¥½æ–¹å¼ã€‚</p><p>ä½†æ¯”èµ· JetBrains å®¶çš„ IDEï¼Œæˆ‘æ›´å–œæ¬¢ç”¨ VSCodeï¼Œæ‰€ä»¥å°±ç ”ç©¶äº†ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨å®ƒæ¥ debug CocoaPods æºç åŠ CocoaPods å‘¨è¾¹æ’ä»¶ã€‚</p><p>ç ”ç©¶è¿‡ç¨‹ä¸­æœ‰å‡ ä¸ªç‚¹è¿˜æ˜¯æŒºæœ‰è¶£çš„ï¼Œæ‰€ä»¥å†™å‡ºæ¥åˆ†äº«ä¸€ä¸‹ã€‚</p><h3 id="å¦‚ä½•åŠ è½½æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šè·¯å¾„çš„-pod-æ’ä»¶ï¼Ÿ"><a href="#å¦‚ä½•åŠ è½½æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šè·¯å¾„çš„-pod-æ’ä»¶ï¼Ÿ" class="headerlink" title="å¦‚ä½•åŠ è½½æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šè·¯å¾„çš„ pod æ’ä»¶ï¼Ÿ"></a>å¦‚ä½•åŠ è½½æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šè·¯å¾„çš„ pod æ’ä»¶ï¼Ÿ</h3><p>è¿™å°±è¦å…ˆä» pod æ’ä»¶çš„åŠ è½½è¿‡ç¨‹è¯´èµ·ã€‚</p><p>CocoaPods çš„æ’ä»¶åŠ è½½æ˜¯ä¾æ‰˜äº CLAide çš„ï¼Œå…·ä½“çš„æŸ¥çœ‹æ–¹æ³•å¯ä»¥çœ‹<a href="https://github.com/CocoaPods/CLAide/blob/b5ced9cc141df732e8027078543eb92fc6447567/lib/claide/command/plugin_manager.rb#L72" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚CLAide ä¸­çš„ <code>PluginManager</code> ä¼šéå†æ‰€æœ‰çš„ Ruby Gemï¼Œå¹¶æœç´¢è¿™äº› gem ä¸­æ˜¯å¦åŒ…å«åä¸º <code>#{plugin_prefix}_plugin</code> çš„æ–‡ä»¶ã€‚</p><p><code>Pod::Command</code> ç»§æ‰¿äº† <code>CLAide::Command</code>ï¼Œå¹¶å£°æ˜ <code>plugin_prefix</code> ä¸º <code>%w(claide cocoapods)</code> ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´åœ¨ pod å‘½ä»¤æ‰§è¡Œæ—¶ï¼Œ<strong>ä¼šåŠ è½½æ‰€æœ‰åŒ…å« <code>claide_plugin.rb</code> æˆ– <code>cocoapods_plugin.rb</code> æ–‡ä»¶çš„ gem</strong>ã€‚</p><p>å¦‚æœæ’ä»¶æ˜¯é€šè¿‡è¿™ç§æ–¹å¼åŠ è½½çš„è¯ï¼Œé‚£ debug æ’ä»¶å°±æ¯”è¾ƒå›°éš¾äº†ï¼Œåªèƒ½æŠŠæ’ä»¶é€šè¿‡ <code>rake install</code> çš„æ–¹å¼å®‰è£…åœ¨ç”µè„‘ç³»ç»Ÿä¸­ï¼Œæ‰èƒ½éªŒè¯æ’ä»¶åŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼Œæ˜¯æ¯”è¾ƒä½æ•ˆçš„ã€‚è¿™ä¹Ÿæ˜¯æœ¬æ–‡å‡ºç°çš„åŸå› ã€‚</p><p>è¦æƒ³å®ç°åŠ è½½æŒ‡å®šè·¯å¾„çš„ Gem ä¸º CocoaPods æ’ä»¶ï¼Œå°±éœ€è¦æ‰‹åŠ¨å¹²é¢„è¿™ä¸€è¿‡ç¨‹ã€‚è¿™ä¸€éƒ¨åˆ†çš„ä»£ç åœ¨<a href="https://github.com/X140Yu/debug_cocoapods_plugins_in_vscode/blob/master/.vscode/plugin_patch.rb" target="_blank" rel="noopener">è¿™é‡Œ</a>å¯ä»¥æ‰¾åˆ°ï¼ˆä¹Ÿæ˜¯æœ¬ä»“åº“å”¯ä¸€çš„ä¸€ç‚¹ä»£ç ï¼‰ï¼Œä¸»è¦è¿‡ç¨‹æ˜¯ patch äº† <code>Gem::Specification</code> çš„ <code>latest_specs</code> æ–¹æ³•ï¼Œè¦†ç›–æˆ–è¿½åŠ ä¸€ä¸ªæˆ‘ä»¬æŒ‡å®šè·¯å¾„çš„ gem åˆ°åŠ è½½çš„åˆ—è¡¨ä¸­ã€‚</p><p>å¦‚æœå¯¹ Ruby æ˜¯å¦‚ä½•æŸ¥æ‰¾æ‰€æœ‰ gems çš„è¿‡ç¨‹æ„Ÿåˆ°å¥½å¥‡çš„ï¼Œå¯ä»¥çœ‹<a href="https://github.com/rubygems/rubygems/blob/master/lib/rubygems/specification.rb#L744" target="_blank" rel="noopener">è¿™é‡Œ</a>ï¼Œæœ¬æ–‡ä¸ä½œè¿‡å¤šä»‹ç»ã€‚</p><h3 id="è¦†å†™ä¸€ä¸ªå®ä¾‹çš„çš„æ–¹æ³•"><a href="#è¦†å†™ä¸€ä¸ªå®ä¾‹çš„çš„æ–¹æ³•" class="headerlink" title="è¦†å†™ä¸€ä¸ªå®ä¾‹çš„çš„æ–¹æ³•"></a>è¦†å†™ä¸€ä¸ªå®ä¾‹çš„çš„æ–¹æ³•</h3><p>åœ¨çŸ­çŸ­å‡ åè¡Œä»£ç ä¸­ï¼Œè¿˜ monkey patch äº†ä¸€ä¸ªå®ä¾‹çš„æ–¹æ³•ï¼Œ</p><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xxxobject</span>.<span class="title">xxx_method</span></span></span><br><span class="line">puts <span class="string">"replaced"</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>ä½†å¦‚æœæƒ³è¦åœ¨è¿™ä¸ªæ–¹æ³•ä½¿ç”¨ä¸Šä¸‹æ–‡ä¸­çš„å˜é‡æ˜¯ä¸è¡Œçš„ï¼Œæ¯”å¦‚è¿™æ ·ï¼Œ</p><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">some_variable = <span class="string">'a'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xxxObject</span>.<span class="title">xxx_method</span></span></span><br><span class="line">puts some_variable <span class="comment"># NameError - undefined local variable or method `some_variable' for #&lt;XX::XXClass:0x00007f99112754c8&gt;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>é“ç†ä¹Ÿå¾ˆç®€å•ï¼Œ<code>some_variable</code> å¹¶ä¸åœ¨ <code>xxxObject</code> æ–¹æ³•ä¸­çš„ä½œç”¨åŸŸå†…ã€‚è¿™é‡Œé€šè¿‡æŠŠ <code>some_variable</code> å£°æ˜æˆäº†å…¨å±€å˜é‡ç¼“è§£äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†è¿™å¹¶ä¸æ˜¯å¾ˆå¥½çš„è§£å†³æ–¹å¼ï¼Œå¸Œæœ›æœ‰æ›´å¥½è§£å†³æ–¹å¼çš„æœ‹å‹æå‡ºè§è§£ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;2019-09-18 æ›´æ–°ï¼šGitHub ä¸­å·²æ·»åŠ äº†ä½¿ç”¨ bundler è¾…åŠ© debug çš„æ–¹å¼ï¼Œå·²ä¸éœ€è¦ä¸‹é¢è¿™äº› dirty hackï¼Œæ‰€ä»¥æœ¬æ–‡å·²æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰ ğŸ˜³&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;å…·ä½“æ­¥éª¤
      
    
    </summary>
    
    
      <category term="Ruby" scheme="https://x140yu.github.io/tags/Ruby/"/>
    
  </entry>
  
  <entry>
    <title>Any &amp; AnyObject in Swift</title>
    <link href="https://x140yu.github.io/2019-01-26-any-anyobject-in-swift/"/>
    <id>https://x140yu.github.io/2019-01-26-any-anyobject-in-swift/</id>
    <published>2019-01-25T16:00:00.000Z</published>
    <updated>2019-08-19T07:43:25.677Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™æ˜¯æˆ‘ 1 æœˆ 22 æ—¥åœ¨çŸ¥ä¹ iOS å›¢é˜Ÿå†…éƒ¨çš„ä¸€æ¬¡åˆ†äº«</p><p>è¿™ä¸€æ¬¡æ²¡æœ‰ä½¿ç”¨ Keynoteï¼Œå°è¯•æ€§åœ°å…¨ç¨‹ä½¿ç”¨ Playgroundï¼Œæ•ˆæœè¿˜ä¸é”™</p><p>Playground ç‰ˆæœ¬å¯ä»¥æŸ¥çœ‹<a href="https://github.com/X140Yu/Any-AnyObject-in-Swift" target="_blank" rel="noopener">è¿™é‡Œ</a></p></blockquote><a id="more"></a><h2 id="Any"><a href="#Any" class="headerlink" title="Any"></a>Any</h2><p>ä»€ä¹ˆæ˜¯ Any? ğŸ¤”</p><blockquote><p><code>Any</code> can represent an <strong>instance</strong> of any type at all, including function types. <a href="https://docs.swift.org/swift-book/LanguageGuide/TypeCasting.html" target="_blank" rel="noopener">doc</a><br> <code>Any</code> å¯ä»¥ä»£è¡¨ä¸€ä¸ªä»»æ„ç±»å‹çš„å®ä¾‹ï¼ŒåŒ…æ‹¬å‡½æ•°ç±»å‹ã€‚</p></blockquote><h3 id="Types-to-Any"><a href="#Types-to-Any" class="headerlink" title="Types to Any"></a>Types to Any</h3><p>æ‰€æœ‰èƒ½å¤Ÿçœ‹åˆ°çš„ç±»å‹éƒ½èƒ½è¢«è½¬æ¢æˆ Any</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> any: <span class="type">Any</span> = <span class="string">"Any"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// static type is Any, dynamic type is Int</span></span><br><span class="line">any = <span class="number">42</span></span><br><span class="line"></span><br><span class="line">type(of: any)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// static type is Any, dynamic type is String</span></span><br><span class="line">any = <span class="string">"string"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// static type is Any, dynamic type is (Int, String)</span></span><br><span class="line">any = (<span class="number">42</span>, <span class="string">"42"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// static type is Any, dynamic type is [Int]</span></span><br><span class="line">any = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// static type is Any, dynamic type is [Int: Int]</span></span><br><span class="line">any = [<span class="number">1</span>: <span class="number">2</span>]</span><br></pre></td></tr></table></figure><h4 id="Closures-can-be-Any"><a href="#Closures-can-be-Any" class="headerlink" title="Closures can be Any"></a>Closures can be <code>Any</code></h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">any = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... actually is</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="built_in">c</span>: () -&gt; () = &#123;&#125;</span><br></pre></td></tr></table></figure><h5 id="Functions-are-just-named-closures-so-it-can-be-Any"><a href="#Functions-are-just-named-closures-so-it-can-be-Any" class="headerlink" title="Functions are just named closures, so it can be Any"></a>Functions are just named closures, so it can be <code>Any</code></h5><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">function</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">any = function</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... actually is</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> f: () -&gt; () = function</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> fs: () -&gt; () = function.<span class="keyword">self</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸Šé¢ç”¨ self å’Œä¸ç”¨ self æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼ŸğŸ¤”</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1</span>.<span class="keyword">self</span></span><br></pre></td></tr></table></figure><h4 id="Enums-can-be-Any"><a href="#Enums-can-be-Any" class="headerlink" title="Enums can be Any"></a>Enums can be <code>Any</code></h4><blockquote><p>ğŸ’¡ Optionals are enums</p></blockquote> <figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">any = <span class="type">Optional</span>&lt;<span class="type">Int</span>&gt;(<span class="number">1</span>) <span class="keyword">as</span> <span class="type">Any</span></span><br><span class="line"><span class="comment">// ... actually is</span></span><br><span class="line"><span class="keyword">let</span> o: <span class="type">Optional</span>&lt;<span class="type">Int</span>&gt; = <span class="type">Optional</span>&lt;<span class="type">Int</span>&gt;(<span class="number">1</span>)</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">let</span> o1: <span class="type">Int?</span> = <span class="type">Optional</span>&lt;<span class="type">Int</span>&gt;(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">any = <span class="type">Optional</span>&lt;<span class="type">Int</span>&gt;.<span class="keyword">self</span></span><br><span class="line"><span class="comment">// ... actually is</span></span><br><span class="line"><span class="keyword">let</span> o2: <span class="type">Optional</span>&lt;<span class="type">Int</span>&gt;.<span class="type">Type</span> = <span class="type">Optional</span>&lt;<span class="type">Int</span>&gt;.<span class="keyword">self</span></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">let</span> o3: <span class="type">Int?</span>.<span class="type">Type</span> = <span class="type">Optional</span>&lt;<span class="type">Int</span>&gt;.<span class="keyword">self</span></span><br></pre></td></tr></table></figure><h4 id="Structs-and-classes-can-be-Any"><a href="#Structs-and-classes-can-be-Any" class="headerlink" title="Structs and classes can be Any"></a>Structs and classes can be <code>Any</code></h4><blockquote><p>ğŸ’¡ String is a struct</p></blockquote><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">any = <span class="string">"abc"</span></span><br><span class="line"></span><br><span class="line">any = <span class="type">String</span>.<span class="keyword">self</span></span><br><span class="line"><span class="comment">// ... actually is</span></span><br><span class="line"><span class="keyword">let</span> s: <span class="type">String</span>.<span class="type">Type</span> = <span class="type">String</span>.<span class="keyword">self</span></span><br></pre></td></tr></table></figure><blockquote><p>ğŸ’¡ KeyPath is a class</p></blockquote><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">any = \<span class="type">String</span>.<span class="built_in">count</span> <span class="keyword">as</span> <span class="type">Any</span></span><br><span class="line">any = <span class="type">KeyPath</span>&lt;<span class="type">String</span>, <span class="type">Int</span>&gt;.<span class="keyword">self</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> k2: <span class="type">KeyPath</span>&lt;<span class="type">String</span>, <span class="type">Int</span>&gt;.<span class="type">Type</span> = <span class="type">KeyPath</span>&lt;<span class="type">String</span>, <span class="type">Int</span>&gt;.<span class="keyword">self</span></span><br><span class="line"><span class="comment">// ... can be</span></span><br><span class="line"><span class="keyword">let</span> k1: <span class="type">AnyObject</span>.<span class="type">Type</span> = <span class="type">KeyPath</span>&lt;<span class="type">String</span>, <span class="type">Int</span>&gt;.<span class="keyword">self</span></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">let</span> k: <span class="type">AnyClass</span> = <span class="type">KeyPath</span>&lt;<span class="type">String</span>, <span class="type">Int</span>&gt;.<span class="keyword">self</span></span><br></pre></td></tr></table></figure><h4 id="Protocols-can-be-Any"><a href="#Protocols-can-be-Any" class="headerlink" title="Protocols can be Any"></a>Protocols can be <code>Any</code></h4><blockquote><p>ğŸ’¡ Error is a protocol</p></blockquote><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">any = <span class="type">Error</span>.<span class="keyword">self</span></span><br><span class="line"><span class="comment">// protocol is not like other types (sturct, class ...)</span></span><br><span class="line"><span class="comment">// so this is not correct</span></span><br><span class="line"><span class="comment">//let e1: Error.Type = Error.self</span></span><br><span class="line"><span class="comment">// ... actually is</span></span><br><span class="line"><span class="keyword">let</span> e: <span class="type">Error</span>.<span class="type">Protocol</span> = <span class="type">Error</span>.<span class="keyword">self</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// this is correct</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TestError</span>: <span class="title">Error</span> </span>&#123;&#125;</span><br><span class="line"><span class="keyword">let</span> e2: <span class="type">Error</span>.<span class="type">Type</span> = <span class="type">TestError</span>.<span class="keyword">self</span></span><br></pre></td></tr></table></figure><p><code>Any</code> means anything</p><p>æ‰€ä»¥å®ƒä¹Ÿèƒ½ä»£è¡¨å®ƒè‡ªå·± ğŸ˜</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">any = <span class="type">Any</span>.<span class="keyword">self</span></span><br><span class="line"><span class="comment">// ... actually is</span></span><br><span class="line"><span class="keyword">let</span> ap: <span class="type">Any</span>.<span class="type">Protocol</span> = <span class="type">Any</span>.<span class="keyword">self</span></span><br></pre></td></tr></table></figure><h4 id="æ— å¥–ç«çŒœï¼ŒNever-å’Œ-Void-åˆ†åˆ«æ˜¯ä»€ä¹ˆç±»å‹ï¼Ÿ-ğŸ¤”"><a href="#æ— å¥–ç«çŒœï¼ŒNever-å’Œ-Void-åˆ†åˆ«æ˜¯ä»€ä¹ˆç±»å‹ï¼Ÿ-ğŸ¤”" class="headerlink" title="æ— å¥–ç«çŒœï¼ŒNever å’Œ Void åˆ†åˆ«æ˜¯ä»€ä¹ˆç±»å‹ï¼Ÿ ğŸ¤”"></a>æ— å¥–ç«çŒœï¼Œ<code>Never</code> å’Œ <code>Void</code> åˆ†åˆ«æ˜¯ä»€ä¹ˆç±»å‹ï¼Ÿ ğŸ¤”</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">any = <span class="type">Never</span>.<span class="keyword">self</span></span><br><span class="line">any = <span class="type">Void</span>.<span class="keyword">self</span></span><br><span class="line">any = <span class="type">AnyObject</span>.<span class="keyword">self</span></span><br></pre></td></tr></table></figure><p>Never æ˜¯ä¸ª empty case enumï¼ŒVoid æ˜¯ () empty tuple</p><h4 id="Any-To-Types"><a href="#Any-To-Types" class="headerlink" title="Any To Types"></a>Any To Types</h4><p>ä¸Šé¢ä»‹ç»äº†ä»ä»»æ„ç±»å‹è½¬æ¢æˆ <code>Any</code>ï¼Œé‚£ä¹ˆå¦‚ä½•æŠŠ <code>Any</code> è½¬æ¢æˆæƒ³è¦çš„ç±»å‹å‘¢ï¼Ÿ(Downcast)</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> thing: <span class="type">Any</span> = <span class="number">42</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// if let</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> integer = thing <span class="keyword">as</span>? <span class="type">Int</span> &#123;</span><br><span class="line">    integer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... or simplerï¼Œä½†å¹¶ä¸æ¨è</span></span><br><span class="line">thing <span class="keyword">as</span>! <span class="type">Int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// or use switch</span></span><br><span class="line"><span class="keyword">let</span> things: [<span class="type">Any</span>] = [</span><br><span class="line">  <span class="number">0</span>,</span><br><span class="line">    <span class="number">0.0</span>,</span><br><span class="line">    <span class="string">"hello"</span>,</span><br><span class="line">    <span class="number">42</span>,</span><br><span class="line">    (<span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="type">Optional</span>&lt;<span class="type">Int</span>&gt;.<span class="keyword">self</span>,</span><br><span class="line">    &#123; (name: <span class="type">String</span>) -&gt; <span class="type">String</span> <span class="keyword">in</span> <span class="string">"Hello, (name)"</span> &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> thing <span class="keyword">in</span> things &#123;</span><br><span class="line">  <span class="keyword">switch</span> thing &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span> <span class="keyword">as</span> <span class="type">Int</span>:</span><br><span class="line">        <span class="string">"zero as an Int"</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span> <span class="keyword">as</span> <span class="type">Double</span>:</span><br><span class="line">        <span class="string">"zero as a Double"</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> someInt <span class="keyword">as</span> <span class="type">Int</span>:</span><br><span class="line">        <span class="string">"an integer value of (someInt)"</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> someDouble <span class="keyword">as</span> <span class="type">Double</span> <span class="keyword">where</span> someDouble &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="string">"a positive double value of (someDouble)"</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">is</span> <span class="type">Double</span>:</span><br><span class="line">        <span class="string">"some other double value that I don't want to print"</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">is</span> <span class="type">Optional</span>&lt;<span class="type">Int</span>&gt;.<span class="type">Type</span>:</span><br><span class="line">        <span class="string">"type optional int.self"</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> someString <span class="keyword">as</span> <span class="type">String</span>:</span><br><span class="line">        <span class="string">"a string value of "</span>(someString)<span class="string">""</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> (x, y) <span class="keyword">as</span> (<span class="type">Double</span>, <span class="type">Double</span>):</span><br><span class="line">        <span class="string">"an (x, y) point at (x), (y)"</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> stringConverter <span class="keyword">as</span> (<span class="type">String</span>) -&gt; <span class="type">String</span>:</span><br><span class="line">        stringConverter(<span class="string">"Michael"</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="string">"something else"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="AnyObject"><a href="#AnyObject" class="headerlink" title="AnyObject"></a>AnyObject</h2><h3 id="What-is-AnyObject"><a href="#What-is-AnyObject" class="headerlink" title="What is AnyObject?"></a>What is <code>AnyObject</code>?</h3><blockquote><p><code>AnyObject</code> can represent an instance of any class type. <a href="https://docs.swift.org/swift-book/LanguageGuide/TypeCasting.html" target="_blank" rel="noopener">doc</a></p><p>The protocol to which all classes implicitly conform.</p></blockquote><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> v: <span class="type">AnyObject</span> = <span class="type">AnyClassInstance</span></span><br></pre></td></tr></table></figure><p>ä¸€èµ·æ¥çœ‹ä¸€ä¸‹ <code>AnyObject</code> çš„æºç </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">AnyObject</span></span><br></pre></td></tr></table></figure><p>è¿™è¯­æ³•å¾ˆç¥å¥‡ï¼Œ<code>typealias</code> åé¢æ²¡æœ‰ç­‰å· - -ï¼Œä¸è¦è¯•å›¾å†™å‡ºï¼Œå› ä¸ºæ ¹æœ¬ä¸ä¼šç¼–è¯‘è¿‡</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Cocoa</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> any: <span class="type">AnyObject</span>.<span class="type">Protocol</span> = <span class="type">AnyObject</span>.<span class="keyword">self</span></span><br><span class="line"><span class="keyword">let</span> any1: <span class="type">AnyObject</span> = <span class="type">NSObject</span>()</span><br><span class="line"><span class="keyword">let</span> any2: <span class="type">AnyObject</span>.<span class="type">Type</span> = <span class="type">NSObject</span>.<span class="keyword">self</span></span><br></pre></td></tr></table></figure><p>æ¯”è¾ƒæ—©ä½¿ç”¨è¿‡ Swift çš„åŒå­¦å¯¹ AnyObject ä¸€å®šä¸ä¼šé™Œç”Ÿï¼Œå› ä¸ºåœ¨ Swift 3 ä¹‹å‰ï¼Œ<code>AnyObject</code> æ˜¯ä½œä¸º Objective-C <code>id</code> çš„å­˜åœ¨</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">swift(&lt;<span class="number">3.0</span>)</span><br><span class="line"></span><br><span class="line">id label = [<span class="type">UILabel</span> new];</span><br><span class="line"><span class="comment">// equals</span></span><br><span class="line"><span class="keyword">var</span> label: <span class="type">AnyObject</span> = <span class="type">UILabel</span>()</span><br></pre></td></tr></table></figure><h3 id="id-as-Any"><a href="#id-as-Any" class="headerlink" title="id as Any"></a>id as Any</h3><p>ä½†æ˜¯éšç€ swift-evolution çš„è¿™ä¸ª proposal <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0116-id-as-any.md" target="_blank" rel="noopener">SE-0116</a></p><p>åœ¨ Swift 3 ä¸­ï¼ŒObjective-C çš„ <code>id</code> è¢« map åˆ°äº† <code>Any</code></p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">swift(&gt;=<span class="number">3.0</span>)</span><br><span class="line"></span><br><span class="line">id label = [<span class="type">UILabel</span> new];</span><br><span class="line"><span class="comment">// equals</span></span><br><span class="line"><span class="keyword">var</span> label: <span class="type">Any</span> = <span class="type">UILabel</span>()</span><br></pre></td></tr></table></figure><h4 id="è¿™ä¹ˆåšçš„ç›®çš„æ˜¯ä»€ä¹ˆï¼ŸğŸ¤”"><a href="#è¿™ä¹ˆåšçš„ç›®çš„æ˜¯ä»€ä¹ˆï¼ŸğŸ¤”" class="headerlink" title="è¿™ä¹ˆåšçš„ç›®çš„æ˜¯ä»€ä¹ˆï¼ŸğŸ¤”"></a>è¿™ä¹ˆåšçš„ç›®çš„æ˜¯ä»€ä¹ˆï¼ŸğŸ¤”</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> ğŸ± </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Notification</span>.<span class="title">Name</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> <span class="type">CatDidMeow</span> = <span class="type">Notification</span>.<span class="type">Name</span>(rawValue: <span class="string">"cat.did.meow"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ Swift 3.0 ä¹‹å‰ï¼Œå¦‚æœæˆ‘æƒ³æŠŠè¿™ä¸ª struct é€šè¿‡ Notification çš„ userinfo çš„ object å‘é€å‡ºå»ï¼Œéœ€è¦åšä¸‹é¢è¿™äº›äº‹æƒ…ï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">swift(&lt;<span class="number">3.0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„è¿™é‡Œ userInfo Object çš„ç±»å‹æ˜¯ AnyObject</span></span><br><span class="line"><span class="type">NotificationCenter</span>.<span class="keyword">default</span></span><br><span class="line">    .post(</span><br><span class="line">        name: <span class="type">Notification</span>.<span class="type">Name</span>,</span><br><span class="line">        object: <span class="type">AnyObject?</span></span><br><span class="line">        userInfo: [<span class="type">NSObject</span> : <span class="type">AnyObject</span>]?)</span><br><span class="line"></span><br><span class="line"><span class="comment">// éœ€è¦æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ª Class ç±»å‹çš„ Box æŠŠ value types object ç»™åŒ…èµ·æ¥</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Box</span>&lt;<span class="title">T</span>&gt;: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> value: <span class="type">T</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="number">_</span> value: <span class="type">T</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.value = value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// post</span></span><br><span class="line"><span class="type">NotificationCenter</span>.<span class="keyword">default</span></span><br><span class="line">    .post(</span><br><span class="line">    name: .<span class="type">CatDidMeow</span>,</span><br><span class="line">    object: <span class="literal">nil</span></span><br><span class="line">    userInfo: [<span class="string">"cat"</span> : <span class="type">Box</span>(ğŸ±(name: <span class="string">"Kitty"</span>))])</span><br><span class="line"></span><br><span class="line"><span class="comment">// observe</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> box = notification.userInfo?[<span class="string">"cat"</span>] <span class="keyword">as</span>? <span class="type">Box</span>&lt;ğŸ±&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> cat = box.value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ Swift 3.0 ä¹‹åï¼Œä¸éœ€è¦ Box ç±»å‹çš„å°è£…ä¹Ÿèƒ½æŠŠ ğŸ± å‘é€å‡ºå»äº†ï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">swift(&gt;=<span class="number">3.0</span>)</span><br><span class="line"><span class="type">NotificationCenter</span>.<span class="keyword">default</span></span><br><span class="line">    .addObserver(forName: .<span class="type">CatDidMeow</span>,</span><br><span class="line">                  object: <span class="literal">nil</span>,</span><br><span class="line">                   queue: <span class="literal">nil</span>) &#123; notification <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">let</span> cat = notification.userInfo?[<span class="string">"cat"</span>] <span class="keyword">as</span>? ğŸ± &#123;</span><br><span class="line">                        cat.name</span><br><span class="line">                    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">NotificationCenter</span>.<span class="keyword">default</span></span><br><span class="line">    .post(name: .<span class="type">CatDidMeow</span>,</span><br><span class="line">        object: <span class="literal">nil</span>,</span><br><span class="line">      userInfo: [<span class="string">"cat"</span>: ğŸ±(name: <span class="string">"Kitty"</span>)])</span><br></pre></td></tr></table></figure><p>âœ… è¿™æ ·åšçš„ç›®çš„æ˜¯è®© Swift èƒ½å¤Ÿæœ€å¤§åŠ›åº¦çš„ä½¿ç”¨å·²æœ‰ Cocoa ä¸­çš„ Objective-C APIï¼Œä¹Ÿç¬¦åˆè‹¹æœå¸Œæœ›æˆ‘ä»¬æœ€å¤§åŠ›åº¦ä½¿ç”¨ value types çš„æ„¿æ™¯</p><p>ğŸ’« Use more value types</p><h4 id="é‚£ä¹ˆæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼ŸğŸ¤”"><a href="#é‚£ä¹ˆæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼ŸğŸ¤”" class="headerlink" title="é‚£ä¹ˆæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼ŸğŸ¤”"></a>é‚£ä¹ˆæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼ŸğŸ¤”</h4><blockquote><p>When a Swift value or object is passed into Objective-C as an <code>id</code> parameter, the compiler introduces a universal bridging conversion operation.</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰çš„ç±»å‹éƒ½å¯ä»¥è¢«è½¬æˆ <code>id</code> ç±»å‹</p><h5 id="objc-Classes"><a href="#objc-Classes" class="headerlink" title="@objc Classes"></a>@objc Classes</h5><p>å› ä¸º Swift å’Œ Objective-C ä¸¤è¾¹éƒ½èƒ½æ­£å¸¸æ“ä½œï¼Œæ‰€ä»¥ä¸éœ€è¦ç‰¹åˆ«çš„æ”¯æŒ</p><h5 id="Bridged-value-types"><a href="#Bridged-value-types" class="headerlink" title="Bridged value types"></a>Bridged value types</h5><p>å¦‚æœæ˜¯ Foundation ä¸­æ”¯æŒ <code>ObjcBridgable</code> çš„ç±»å‹ï¼Œå¯ä»¥è‡ªåŠ¨è¢«äº’ç›¸è½¬æ¢æˆ Swift å’Œ Objective-C ä¸­ä¸åŒçš„ç±»å‹</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> date: <span class="type">NSDate</span> = <span class="type">Date</span>() <span class="keyword">as</span> <span class="type">NSDate</span></span><br><span class="line"><span class="keyword">let</span> data: <span class="type">NSData</span> = <span class="type">Data</span>() <span class="keyword">as</span> <span class="type">NSData</span></span><br></pre></td></tr></table></figure><h5 id="Unbridged-value-types"><a href="#Unbridged-value-types" class="headerlink" title="Unbridged value types"></a>Unbridged value types</h5><p>å…¶ä½™ç±»å‹å±äºæ²¡è¢« bridge çš„ value typesï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> username: <span class="type">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Object</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)updateUser:(<span class="keyword">id</span>)user;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ... generated swift interface</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">updateUser</span><span class="params">(user: <span class="keyword">Any</span>)</span></span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="keyword">let</span> object = <span class="type">Object</span>()</span><br><span class="line">object.updateUser(<span class="type">Person</span>(username: <span class="string">"abe"</span>))</span><br><span class="line"></span><br><span class="line"><span class="type">Person</span>` -&gt; `_Swift_Value *</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä½¿ç”¨ lldb ä¸‹æ–­ç‚¹å‘ç°ï¼ŒSwift ä¼šæŠŠ unbridged value types è½¬æ¢æˆ <code>_Swift_Value *</code> çš„ç±»å‹ï¼Œåœ¨ Swift ä¸­é€šè¿‡ cast å¯ä»¥è½¬æ¢æˆå¯¹åº”çš„ç±»å‹ï¼Œä½†åœ¨ Objective-C ä¸­å¯¹è¿™ç§ç±»å‹æ— æ³•æ“ä½œã€‚</p><blockquote><p>When <code>id</code> values are brought into Swift as <code>Any</code>, we use the runtimeâ€™s existing ambivalent dynamic casting support to handle bridging back to either class references or Swift value types.</p></blockquote><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="meta">@objc</span>Members</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwiftClass</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">testID</span>(<span class="keyword">_</span> <span class="title">any</span>: <span class="title">Any</span>) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[<span class="type">SwiftClass</span> testID:someIDVariable]</span><br><span class="line"><span class="comment">// ... equals</span></span><br><span class="line"><span class="keyword">let</span> object = <span class="type">Object</span>()</span><br><span class="line"><span class="keyword">let</span> a = object <span class="keyword">as</span> <span class="type">Any</span></span><br></pre></td></tr></table></figure><h3 id="Quiz-ğŸ“"><a href="#Quiz-ğŸ“" class="headerlink" title="Quiz ğŸ“"></a>Quiz ğŸ“</h3><p>ä¸‹é¢çš„è¾“å‡ºéƒ½æ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arrayOfAnyObject: [<span class="type">AnyObject</span>] = [</span><br><span class="line">    <span class="number">1</span> <span class="keyword">as</span> <span class="type">AnyObject</span>,</span><br><span class="line">    <span class="string">"str"</span> <span class="keyword">as</span> <span class="type">AnyObject</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">arrayOfAnyObject.forEach &#123; element <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(type(of: element))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> e = element <span class="keyword">as</span>? <span class="type">Int</span> &#123; <span class="string">"Int (e)"</span> &#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> e = element <span class="keyword">as</span>? <span class="type">String</span> &#123; <span class="string">"String (e)"</span> &#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> e = element <span class="keyword">as</span>? <span class="type">NSString</span> &#123; <span class="string">"NSString (e)"</span> &#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> e = element <span class="keyword">as</span>? <span class="type">NSNumber</span> &#123; <span class="string">"NSNumber (e)"</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arrayOfAny = arrayOfAnyObject <span class="keyword">as</span> [<span class="type">Any</span>]</span><br><span class="line">arrayOfAny.forEach &#123; element <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(type(of: element))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> e = element <span class="keyword">as</span>? <span class="type">Int</span> &#123; <span class="string">"Int (e)"</span> &#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> e = element <span class="keyword">as</span>? <span class="type">String</span> &#123; <span class="string">"String (e)"</span> &#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> e = element <span class="keyword">as</span>? <span class="type">NSString</span> &#123; <span class="string">"NSString (e)"</span> &#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> e = element <span class="keyword">as</span>? <span class="type">NSNumber</span> &#123; <span class="string">"NSNumber (e)"</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arrayOfAny2: [<span class="type">Any</span>] = [<span class="number">1</span>, <span class="string">"2"</span>]</span><br><span class="line">arrayOfAny2.forEach &#123; element <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(type(of: element))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> e = element <span class="keyword">as</span>? <span class="type">Int</span> &#123; <span class="string">"Int (e)"</span> &#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> e = element <span class="keyword">as</span>? <span class="type">String</span> &#123; <span class="string">"String (e)"</span> &#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> e = element <span class="keyword">as</span>? <span class="type">NSString</span> &#123; <span class="string">"NSString (e)"</span> &#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> e = element <span class="keyword">as</span>? <span class="type">NSNumber</span> &#123; <span class="string">"NSNumber (e)"</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="AnyObject-çš„å…¶å®ƒä½œç”¨"><a href="#AnyObject-çš„å…¶å®ƒä½œç”¨" class="headerlink" title="AnyObject çš„å…¶å®ƒä½œç”¨"></a>AnyObject çš„å…¶å®ƒä½œç”¨</h3><h4 id="Weak"><a href="#Weak" class="headerlink" title="Weak"></a><code>Weak</code></h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">SomeDelegate</span>: <span class="title">AnyObject</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ”´ error: 'weak' must not be applied to non-class-bound 'Any'; consider adding a protocol conformance that has a class bound</span></span><br><span class="line"><span class="comment">// weak var d: Any? = nil</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Cocoa</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span>: <span class="title">NSObject</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">SomeClass</span>: <span class="title">SomeDelegate</span> </span>&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> someClassInstance: <span class="type">SomeClass?</span> = <span class="type">SomeClass</span>()</span><br><span class="line"><span class="keyword">weak</span> <span class="keyword">var</span> d: <span class="type">AnyObject?</span> = someClassInstance</span><br><span class="line">someClassInstance = <span class="literal">nil</span></span><br><span class="line">d</span><br></pre></td></tr></table></figure><h2 id="Any-amp-AnyObject-çš„å…¶å®ƒåº”ç”¨"><a href="#Any-amp-AnyObject-çš„å…¶å®ƒåº”ç”¨" class="headerlink" title="Any &amp; AnyObject çš„å…¶å®ƒåº”ç”¨"></a>Any &amp; AnyObject çš„å…¶å®ƒåº”ç”¨</h2><h3 id="Then-âœ¨"><a href="#Then-âœ¨" class="headerlink" title="Then âœ¨"></a><a href="https://github.com/devxoul/Then" target="_blank" rel="noopener">Then</a> âœ¨</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Cocoa</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> frame = <span class="type">CGRect</span>().with &#123;</span><br><span class="line">    $<span class="number">0</span>.origin.x = <span class="number">10</span></span><br><span class="line">    $<span class="number">0</span>.size.width = <span class="number">100</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">_</span> = <span class="type">NSTextField</span>().then &#123;</span><br><span class="line">    $<span class="number">0</span>.textColor = .black</span><br><span class="line">    $<span class="number">0</span>.font = .systemFont(ofSize: <span class="number">15</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// or your custom types</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> ğŸ¤ </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span> = <span class="string">"bird"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> ğŸ¤: <span class="title">Then</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ğŸ•Š = ğŸ¤().with &#123;</span><br><span class="line">    $<span class="number">0</span>.name = <span class="string">"dove"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ğŸ•Š.name</span><br></pre></td></tr></table></figure><h2 id="Some-Tips"><a href="#Some-Tips" class="headerlink" title="Some Tips"></a>Some Tips</h2><h3 id="å‡å°‘-Any-å’Œ-AnyObject-ç±»å‹çš„ä½¿ç”¨"><a href="#å‡å°‘-Any-å’Œ-AnyObject-ç±»å‹çš„ä½¿ç”¨" class="headerlink" title="å‡å°‘ Any å’Œ AnyObject ç±»å‹çš„ä½¿ç”¨"></a>å‡å°‘ Any å’Œ AnyObject ç±»å‹çš„ä½¿ç”¨</h3><p>ä¸è¦æ”¾å¼ƒç¼–è¯‘æ£€æŸ¥ï¼Œå¦‚æœæ— æ³•é¿å…ï¼Œå°½æ—©æŠŠ Any æˆ–è€… AnyObject è½¬æ¢æˆçœŸæ­£çš„ç±»å‹ï¼Œç„¶åå†ä½¿ç”¨</p><h3 id="Obective-C-ä¸­æš´éœ²çš„æ¥å£ï¼Œå¦‚æœæœ‰å®¹å™¨ç±»å‹ï¼Œæœ€å¥½æŠŠå¾®å¼±çš„æ³›å‹çº¦æŸåŠ ä¸Š"><a href="#Obective-C-ä¸­æš´éœ²çš„æ¥å£ï¼Œå¦‚æœæœ‰å®¹å™¨ç±»å‹ï¼Œæœ€å¥½æŠŠå¾®å¼±çš„æ³›å‹çº¦æŸåŠ ä¸Š" class="headerlink" title="Obective-C ä¸­æš´éœ²çš„æ¥å£ï¼Œå¦‚æœæœ‰å®¹å™¨ç±»å‹ï¼Œæœ€å¥½æŠŠå¾®å¼±çš„æ³›å‹çº¦æŸåŠ ä¸Š"></a>Obective-C ä¸­æš´éœ²çš„æ¥å£ï¼Œå¦‚æœæœ‰å®¹å™¨ç±»å‹ï¼Œæœ€å¥½æŠŠå¾®å¼±çš„æ³›å‹çº¦æŸåŠ ä¸Š</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@property (nonatomic) NSArray&lt;NSDate *&gt; *dueDates;</span><br><span class="line">@property (nonatomic) NSDictionary&lt;NSNumber *, NSString *&gt; *dataDictionary;</span><br><span class="line">@property (nonatomic) NSSet&lt;NSString *&gt; *filter;</span><br><span class="line"></span><br><span class="line">â¬‡ï¸  âœ…</span><br><span class="line"></span><br><span class="line">public var dueDates: [Date]</span><br><span class="line">public var dataDictionary: [NSNumber : String]</span><br><span class="line">public var filter: Set&lt;String&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@property (nonatomic) NSArray *dueDates;</span><br><span class="line">@property (nonatomic) NSDictionary *dataDictionary;</span><br><span class="line">@property (nonatomic) NSSet *filter;</span><br><span class="line"></span><br><span class="line">â¬‡ï¸ ğŸ”´</span><br><span class="line"></span><br><span class="line">public var dueDates: [Any]</span><br><span class="line">public var dataDictionary: [AnyHashable : Any]</span><br><span class="line">public var filter: Set&lt;AnyHashable&gt;</span><br></pre></td></tr></table></figure><h3 id="Prefer-Swift-Value-Types-to-Bridged-Objective-C-Reference-Types"><a href="#Prefer-Swift-Value-Types-to-Bridged-Objective-C-Reference-Types" class="headerlink" title="Prefer Swift Value Types to Bridged Objective-C Reference Types"></a>Prefer Swift Value Types to Bridged Objective-C Reference Types</h3><blockquote><p>You should almost never need to use a bridged reference type directly in your own code.</p></blockquote><table><thead><tr><th>Swift value type</th><th>Objective-C reference type</th></tr></thead><tbody><tr><td><code>AffineTransform</code></td><td><code>NSAffineTransform</code></td></tr><tr><td><code>Array</code></td><td><code>NSArray</code></td></tr><tr><td><code>Calendar</code></td><td><code>NSCalendar</code></td></tr><tr><td><code>CharacterSet</code></td><td><code>NSCharacterSet</code></td></tr><tr><td><code>Data</code></td><td><code>NSData</code></td></tr><tr><td><code>DateComponents</code></td><td><code>NSDateComponents</code></td></tr><tr><td><code>DateInterval</code></td><td><code>NSDateInterval</code></td></tr><tr><td><code>Date</code></td><td><code>NSDate</code></td></tr><tr><td><code>Decimal</code></td><td><code>NSDecimalNumber</code></td></tr><tr><td><code>Dictionary</code></td><td><code>NSDictionary</code></td></tr><tr><td><code>IndexPath</code></td><td><code>NSIndexPath</code></td></tr><tr><td><code>IndexSet</code></td><td><code>NSIndexSet</code></td></tr><tr><td><code>Locale</code></td><td><code>NSLocale</code></td></tr><tr><td><code>Measurement</code></td><td><code>NSMeasurement</code></td></tr><tr><td><code>Notification</code></td><td><code>NSNotification</code></td></tr><tr><td>Swift numeric types</td><td><code>NSNumber</code></td></tr><tr><td><code>PersonNameComponents</code></td><td><code>NSPersonNameComponents</code></td></tr><tr><td><code>Set</code></td><td><code>NSSet</code></td></tr><tr><td><code>String</code></td><td><code>NSString</code></td></tr><tr><td><code>TimeZone</code></td><td><code>NSTimeZone</code></td></tr><tr><td><code>URL</code></td><td><code>NSURL</code></td></tr><tr><td><code>URLComponents</code></td><td><code>NSURLComponents</code></td></tr><tr><td><code>URLQueryItem</code></td><td><code>NSURLQueryItem</code></td></tr><tr><td><code>URLRequest</code></td><td><code>NSURLRequest</code></td></tr><tr><td><code>UUID</code></td><td><code>NSUUID</code></td></tr></tbody></table><h3 id="Write-More-Swift-ğŸ¤"><a href="#Write-More-Swift-ğŸ¤" class="headerlink" title="Write More Swift ğŸ¤"></a>Write More Swift ğŸ¤</h3><h2 id="å®‰åˆ©ä¸€ä¸ªå·¥å…·"><a href="#å®‰åˆ©ä¸€ä¸ªå·¥å…·" class="headerlink" title="å®‰åˆ©ä¸€ä¸ªå·¥å…·"></a>å®‰åˆ©ä¸€ä¸ªå·¥å…·</h2><p><a href="https://github.com/attaswift/Attabench" target="_blank" rel="noopener">Attabench</a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;è¿™æ˜¯æˆ‘ 1 æœˆ 22 æ—¥åœ¨çŸ¥ä¹ iOS å›¢é˜Ÿå†…éƒ¨çš„ä¸€æ¬¡åˆ†äº«&lt;/p&gt;
&lt;p&gt;è¿™ä¸€æ¬¡æ²¡æœ‰ä½¿ç”¨ Keynoteï¼Œå°è¯•æ€§åœ°å…¨ç¨‹ä½¿ç”¨ Playgroundï¼Œæ•ˆæœè¿˜ä¸é”™&lt;/p&gt;
&lt;p&gt;Playground ç‰ˆæœ¬å¯ä»¥æŸ¥çœ‹&lt;a href=&quot;https://github.com/X140Yu/Any-AnyObject-in-Swift&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;è¿™é‡Œ&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="Objective-C" scheme="https://x140yu.github.io/tags/Objective-C/"/>
    
      <category term="Swift" scheme="https://x140yu.github.io/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>2ğŸ¢18</title>
    <link href="https://x140yu.github.io/2018/"/>
    <id>https://x140yu.github.io/2018/</id>
    <published>2018-12-24T16:00:00.000Z</published>
    <updated>2019-08-19T07:43:25.677Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Numbers"><a href="#Numbers" class="headerlink" title="Numbers"></a>Numbers</h2><!-- Google Photos åœ¨ 2018 å¹´åº•æœ‰ 24223 å¼ ç…§ç‰‡ --><!-- é¦™æ¸¯ã€æ¸…è¿ˆã€æ›¼è°·ã€æ­å·ã€ä¹Œé•‡ã€è‹å· --><ul><li>80 éƒ¨ <a href="https://movie.douban.com/people/X140Yu/collect?sort=time&amp;tags_sort=count&amp;filter=all&amp;tag=2018&amp;mode=list" target="_blank" rel="noopener">ç”µå½±+ç¾å‰§</a></li><li>32938 åˆ†é’Ÿ <a href="https://spotifywrapped.com" target="_blank" rel="noopener">Spotify</a></li><li>8170 <a href="https://photos.google.com/" target="_blank" rel="noopener">ç…§ç‰‡+è§†é¢‘</a>ï¼Œ<a href="https://500px.com/x140yu" target="_blank" rel="noopener">Some Highlights</a></li><li>887 <a href="https://twitter.com/_X140Yu" target="_blank" rel="noopener">tweets</a></li><li>11 blogs <a href="https://zhaoxinyu.me/archives/" target="_blank" rel="noopener">X140Yuâ€™s Blog</a></li><li>357 contributions <a href="https://github.com/X140Yu" target="_blank" rel="noopener">GitHub</a></li><li>7 ä¸ªæ²¡å»è¿‡çš„åŸå¸‚</li></ul><a id="more"></a><h2 id="Devices"><a href="#Devices" class="headerlink" title="Devices"></a>Devices</h2><ul><li><strong>+</strong> <a href="http://www.rapoo.com/product/384" target="_blank" rel="noopener">rapoo MT750</a></li><li><strong>+</strong> <a href="https://support.apple.com/kb/SP739?locale=en_NZ" target="_blank" rel="noopener">Apple iPad Pro (9.7-inch) 32GB Silver</a></li><li><strong>+</strong> <a href="https://support.apple.com/kb/SP740?locale=en_NZ" target="_blank" rel="noopener">Apple Pencil</a></li><li><strong>+</strong> <a href="https://support.apple.com/kb/SP770?locale=en_NZ" target="_blank" rel="noopener">Apple iPhone X 64GB Space Gray</a></li><li><strong>-</strong> <a href="http://www.ricoh-imaging.co.jp/english/products/gr-2/" target="_blank" rel="noopener">RICOH GR II</a></li><li><strong>+</strong> <a href="https://www.sony.com/electronics/interchangeable-lens-cameras/ilce-7m3-body-kit" target="_blank" rel="noopener">SONY Î±7 III</a></li><li><strong>+</strong> <a href="https://www.sony.com/electronics/camera-lenses/sel55f18z" target="_blank" rel="noopener">SONY FE 55 mm F1.8 ZA</a></li><li><strong>+</strong> <a href="https://www.bose.com/en_us/products/headphones/earphones/quietcontrol-30.html" target="_blank" rel="noopener">BOSE QuietControl 30</a></li><li><strong>-</strong> <a href="https://support.apple.com/kb/SP743?viewlocale=en_US&amp;locale=en_NZ" target="_blank" rel="noopener">Apple iPhone 7 128G Black</a></li><li><strong>+</strong> <a href="https://www.amazon.cn/dp/B07746N2J9/ref=sr_1_1?s=amazon-devices&amp;ie=UTF8&amp;qid=1545637389&amp;sr=1-1&amp;keywords=paperwhite" target="_blank" rel="noopener">Kindle Paperwhite (10th gen)</a></li><li><strong>+</strong> <a href="https://www.asus.com/us/Networking/RTAC68U/" target="_blank" rel="noopener">ASUS RT-AC68U</a></li></ul><h2 id="Recommendation"><a href="#Recommendation" class="headerlink" title="Recommendation"></a>Recommendation</h2><ul><li>å¹´åº¦è½¯ä»¶ï¼š<a href="https://www.obdev.at/products/launchbar/index.html" target="_blank" rel="noopener">LaunchBar</a>ã€<a href="https://code.visualstudio.com/" target="_blank" rel="noopener">Visual Studio Code</a></li><li>å¹´åº¦ä¹¦ç±ï¼š<a href="https://book.douban.com/subject/25845930/" target="_blank" rel="noopener">Metaprogramming Ruby (2nd edition)</a>ã€<a href="https://book.douban.com/subject/1424555/" target="_blank" rel="noopener">HUNTER X HUNTER</a></li><li>å¹´åº¦æ¸¸æˆï¼š<a href="https://psnine.com/psngame/11631" target="_blank" rel="noopener">Monster Hunter: World</a>ã€<a href="https://psnine.com/psngame/7028" target="_blank" rel="noopener">Uncharted 4: A Thiefâ€™s Endâ„¢</a></li><li>å¹´åº¦åŸå¸‚ï¼š<a href="https://zhaoxinyu.me/2018-09-03-trip-to-hk/" target="_blank" rel="noopener">é¦™æ¸¯</a></li><li>å¹´åº¦ç¡¬ä»¶ï¼š<a href="https://www.amazon.cn/dp/B07746N2J9/ref=sr_1_1?s=amazon-devices&amp;ie=UTF8&amp;qid=1545637389&amp;sr=1-1&amp;keywords=paperwhite" target="_blank" rel="noopener">Kindle Paperwhite</a></li><li>å¹´åº¦æ­Œæ›²ï¼š<a href="https://song.link/us/i/1050203620" target="_blank" rel="noopener">Roses - The Chainsmokers, ROZES</a></li><li>å¹´åº¦å‰§é›†ï¼š<a href="https://trakt.tv/shows/we-bare-bears" target="_blank" rel="noopener">We Bare Bears</a></li></ul><h2 id="Plans-for-2019"><a href="#Plans-for-2019" class="headerlink" title="Plans for 2019"></a>Plans for 2019</h2><ul><li>è¯» 10 æœ¬ä¹¦ï¼ˆä¸åŒ…å«æ¼«ç”»ï¼‰</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Numbers&quot;&gt;&lt;a href=&quot;#Numbers&quot; class=&quot;headerlink&quot; title=&quot;Numbers&quot;&gt;&lt;/a&gt;Numbers&lt;/h2&gt;&lt;!-- Google Photos åœ¨ 2018 å¹´åº•æœ‰ 24223 å¼ ç…§ç‰‡ --&gt;
&lt;!-- é¦™æ¸¯ã€æ¸…è¿ˆã€æ›¼è°·ã€æ­å·ã€ä¹Œé•‡ã€è‹å· --&gt;
&lt;ul&gt;
&lt;li&gt;80 éƒ¨ &lt;a href=&quot;https://movie.douban.com/people/X140Yu/collect?sort=time&amp;amp;tags_sort=count&amp;amp;filter=all&amp;amp;tag=2018&amp;amp;mode=list&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ç”µå½±+ç¾å‰§&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;32938 åˆ†é’Ÿ &lt;a href=&quot;https://spotifywrapped.com&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Spotify&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;8170 &lt;a href=&quot;https://photos.google.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ç…§ç‰‡+è§†é¢‘&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://500px.com/x140yu&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Some Highlights&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;887 &lt;a href=&quot;https://twitter.com/_X140Yu&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;tweets&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;11 blogs &lt;a href=&quot;https://zhaoxinyu.me/archives/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;X140Yuâ€™s Blog&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;357 contributions &lt;a href=&quot;https://github.com/X140Yu&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;GitHub&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;7 ä¸ªæ²¡å»è¿‡çš„åŸå¸‚&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="çæ‰¯" scheme="https://x140yu.github.io/tags/%E7%9E%8E%E6%89%AF/"/>
    
  </entry>
  
  <entry>
    <title>æ‰‹æŠŠæ‰‹æ•™ä½ ç»™ä¼ä¸šå¾®ä¿¡ Mac å®¢æˆ·ç«¯å»é™¤æ°´å°</title>
    <link href="https://x140yu.github.io/2018-11-24-crack-wew/"/>
    <id>https://x140yu.github.io/2018-11-24-crack-wew/</id>
    <published>2018-11-23T16:00:00.000Z</published>
    <updated>2019-08-19T07:43:25.676Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x01-èµ·å› "><a href="#0x01-èµ·å› " class="headerlink" title="0x01 èµ·å› "></a>0x01 èµ·å› </h2><p>æœ€è¿‘å› ä¸ºæŸäº›åŸå› ï¼Œå…¬å¸å‡†å¤‡æŠŠç”¨äº†å¥½å¤šå¹´çš„ Slack æ¢æˆä¼ä¸šå¾®ä¿¡ã€‚è¿™å…¶å®æ˜¯ä»¶æŒºæ­£å¸¸çš„äº‹æƒ…ï¼Œå…¬å¸åœ¨ä¸åœåœ°å‘å±•ï¼Œä»€ä¹ˆæ ·çš„å˜åŒ–éƒ½æœ‰å¯èƒ½ä¼šå‘ç”Ÿã€‚è¯´ä¸å®šå…¬å¸åœ¨åšå¤§åˆ°ä¸€å®šç¨‹åº¦ä»¥åï¼Œåšè‡ªå·±çš„ IM ä¹Ÿä¸ä¸€å®šã€‚</p><p>ä½†å¦‚æœä¹‹å‰æ²¡æœ‰ç”¨è¿‡ Slack è¿˜å¥½ï¼Œä½†åœ¨ç”¨è¿‡å‡ å¹´ä¹‹åï¼Œå°±ä¸å…ä¼šæŠŠå®ƒä¸ä¼ä¸šå¾®ä¿¡ä¹‹é—´åšä¸€äº›å¯¹æ¯”ã€‚</p><p>æˆ‘å–œæ¬¢ Slack çš„ <a href="https://get.slack.help/hc/en-us/articles/115000769927-Message-and-file-threads" target="_blank" rel="noopener">Message and file threads</a>ã€ <a href="https://get.slack.help/hc/en-us/articles/206870317-Emoji-reactions" target="_blank" rel="noopener">Emoji reactions</a> è¿˜æœ‰å®ƒä¾¿æ·çš„ <a href="https://api.slack.com/" target="_blank" rel="noopener">API</a>ï¼Œè¿™å‡ ç‚¹ä¼ä¸šå¾®ä¿¡éƒ½åšçš„ä¸å¤ªå¥½ï¼Œç”šè‡³æ²¡æœ‰ã€‚è¿™è¿˜æŒºè®©äººå¤±æœ›çš„ã€‚</p><p>è€Œä¸”å®ƒçš„æ°´å°çœŸçš„å¾ˆé­”æ€§ï¼Œåœ¨èŠå¤©ç•Œé¢å¾ˆæ˜¾çœ¼ã€‚æ‰€ä»¥æˆ‘å†³å®šç”¨æˆ‘ä»…æœ‰çš„ä¸€ç‚¹ç‚¹<del>é€†å‘å·¥ç¨‹</del>ç ´è§£çŸ¥è¯†ï¼Œæ¥æŠŠå®ƒçš„æ°´å°ä»èŠå¤©ç•Œé¢ä¸­å»é™¤ã€‚</p><a id="more"></a><h2 id="0x02-å·¥å…·å‡†å¤‡"><a href="#0x02-å·¥å…·å‡†å¤‡" class="headerlink" title="0x02 å·¥å…·å‡†å¤‡"></a>0x02 å·¥å…·å‡†å¤‡</h2><ul><li><a href="https://www.hopperapp.com/" target="_blank" rel="noopener">Hopper Disassembler</a> demo version çš„å°±å¯ä»¥ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦ç”¨åˆ°å®ƒçš„ä»˜è´¹ç‰ˆåŠŸèƒ½</li><li><a href="https://github.com/Tyilo/insert_dylib" target="_blank" rel="noopener">insert_dylib</a> ç”¨äºä¿®æ”¹äºŒè¿›åˆ¶ï¼ŒåŠ å…¥ä¸€ä¸ª <code>LC_LOAD_DYLIB</code> çš„ <code>load command</code>ï¼Œè®©æœ€ç»ˆçš„äºŒè¿›åˆ¶åœ¨è¿è¡Œçš„æ—¶å€™ï¼ŒåŠ è½½æˆ‘ä»¬è‡ªå·±å†™çš„ framework ä¸­çš„ä»£ç </li><li>Xcodeï¼Œåˆ›å»º frameworkï¼Œç¼–å†™ä»£ç </li><li>ä¼ä¸šå¾®ä¿¡ï¼Œ2.6.1 ç‰ˆæœ¬</li></ul><h2 id="0x03-å¯»æ‰¾å…¥å£"><a href="#0x03-å¯»æ‰¾å…¥å£" class="headerlink" title="0x03 å¯»æ‰¾å…¥å£"></a>0x03 å¯»æ‰¾å…¥å£</h2><blockquote><p>æˆ‘è§‰å¾—å®¢æˆ·ç«¯ä¸­çš„é€†å‘å·¥ç¨‹æˆ–è€…è¯´â€œç ´è§£â€ï¼Œæœ€é‡è¦çš„æ˜¯æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•ï¼Œæˆ–è€…è¯´å…¥å£ï¼Œæ‰¾åˆ°äº†ä»¥åï¼Œç¦»æˆåŠŸä¹Ÿå°±åªæœ‰ä¸€æ­¥ä¹‹é¥äº†ã€‚</p></blockquote><p>åœ¨å®‰è£…å®Œä¼ä¸šå¾®ä¿¡ä¹‹åï¼ŒæŠŠ <code>/Applications/ä¼ä¸šå¾®ä¿¡.app/Contents/MacOS/ä¼ä¸šå¾®ä¿¡</code> è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ‹–è¿› Hopper é‡Œï¼Œå¾…å®ƒåˆ†æå®Œæ¯•åï¼Œå¼€å§‹æœç´¢ä¸æ°´å°ç›¸å…³çš„æ–¹æ³•ã€‚</p><p>å¦‚æœå¼€å‘äººå‘˜æ¯”è¾ƒæ­£å¸¸çš„è¯ï¼Œé‚£ 99% çš„æ¦‚ç‡æœç´¢ <code>waterMark</code> å°±å¯ä»¥æ‰¾åˆ°æˆ‘ä»¬æƒ³è¦çš„æ–¹æ³•ï¼ˆé‚£ 1% å¯èƒ½éœ€è¦æœç´¢ <code>shuiyin</code> ğŸ™ƒï¼‰ï¼Œ</p><p><img src="https://s1.ax1x.com/2018/11/25/FkFsPO.png" width="500"></p><p>There you goï¼Œæœ‰å¤§é‡è·Ÿæ°´å°ç›¸å…³çš„æ–¹æ³•ã€‚ä¸‹é¢å‡ ä¸ªæ–¹æ³•çœ‹èµ·æ¥éƒ½æ˜¯é€šè¿‡è¿”å›çš„ <code>BOOL</code> å€¼æ¥å†³å®šèŠå¤©ç•Œé¢æ˜¯å¦éœ€è¦æ˜¾ç¤ºæ°´å°ï¼Œ</p><ul><li><code>-[WEWConversation isConversationSupportWaterMark]</code></li><li><code>+[WEWConversation isWaterMarkSupportConversation:]</code></li><li><code>-[WEWConversationService isOpenConversationWaterMark]</code> (ä¼ä¸šå¾®ä¿¡ç®¡ç†å‘˜çš„è®¾ç½®é‡Œåº”è¯¥æœ‰ä¸€é”®å…³é—­æ°´å°ä¹‹ç±»çš„è®¾ç½® ğŸ¤”)</li></ul><blockquote><p>åœ¨<del>é€†å‘</del>ç ´è§£çš„è¿‡ç¨‹ä¸­å®ç°åŒä¸€ä¸ªéœ€æ±‚å¾€å¾€æœ‰å¤šç§é€”å¾„ï¼Œå‘æ•£æ€ç»´ï¼Œè·¯ä¸åªä¸€æ¡</p></blockquote><p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼Œé€šè¿‡ Hopper æŸ¥çœ‹ Pseudo-code å¯ä»¥å¾—çŸ¥ï¼Œä¸åŒçš„ conversation æœ‰ä¸åŒçš„æ°´å°è®¾ç½®ï¼Œæ¯”å¦‚æ–‡ä»¶ä¼ è¾“åŠ©æ‰‹è¿˜æœ‰ä¸€äº›æœºå™¨äººçš„èŠå¤©ç•Œé¢å°±æ²¡æœ‰æ°´å°ï¼Œå¦‚æœåœ¨è¿™ä¸ªæ–¹æ³•é‡Œè¿”å› NOï¼Œé‚£æ‰€æœ‰çš„èŠå¤©ç•Œé¢å°±éƒ½åº”è¯¥æ²¡æœ‰æ°´å°äº†ï¼Œ</p><p><img src="https://s1.ax1x.com/2018/11/25/FkFBa6.png" width="500"></p><p>æˆ‘ä»¬å…ˆåœ¨ lldb ä¸­éªŒè¯ä¸€ä¸‹çŒœæƒ³ï¼Œ</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºä¼ä¸šå¾®ä¿¡çš„è°ƒè¯• targerï¼Œå‡†å¤‡è°ƒè¯•ï¼Œè¿™ä¸€æ­¥å¹¶ä¸ä¼šå¯åŠ¨ä¼ä¸šå¾®ä¿¡</span></span><br><span class="line">lldb -w /Applications/ä¼ä¸šå¾®ä¿¡.app/Contents/MacOS/ä¼ä¸šå¾®ä¿¡</span><br></pre></td></tr></table></figure><p>è¿›å…¥ lldb çš„è°ƒè¯•æ¨¡å¼ï¼Œè¯•è¯•åœ¨è¿™ä¸ªæ–¹æ³•ä¸‹ä¸€ä¸ªæ–­ç‚¹ï¼Œç»“æœ lldb æŠ±æ€¨è¯´æ‰¾ä¸åˆ°å¯¹åº”çš„æ–¹æ³•ï¼Œ</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">(lldb) b -[WEWConversation isConversationSupportWaterMark]</span><br><span class="line">Breakpoint 1: no locations (pending).</span><br><span class="line">WARNING:  Unable to resolve breakpoint to any actual locations.</span><br></pre></td></tr></table></figure><p>éš¾é“æ˜¯æˆ‘ä¸‹æ–­ç‚¹çš„æ–¹å¼ä¸å¯¹ï¼Ÿæ–­ <code>-[NSObject init]</code> è¯•ä¸€ä¸‹ï¼Œ</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">(lldb) b -[NSObject init]</span><br><span class="line">Breakpoint 2: <span class="built_in">where</span> = libobjc.A.dylib`-[NSObject init], address = 0x000000000000b702</span><br></pre></td></tr></table></figure><p>æ ¹æ® log å¾—çŸ¥ï¼Œæ˜¯èƒ½æ–­æˆåŠŸçš„ï¼Œè¿™è¯´æ˜ä¸‹æ–­ç‚¹çš„å§¿åŠ¿æ²¡é—®é¢˜ï¼Œå‡ºé—®é¢˜çš„å¯èƒ½æ˜¯ lldbï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä¼ä¸šå¾®ä¿¡å¯¹æœ€ç»ˆçš„äºŒè¿›åˆ¶åšäº†æ‰‹è„šï¼ˆè¿™å°±è§¦åŠæˆ‘çš„çŸ¥è¯†ç›²åŒºäº†ï¼Œå¸Œæœ›èƒ½æœ‰æ‡‚è¡Œçš„äººå‡ºç°ç»™æˆ‘è§£è§£æƒ‘ ğŸ¤©</p><p>æ‰€ä»¥æˆ‘ä»¬åªèƒ½é€šè¿‡æ–­å‡½æ•°åœ°å€çš„æ–¹æ³•æ¥è¿›è¡Œè°ƒè¯•äº†ï¼Œè¿™éœ€è¦å…ˆè®©ç¨‹åºå¯åŠ¨èµ·æ¥ã€‚åœ¨æ­¤ä¹‹å‰ï¼ŒæŠŠä¸Šé¢ä¸‹çš„æ–­ç‚¹éƒ½åˆ æ‰ï¼Œ</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">(lldb) breakpoint delete</span><br><span class="line">About to delete all breakpoints, <span class="keyword">do</span> you want to <span class="keyword">do</span> that?: [Y/n] Y</span><br><span class="line">All breakpoints removed. (2 breakpoints)</span><br></pre></td></tr></table></figure><p>å…ˆå¯åŠ¨åº”ç”¨ç¨‹åºï¼Œå¾…åº”ç”¨è¿è¡Œèµ·æ¥åï¼Œåœ¨ lldb è°ƒè¯•ç•Œé¢ï¼ŒæŒ‰ <code>CTRL + C</code> è®©åº”ç”¨æš‚åœä¸‹æ¥ï¼Œ</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">(lldb) run</span><br><span class="line">... </span><br><span class="line">CTRL + C</span><br></pre></td></tr></table></figure><p>é€šè¿‡ Hopper/class-dump/MachOView å¯çŸ¥ï¼Œ<code>-[WEWConversation isConversationSupportWaterMark]</code> æ–¹æ³•çš„åœ°å€æ˜¯  <code>0x00000001017fb7e6</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™ä¸ªåœ°å€ä¸Šä¸‹æ–­ç‚¹å³å¯æ–­åˆ°è¿™ä¸ªå‡½æ•°ï¼Œ</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">(lldb) b 0x00000001017fb7e6</span><br><span class="line">Breakpoint 3: <span class="built_in">where</span> = ä¼ä¸šå¾®ä¿¡`___lldb_unnamed_symbol145659$$ä¼ä¸šå¾®ä¿¡, address = 0x00000001017fb7e6</span><br></pre></td></tr></table></figure><blockquote><p>âš ï¸ åœ¨åº”ç”¨å¯åŠ¨ä¹‹å‰æ˜¯ä¸å¯ä»¥é€šè¿‡åœ°å€ä¸‹æ–­ç‚¹çš„ï¼Œå› ä¸ºåœ¨åº”ç”¨ç¨‹åºå¯åŠ¨åï¼Œæ‰€æœ‰çš„åœ°å€ä¼šäº§ç”Ÿä¸€ä¸ªéšæœºçš„ offsetï¼Œåœ¨è¿™ä¹‹å lldb æ‰èƒ½ç¡®å®šè¿™ä¸ª offset æ˜¯å¤šå°‘ï¼Œä»è€Œåœ¨æ­£ç¡®çš„åœ°å€ break</p></blockquote><p>æ¥ç€æˆ‘ä»¬è®©åº”ç”¨ç¨‹åºç»§ç»­è¿è¡Œï¼Œ</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">(lldb) c</span><br></pre></td></tr></table></figure><p>é€‰ä¸­ä¸€ä¸ªä¼šå‡ºç°æ°´å°çš„å¯¹è¯ï¼Œè¿™æ—¶åº”ç”¨ç¨‹åºä¼šåœä¸‹ï¼Œçœ‹ lldb çš„è°ƒè¯•ç•Œé¢å¯ä»¥å‘ç°ï¼Œåº”ç”¨æˆåŠŸæ–­åœ¨æŸä¸ªæ–¹æ³•ä¸Šäº†ï¼Œ</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">* thread <span class="comment">#1, queue = 'com.apple.main-thread', stop reason = breakpoint 3.1</span></span><br><span class="line">    frame <span class="comment">#0: 0x00000001017fb7e6 ä¼ä¸šå¾®ä¿¡` ___lldb_unnamed_symbol145659$$ä¼ä¸šå¾®ä¿¡ </span></span><br><span class="line">ä¼ä¸šå¾®ä¿¡`___lldb_unnamed_symbol145659$$ä¼ä¸šå¾®ä¿¡:</span><br><span class="line">-&gt;  0x1017fb7e6 &lt;+0&gt;:  push   rbp</span><br><span class="line">    0x1017fb7e7 &lt;+1&gt;:  mov    rbp, rsp</span><br><span class="line">    0x1017fb7ea &lt;+4&gt;:  push   r15</span><br><span class="line">    0x1017fb7ec &lt;+6&gt;:  push   r14</span><br><span class="line">    0x1017fb7ee &lt;+8&gt;:  push   rbx</span><br><span class="line">    0x1017fb7ef &lt;+9&gt;:  push   rax</span><br><span class="line">    0x1017fb7f0 &lt;+10&gt;: mov    r15, rdi</span><br><span class="line">    0x1017fb7f3 &lt;+13&gt;: mov    r14, qword ptr [rip + 0x16364a6] ; <span class="string">"conversationType"</span></span><br><span class="line">Target 0: (ä¼ä¸šå¾®ä¿¡) stopped.</span><br></pre></td></tr></table></figure><p>ç”±äºæ¯ä¸€ä¸ª Objective-C çš„æ–¹æ³•è°ƒç”¨éƒ½ä¼šå˜ä¸ºä¸€ä¸ª C çš„æ–¹æ³•è°ƒç”¨ <code>objc_msgSend(obj, SEL, p1, ...)</code> æ‰€ä»¥é€šè¿‡æ‰“å° <code>rdi</code> è¿˜æœ‰ <code>rsi</code> å¯„å­˜å™¨ä¸­çš„å€¼å°±å¯ä»¥ç¡®å®šæˆ‘ä»¬æ–­çš„æ–¹æ³•æ˜¯ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œ</p><blockquote><p>x86_64 ä¸­çš„å¯„å­˜å™¨ä¸å‡½æ•°å‚æ•°çš„å¯¹åº”å…³ç³»å¦‚ä¸‹è¡¨ï¼Œ</p><table><thead><tr><th style="text-align:center">arg1</th><th style="text-align:center">arg2</th><th style="text-align:center">arg3</th><th style="text-align:center">arg4</th><th style="text-align:center">arg5</th><th style="text-align:center">arg6</th><th style="text-align:center">argx</th></tr></thead><tbody><tr><td style="text-align:center">RDI</td><td style="text-align:center">RSI</td><td style="text-align:center">RDX</td><td style="text-align:center">RCX</td><td style="text-align:center">R8</td><td style="text-align:center">R9</td><td style="text-align:center">R10+</td></tr></tbody></table></blockquote><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">(lldb) po <span class="variable">$rdi</span></span><br><span class="line">&lt;WEWConversation: 0x11f195a40&gt;</span><br><span class="line">(lldb) po (char *)<span class="variable">$rsi</span></span><br><span class="line"><span class="string">"isConversationSupportWaterMark"</span></span><br></pre></td></tr></table></figure><p>æ²¡é”™ï¼Œå°±æ˜¯ <code>-[WEWConversation isConversationSupportWaterMark]</code></p><p>ç°åœ¨æˆ‘ä»¬è®©è¿™ä¸ªå‡½æ•°ç›´æ¥è¿”å› <code>NO</code>ï¼Œç„¶åç»§ç»­è®©ç¨‹åºè¿è¡Œï¼Œ</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">(lldb) thread <span class="built_in">return</span> 0</span><br><span class="line">(lldb) c</span><br></pre></td></tr></table></figure><p>ç°åœ¨å†è·³å›ä¼ä¸šå¾®ä¿¡ï¼Œå‘ç°ä¹‹å‰ä¼šå‡ºç°æ°´å°çš„å¯¹è¯æ²¡æœ‰æ°´å°äº†ï¼Œè¿™è¯´æ˜æˆ‘ä»¬çš„çŒœæƒ³æ˜¯æ­£ç¡®çš„ ğŸ¥°</p><h2 id="0x04-åˆ¶åš-Framework"><a href="#0x04-åˆ¶åš-Framework" class="headerlink" title="0x04 åˆ¶åš Framework"></a>0x04 åˆ¶åš Framework</h2><p>è™½ç„¶å¯ä»¥é€šè¿‡ lldb è°ƒè¯•çš„æ–¹æ³•å»æ‰æ°´å°ï¼Œå¯æ˜¯è¿™æ ·å¤ªéº»çƒ¦äº†ï¼Œä¸å¯èƒ½ä»¥åæ¯æ¬¡éƒ½è¿™ä¹ˆæå§ï¼Ÿå¦‚æœèƒ½è®©åº”ç”¨ç¨‹åºæ¯ä¸€æ¬¡å¯åŠ¨çš„æ—¶å€™ï¼Œéƒ½æ‰§è¡Œæˆ‘ä»¬åŠ å…¥çš„ä»£ç å°±å¥½äº†ã€‚è¿™ä¸€æ­¥å¯ä»¥é€šè¿‡ <a href="https://github.com/Tyilo/insert_dylib" target="_blank" rel="noopener">insert_dylib</a> å·¥å…·å®ç°ã€‚å®ƒå¯ä»¥ä¿®æ”¹äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåœ¨å…¶ dyld load commands åˆ—è¡¨çš„æœ€ååŠ å…¥æˆ‘ä»¬éœ€è¦ load çš„ dylib/Framework çš„ commandã€‚</p><p>ä½¿ç”¨ Xcode åˆ›å»ºä¸€ä¸ªåä¸º WEWTweak çš„ Cocoa Frameworkã€‚</p><p>å› ä¸ºéœ€è¦ä½¿ç”¨ Method Swizzling æ¢æ‰ä¸Šé¢å‡½æ•°çš„å®ç°ï¼Œä½†è¿˜æ‡’å¾—è£¸å†™è¿™éƒ¨åˆ†é€»è¾‘ ï¼Œé‚£å°±ä½¿ç”¨ Pod å¼•å…¥ <code>JRSwizzle</code> å§ ğŸ˜Œï¼ˆæ³¨æ„ Podfile ä¸­ä¸è¦åŠ  <code>use_framework!</code>ï¼‰ã€‚</p><blockquote><p>åŠ äº† <code>use_framework!</code> ä»¥åï¼Œæ¯ä¸€ä¸ª pod target éƒ½æ˜¯ä¸€ä¸ª frameworkï¼Œè¿™æ ·éœ€è¦å¤„ç†å¾ˆå¤šçš„ frameworkï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰€æœ‰ pod target æœ€ç»ˆçš„ç¬¦å·éƒ½é“¾æ¥åˆ° <code>WEWTweak.framework</code> ä¸­ï¼Œä¸€ä¸ª framework è§£å†³é—®é¢˜</p></blockquote><p>ç„¶ååœ¨ framework ä¸­åˆ›å»ºä¸€ä¸ª <code>NSObject</code> çš„ category <code>(WEWTweak)</code>ï¼ŒåŠ å…¥ä»¥ä¸‹ ugly çš„ä»£ç ï¼Œ</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;JRSwizzle/JRSwizzle.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSObject</span> (<span class="title">WEWTweak</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    [objc_getClass(<span class="string">"WEWConversation"</span>)</span><br><span class="line">     jr_swizzleMethod:<span class="built_in">NSSelectorFromString</span>(<span class="string">@"isConversationSupportWaterMark"</span>)</span><br><span class="line">     withMethod:<span class="keyword">@selector</span>(wew_isConversationSupportWaterMark)</span><br><span class="line">     error:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)wew_isConversationSupportWaterMark &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ–¹æ³•äº¤æ¢çš„ä»£ç å†™åœ¨ <code>load</code> æˆ– <code>__attribute__((constructor))</code> éƒ½å¯ä»¥</p><blockquote><p><code>__attribute__((constructor))</code> æ˜¯ä¸€ä¸ª clang çš„ attributeï¼Œè¢«æ ‡è®°çš„ C æ–¹æ³•ä¼šåœ¨ <code>+(void)load</code>  å’Œ <code>main</code> å‡½æ•°ä¹‹é—´è¢«æ‰§è¡Œã€‚</p></blockquote><p>ç¼–è¯‘é¡¹ç›®ï¼ŒæŠŠäº§ç‰© <code>WEWTweak.framework</code> è¿˜æœ‰ <a href="https://github.com/X140Yu/WEWTweak/blob/master/insert_dylib" target="_blank" rel="noopener">insert_dylib</a> éƒ½æ‹–åˆ°ä¼ä¸šå¾®ä¿¡äºŒè¿›åˆ¶çš„åŒçº§ç›®å½•ï¼Œç„¶åè¿›è¡Œä¸‹é¢çš„æ“ä½œï¼Œ</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /Applications/ä¼ä¸šå¾®ä¿¡.app/Contents/MacOS</span><br><span class="line">$ ls</span><br><span class="line">WEWTweak.framework insert_dylib       ä¼ä¸šå¾®ä¿¡</span><br><span class="line"><span class="comment"># ç»™ insert_dylib åŠ ä¸€ä¸‹å¯æ‰§è¡Œçš„æƒé™</span></span><br><span class="line">$ chmod +x insert_dylib</span><br><span class="line"><span class="comment"># å¤‡ä»½ä¸€ä¸‹äºŒè¿›åˆ¶æ–‡ä»¶</span></span><br><span class="line">$ cp ä¼ä¸šå¾®ä¿¡ ä¼ä¸šå¾®ä¿¡.bak</span><br><span class="line"><span class="comment"># æŠŠåˆ¶ä½œå¥½çš„ framework é€šè¿‡ insert_dylib æ¤å…¥äºŒè¿›åˆ¶æ–‡ä»¶ä¸­</span></span><br><span class="line">$ ./insert_dylib /Applications/ä¼ä¸šå¾®ä¿¡.app/Contents/MacOS/WEWTweak.framework/WEWTweak ä¼ä¸šå¾®ä¿¡ ä¼ä¸šå¾®ä¿¡ --all-yes</span><br><span class="line"></span><br><span class="line">ä¼ä¸šå¾®ä¿¡ already exists. Overwrite it? [y/n] y</span><br><span class="line">LC_CODE_SIGNATURE load <span class="built_in">command</span> found. Remove it? [y/n] y</span><br><span class="line">Added LC_LOAD_DYLIB to ä¼ä¸šå¾®ä¿¡</span><br></pre></td></tr></table></figure><p>æ¤å…¥æˆåŠŸï¼Œå¯åŠ¨ä¸‹ä¼ä¸šå¾®ä¿¡è¯•è¯•ï¼Œ</p><p><img src="https://s1.ax1x.com/2018/11/25/FkFDIK.png" width="500"></p><p>ç­¾åæ ¡éªŒå¤±è´¥ï¼Œinterestingâ€¦â€¦</p><p><img src="https://s1.ax1x.com/2018/11/25/FkF0Vx.jpg" width="200"></p><blockquote><p>ä¹‹å‰æˆ‘ä¹Ÿæ›¾é€†å‘/ç ´è§£è¿‡ä¸€äº›ç¨‹åºï¼Œæ ¡éªŒäºŒè¿›åˆ¶ä¿¡æ¯çš„è¿˜æ˜¯å¤´ä¸€å›é‡åˆ°ã€‚Good Job ä¼ä¸šå¾®ä¿¡å›¢é˜Ÿï¼</p></blockquote><p>ç‚¹å‡» OKï¼Œå‘ç°ç¨‹åºé€€å‡ºäº†ã€‚è¿™è¯´æ˜ç¨‹åºä¸­æœ‰ <code>exit</code> è°ƒç”¨ï¼Œè¿™æ˜¯çº¿ç´¢å•ŠåŒå­¦ä»¬ï¼Œçº¿ç´¢å°±æ˜¯æ–­ç‚¹å•Šï¼</p><p>é€€å‡ºä¹‹å‰çš„ lldb sessionï¼Œå†å¼€ä¸€ä¸ªï¼Œ</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ lldb -w ä¼ä¸šå¾®ä¿¡</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ exit ä¸Šä¸‹æ–­ç‚¹</span></span><br><span class="line">(lldb) b <span class="built_in">exit</span></span><br><span class="line">Breakpoint 1: 3 locations.</span><br><span class="line"><span class="comment"># å¯åŠ¨ç¨‹åº</span></span><br><span class="line">(lldb) run</span><br></pre></td></tr></table></figure><p>å†æ¬¡ç‚¹å‡» OK æŒ‰é’®ï¼Œlldb æš‚åœäº†ç¨‹åºï¼Œé€šè¿‡ <code>bt</code> æ‰“å°è°ƒç”¨æ ˆï¼Œ</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">(lldb) bt</span><br><span class="line">* thread <span class="comment">#1, queue = 'com.apple.main-thread', stop reason = breakpoint 1.3</span></span><br><span class="line"> * frame <span class="comment">#0: 0x00007fff5d4781a7  libsystem_c.dylib` exit </span></span><br><span class="line">  frame <span class="comment">#1: 0x00007fff2d9498bb  AppKit` -[NSApplication terminate:]  + 1755</span></span><br><span class="line">  frame <span class="comment">#2: 0x000000010055a82f  ä¼ä¸šå¾®ä¿¡` ___lldb_unnamed_symbol29576$$ä¼ä¸šå¾®ä¿¡  + 150</span></span><br><span class="line">  frame <span class="comment">#3: 0x00000001004eb8ce  ä¼ä¸šå¾®ä¿¡` ___lldb_unnamed_symbol26847$$ä¼ä¸šå¾®ä¿¡  + 1035</span></span><br><span class="line">  frame <span class="comment">#4: 0x000000010054f77b  ä¼ä¸šå¾®ä¿¡` ___lldb_unnamed_symbol29391$$ä¼ä¸šå¾®ä¿¡  + 54</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡è°ƒç”¨æ ˆä¸­çš„å‡½æ•°åœ°å€ä¿¡æ¯é…åˆ Hooper çš„ Navigate -&gt; Go to Address or Symbolï¼Œå¯ä»¥ç¡®è®¤è°ƒç”¨æ ˆé•¿è¿™æ ·ï¼Œ</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="meta">#0: -[NSApplication terminate:]</span></span><br><span class="line"><span class="meta">#1: +[WEWApplicationUtils terminate]</span></span><br><span class="line"><span class="meta">#2: -[WEWApplicationLifeCricleObserver applicationDidFinishLaunching]</span></span><br><span class="line"><span class="meta">#3: -[WEWApplicationDelegateWindowController applicationDidFinishLaunching:]</span></span><br></pre></td></tr></table></figure><p><code>#2</code> ä¸­çš„æ–¹æ³•æœ€æœ‰é—®é¢˜ï¼Œé€šè¿‡ Hooper çš„ Pseudo-code å¯¹è¯¥æ–¹æ³•çš„åˆ†æå¦‚ä¸‹ï¼Œ</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> -[WEWApplicationLifeCricleObserver applicationDidFinishLaunching](<span class="keyword">void</span> * <span class="keyword">self</span>, <span class="keyword">void</span> * _cmd) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    rbx = [[<span class="built_in">NSBundle</span> mainBundle] <span class="keyword">retain</span>];</span><br><span class="line">    r14 = [[rbx executablePath] <span class="keyword">retain</span>];</span><br><span class="line">    [rbx release];</span><br><span class="line">    r15 = [<span class="built_in">NSTemporaryDirectory</span>() <span class="keyword">retain</span>];</span><br><span class="line">    rbx = [[r15 stringByAppendingPathComponent:^ &#123; <span class="comment">/* block implemented at sub_1004ebb58 */</span> &#125;] <span class="keyword">retain</span>];</span><br><span class="line">    [r15 release];</span><br><span class="line">    rax = objc_retainAutorelease(r14);</span><br><span class="line">    var_50 = rax;</span><br><span class="line">    r15 = [rax UTF8String];</span><br><span class="line">    rax = objc_retainAutorelease(rbx);</span><br><span class="line">    var_48 = rax;</span><br><span class="line">    rbx = sub_100b16d72(r15, [rax UTF8String], <span class="string">@"tmp_exe"</span>);</span><br><span class="line">    r14 = sub_100b170c4();</span><br><span class="line">    <span class="comment">// some check...</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤§æ„å°±æ˜¯ï¼Œé€šè¿‡ <code>[NSBundle mainBundle] executablePath]</code> æ¥è·å–ä¼ä¸šå¾®ä¿¡çš„äºŒè¿›åˆ¶è·¯å¾„ï¼Œç„¶åæŠŠå®ƒå¤åˆ¶ä¸€ä»½åˆ°ä¸€ä¸ªä¸´æ—¶ç›®å½•ä¸­ï¼Œå‘½åä¸º <code>tmp_exe</code> ç„¶åå¯¹æ­¤æ–‡ä»¶è¿›è¡Œä¸€äº› check æ¥ç¡®è®¤è¿™ä»½äºŒè¿›åˆ¶æ˜¯å¦è¢«ä¿®æ”¹è¿‡ã€‚</p><p>è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•è¿˜æ˜¯æœ‰å¾ˆå¤šç§ï¼Œå¯ä»¥é€‰æ‹© hook ä¸‹é¢é‚£äº› check çš„ C æ–¹æ³•ï¼Œæˆ–è€…è®©è¿™ä¸ªæ–¹æ³•è¿è¡Œä¸€åŠå°±è¿”å›ã€‚æˆ‘é€‰æ‹©çš„æ–¹å¼æ˜¯ä¿®æ”¹ <code>[NSBundle mainBundle] executablePath]</code> æ–¹æ³•çš„è¿”å›å€¼ï¼Œåæ­£æˆ‘ä»¬éƒ½è¦å¤‡ä»½æœ€ç»ˆçš„äºŒè¿›åˆ¶ï¼Œé‚£å¹²è„†è®©è¿™ä¸ªæ–¹æ³•æŒ‡å‘å¤‡ä»½çš„æ–‡ä»¶å¥½äº† ğŸ˜Œ</p><p>ä¿®æ”¹ framework ä¸­çš„åˆ†ç±»æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œ</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;JRSwizzle/JRSwizzle.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSObject</span> (<span class="title">WEWTweak</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    [objc_getClass(<span class="string">"WEWConversation"</span>)</span><br><span class="line">     jr_swizzleMethod:<span class="built_in">NSSelectorFromString</span>(<span class="string">@"isConversationSupportWaterMark"</span>)</span><br><span class="line">     withMethod:<span class="keyword">@selector</span>(wew_isConversationSupportWaterMark)</span><br><span class="line">     error:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">    [<span class="built_in">NSBundle</span> jr_swizzleMethod:<span class="keyword">@selector</span>(executablePath)</span><br><span class="line">                    withMethod:<span class="keyword">@selector</span>(wew_executablePath)</span><br><span class="line">                         error:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)wew_executablePath &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">@"/Applications/ä¼ä¸šå¾®ä¿¡.app/Contents/MacOS/ä¼ä¸šå¾®ä¿¡.bak"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)wew_isConversationSupportWaterMark &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p>å†ç¼–è¯‘ä¸€æ¬¡ç¨‹åºï¼ŒæŠŠ <code>WEWTweak.framework</code> æ‹–å…¥ <code>/Applications/ä¼ä¸šå¾®ä¿¡.app/Contents/MacOS/</code> è¦†ç›–ï¼Œç„¶åå†æ‰§è¡Œä¸€æ¬¡ä¸‹é¢çš„ä»£ç ï¼Œ</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ ./insert_dylib /Applications/ä¼ä¸šå¾®ä¿¡.app/Contents/MacOS/WEWTweak.framework/WEWTweak ä¼ä¸šå¾®ä¿¡ ä¼ä¸šå¾®ä¿¡ --all-yes</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ä¼ä¸šå¾®ä¿¡ï¼Œæ°´å°ä¸è§äº† ğŸ‰</p><h2 id="0x05-ç»“å°¾"><a href="#0x05-ç»“å°¾" class="headerlink" title="0x05 ç»“å°¾"></a>0x05 ç»“å°¾</h2><p>æ„Ÿè°¢ <a href="https://github.com/Sunnyyoung/WeChatTweak-macOS" target="_blank" rel="noopener">Sunnyyoung/WeChatTweak-macOS</a> é¡¹ç›®ï¼Œæˆ‘åœ¨å…¶ä¸­æŠ„äº†å¥½å‡ æ®µä»£ç  ğŸŒ¸</p><p>æœ¬æ–‡çš„å®Œæ•´ä»£ç è§è¿™é‡Œ <a href="https://github.com/X140Yu/WEWTweak" target="_blank" rel="noopener">X140Yu/WEWTweak</a>ï¼Œå¦‚æœæœ¬æ–‡æˆ–è€…è¿™ä¸ªåº“å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ star å“¦ ğŸŒŸ</p><p>å¦‚æœä½ å‘ç°æ–‡ç« ä¸­æœ‰ä»»ä½•å†™å¾—ä¸å¯¹çš„åœ°æ–¹ï¼Œæˆ–è€…æœ‰ä»»ä½•æƒ³æ³•ï¼Œéƒ½æ¬¢è¿åœ¨è¯„è®ºåŒºé‡Œè·Ÿæˆ‘äº¤æµ ğŸ™†â€â™‚ï¸</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;0x01-èµ·å› &quot;&gt;&lt;a href=&quot;#0x01-èµ·å› &quot; class=&quot;headerlink&quot; title=&quot;0x01 èµ·å› &quot;&gt;&lt;/a&gt;0x01 èµ·å› &lt;/h2&gt;&lt;p&gt;æœ€è¿‘å› ä¸ºæŸäº›åŸå› ï¼Œå…¬å¸å‡†å¤‡æŠŠç”¨äº†å¥½å¤šå¹´çš„ Slack æ¢æˆä¼ä¸šå¾®ä¿¡ã€‚è¿™å…¶å®æ˜¯ä»¶æŒºæ­£å¸¸çš„äº‹æƒ…ï¼Œå…¬å¸åœ¨ä¸åœåœ°å‘å±•ï¼Œä»€ä¹ˆæ ·çš„å˜åŒ–éƒ½æœ‰å¯èƒ½ä¼šå‘ç”Ÿã€‚è¯´ä¸å®šå…¬å¸åœ¨åšå¤§åˆ°ä¸€å®šç¨‹åº¦ä»¥åï¼Œåšè‡ªå·±çš„ IM ä¹Ÿä¸ä¸€å®šã€‚&lt;/p&gt;
&lt;p&gt;ä½†å¦‚æœä¹‹å‰æ²¡æœ‰ç”¨è¿‡ Slack è¿˜å¥½ï¼Œä½†åœ¨ç”¨è¿‡å‡ å¹´ä¹‹åï¼Œå°±ä¸å…ä¼šæŠŠå®ƒä¸ä¼ä¸šå¾®ä¿¡ä¹‹é—´åšä¸€äº›å¯¹æ¯”ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å–œæ¬¢ Slack çš„ &lt;a href=&quot;https://get.slack.help/hc/en-us/articles/115000769927-Message-and-file-threads&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Message and file threads&lt;/a&gt;ã€ &lt;a href=&quot;https://get.slack.help/hc/en-us/articles/206870317-Emoji-reactions&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Emoji reactions&lt;/a&gt; è¿˜æœ‰å®ƒä¾¿æ·çš„ &lt;a href=&quot;https://api.slack.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;API&lt;/a&gt;ï¼Œè¿™å‡ ç‚¹ä¼ä¸šå¾®ä¿¡éƒ½åšçš„ä¸å¤ªå¥½ï¼Œç”šè‡³æ²¡æœ‰ã€‚è¿™è¿˜æŒºè®©äººå¤±æœ›çš„ã€‚&lt;/p&gt;
&lt;p&gt;è€Œä¸”å®ƒçš„æ°´å°çœŸçš„å¾ˆé­”æ€§ï¼Œåœ¨èŠå¤©ç•Œé¢å¾ˆæ˜¾çœ¼ã€‚æ‰€ä»¥æˆ‘å†³å®šç”¨æˆ‘ä»…æœ‰çš„ä¸€ç‚¹ç‚¹&lt;del&gt;é€†å‘å·¥ç¨‹&lt;/del&gt;ç ´è§£çŸ¥è¯†ï¼Œæ¥æŠŠå®ƒçš„æ°´å°ä»èŠå¤©ç•Œé¢ä¸­å»é™¤ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Objective-C" scheme="https://x140yu.github.io/tags/Objective-C/"/>
    
      <category term="é€†å‘å·¥ç¨‹" scheme="https://x140yu.github.io/tags/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/"/>
    
      <category term="lldb" scheme="https://x140yu.github.io/tags/lldb/"/>
    
  </entry>
  
  <entry>
    <title>KeyPath in iOS</title>
    <link href="https://x140yu.github.io/2018-11-02-KeyPath/"/>
    <id>https://x140yu.github.io/2018-11-02-KeyPath/</id>
    <published>2018-11-01T16:00:00.000Z</published>
    <updated>2019-08-19T07:43:25.676Z</updated>
    
    <content type="html"><![CDATA[<h2 id="KeyPath-in-Objective-C"><a href="#KeyPath-in-Objective-C" class="headerlink" title="KeyPath in Objective-C"></a>KeyPath in Objective-C</h2><p>çœ‹ä¸‹é¢ä¸¤æ®µ Objective-C çš„ä»£ç ï¼Œ</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// KVC</span></span><br><span class="line">[someObject setValue:someValue forKey:<span class="string">@"someKey"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// KVO</span></span><br><span class="line">[account addObserver:<span class="keyword">self</span></span><br><span class="line">          forKeyPath:<span class="string">@"balance"</span></span><br><span class="line">             options:<span class="built_in">NSKeyValueObservingOptionNew</span></span><br><span class="line">             context:PersonAccountBalanceContext];</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å­˜åœ¨çš„ä¸€ä¸ªå…±åŒé—®é¢˜æ˜¯ <code>KeyPath</code> å‚æ•°çš„ç±»å‹ã€‚<code>NSString *</code> ä»£è¡¨ä½ å’Œæ‰€è°“çš„ç¼–è¯‘æ£€æŸ¥å°±æ²¡æœ‰ä»€ä¹ˆå…³ç³»äº†ã€‚åœ¨æœªæ¥çš„æŸä¸€å¤©ï¼Œå¦‚æœ property çš„åå­—å‘ç”Ÿäº†å˜åŒ–ï¼Œä»£ç å°±ä¼šå‡ºç°é—®é¢˜ã€‚æ‰€ä»¥ Objective-C ä¸­çš„ KeyPath å¹¶ä¸å®‰å…¨ï¼ˆè¿™æ ·çš„ä¾‹å­åœ¨ Objective-C ä¸­å¹¶ä¸å°‘è§ï¼‰ã€‚</p><a id="more"></a><p><a href="https://github.com/jspahrsummers/libextobjc/blob/master/extobjc/EXTKeyPathCoding.h#L38" target="_blank" rel="noopener">extobjc æä¾›çš„ @keypath å®</a> ä¸º KeyPath æä¾›äº†ç¼–è¯‘æ—¶æœŸçš„æ£€æŸ¥ã€‚å¦‚æœæœªæ¥ KeyPath å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šäº§ç”Ÿç¼–è¯‘é”™è¯¯ã€‚</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">@keypath(<span class="built_in">NSURL</span>.new, baseURL);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰äº</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œè¿™ä¸ªè¡¨è¾¾å¼ `NSURL.new.baseURL` ä¼šè¢«æ‰§è¡Œï¼Œå¦‚æœè¿™ä¸ª KeyPath ä¸å­˜åœ¨ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="comment">// è¡¨è¾¾å¼åªä¼šè¢«æ‰§è¡Œï¼Œä½†çœŸæ­£çš„è¿”å›å€¼æ˜¯æœ€åçš„ `@"baseURL"`</span></span><br><span class="line">((<span class="built_in">NSString</span> * _Nonnull)@((((<span class="keyword">void</span>)(<span class="literal">NO</span> &amp;&amp; ((<span class="keyword">void</span>)<span class="built_in">NSURL</span>.new.baseURL, <span class="literal">NO</span>)), <span class="string">"baseURL"</span>))));</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„ APIï¼Œåœ¨ Swift é‚£è¾¹è°ƒç”¨æƒ³å¿…ä¼šæœ‰ç±»ä¼¼çš„é—®é¢˜ï¼Œé‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•è§£å†³ï¼Ÿ</p><h2 id="KeyPath-in-Swift"><a href="#KeyPath-in-Swift" class="headerlink" title="KeyPath in Swift"></a>KeyPath in Swift</h2><h3 id="keyPath"><a href="#keyPath" class="headerlink" title="#keyPath()"></a><code>#keyPath()</code></h3><p><code>#keyPath()</code> æ˜¯ Swift åœ¨ <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0062-objc-keypaths.md" target="_blank" rel="noopener">3.0 ç‰ˆæœ¬å®ç°çš„</a>ç±»ä¼¼äºä¸Šæ–‡æåˆ°çš„ <code>@keypath</code> çš„è¡¨è¾¾å¼ï¼Œä½†è¦æ¯” <code>@keypath</code> è¦æ›´å¼ºå¤§ä¸€äº›ï¼ˆæ¯•ç«Ÿå®ƒæ˜¯åœ¨<a href="https://github.com/apple/swift/commit/9f0cec4984d7bb23eb242d9eca7c82039310f52d" target="_blank" rel="noopener">è¯­è¨€å±‚é¢çš„å®ç°</a>ï¼‰ï¼Œåœ¨ä¼ é€’å‚æ•°çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>UILabel.text</code> è€Œä¸éœ€è¦å¯¹åº”çš„å®ä¾‹å­˜åœ¨(<code>label.text</code>)ã€‚</p><p>å®ç°å®ƒçš„ä¸»è¦ç›®çš„æ˜¯åœ¨ä½¿ç”¨ Swift è°ƒç”¨ä¸ Objective-C ç›¸å…³éœ€è¦ <code>String</code> ç±»å‹ KeyPath çš„ API æ—¶ï¼Œæä¾›å¸¦æœ‰ç¼–è¯‘æ£€æŸ¥çš„ï¼Œæ›´  å®‰å…¨çš„è°ƒç”¨æ–¹å¼ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// KVC</span></span><br><span class="line">label.setValue(<span class="string">"value"</span>, forKey: #keyPath(<span class="type">UILabel</span>.text))</span><br><span class="line"></span><br><span class="line"><span class="comment">// KVO</span></span><br><span class="line">label.addObserver(<span class="keyword">self</span>,</span><br><span class="line">                  forKeyPath: #keyPath(<span class="type">UILabel</span>.text),</span><br><span class="line">                  options: .new,</span><br><span class="line">                  context: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure><p>é‚£å¦‚æœæ˜¯é NSObject å­ç±»çš„çº¯ Swift ç±»(æ¯”å¦‚ struct)ï¼Œæ˜¯å¦‚ä½•ä½¿ç”¨ KeyPath çš„å‘¢ï¼Ÿ</p><h3 id="KeyPath-lt-Root-Value-gt"><a href="#KeyPath-lt-Root-Value-gt" class="headerlink" title="KeyPath&lt;Root, Value&gt;"></a><code>KeyPath&lt;Root, Value&gt;</code></h3><p>4.0 ç‰ˆæœ¬ï¼ŒSwift <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0161-key-paths.md" target="_blank" rel="noopener">å®ç°äº†</a>æ›´å¥½æ›´å®‰å…¨çš„ KVC APIï¼Œå¼•å…¥äº† <code>KeyPath</code> è¿™ä¸ªç±»å‹ã€‚</p><p>åŒæ ·çš„ KVC è°ƒç”¨åœ¨ Swift ä¸­æ˜¯è¿™æ ·å†™çš„ï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> label = <span class="type">UILabel</span>()</span><br><span class="line">label.text = <span class="string">"abc"</span> <span class="comment">// KeyPath&lt;UILabel, String&gt;</span></span><br><span class="line">label[keyPath: \<span class="type">UILabel</span>.text] <span class="comment">// "abc"</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­çš„ <code>\UILabel.text</code> çš„ç±»å‹å°±æ˜¯ä¸€ä¸ª <code>KeyPath&lt;UILabel, String&gt;</code>ã€‚ç¼–è¯‘å™¨ä¸å…‰èƒ½å¤Ÿç¡®ä¿ä½ åœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ KeyPath ä¸€å®šåœ¨ï¼Œè¿˜èƒ½é€šè¿‡ Value çš„ç±»å‹æ¨æ–­è¿”å›å€¼ã€‚è¿™æ˜¯ç›¸æ¯” Objective-C API çš„ä¸€ä¸ªå¾ˆå¤§çš„æå‡ã€‚</p><p>é€šè¿‡ KeyPath è·å–åˆ°çš„å¯¹è±¡æ˜¯ readonly çš„ï¼Œå¦‚æœéœ€è¦å¯¹ç»“æœè¿›è¡Œä¿®æ”¹ï¼Œéœ€è¦ä½¿ç”¨ä¸‹é¢ä¸¤ä¸ªç±»å‹ï¼Œ</p><ul><li>WritableKeyPath</li><li>ReferenceWritableKeyPath</li></ul><p>å‰è€…åªèƒ½ä¿®æ”¹å£°æ˜ä¸º <code>var</code> å¯¹è±¡(struct å’Œ class) KeyPath çš„ valueï¼Œåè€…å¯ä»¥ä¿®æ”¹ class å¯¹è±¡å¯¹åº” KeyPath çš„ value</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fruit</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name = <span class="string">"Apple"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// a let class object's KeyPath value can not be modified by WritableKeyPath</span></span><br><span class="line"><span class="keyword">let</span> f = <span class="type">Fruit</span>() </span><br><span class="line"><span class="keyword">let</span> keyPath: <span class="type">WritableKeyPath</span>&lt;<span class="type">Fruit</span>, <span class="type">String</span>&gt; = \<span class="type">Fruit</span>.name</span><br><span class="line">f[keyPath: keyPath] = <span class="string">"Banana"</span> <span class="comment">// âŒ Cannot assign to immutable expression of type 'String'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// this will work</span></span><br><span class="line"><span class="keyword">var</span> f = <span class="type">Fruit</span>()</span><br><span class="line"><span class="keyword">let</span> keyPath: <span class="type">WritableKeyPath</span>&lt;<span class="type">Fruit</span>, <span class="type">String</span>&gt; = \<span class="type">Fruit</span>.name</span><br><span class="line">f[keyPath: keyPath] = <span class="string">"Banana"</span> <span class="comment">// f.name ... "Banana"</span></span><br><span class="line">f[keyPath: \<span class="type">Fruit</span>.name] = <span class="string">"Orange"</span> <span class="comment">// default is ReferenceWritable f.name ... "organ"</span></span><br></pre></td></tr></table></figure><p>Swift ä¸­çš„ KeyPath å¾ˆçµæ´»ï¼Œå†åŠ ä¸Š Swift å¼ºå¤§çš„ç±»å‹ç³»ç»Ÿï¼Œå¯ä»¥å®ç°å¾ˆå¤šæ–¹ä¾¿æœ‰è¶£çš„åŠŸèƒ½ã€‚ä½†å®ƒä¹Ÿæœ‰ç¼ºç‚¹ã€‚ä½ ä¸èƒ½åƒä½¿ç”¨ Objective-C é‚£æ ·é€šè¿‡ <code>valueForKey:</code> è·å–ä»»æ„ä¸€ä¸ªå¯¹è±¡æŸä¸ª KeyPath ä¸‹çš„å±æ€§ï¼ˆæ¯”å¦‚åœ¨ç±»å¤–ç”Ÿæˆå®ƒ private property çš„ KeyPathï¼‰ï¼Œæˆ–é€šè¿‡ <code>setValue:ForKey:</code> å¯¹ä»»æ„ KeyPath è®¾ç½® valueã€‚ä½†å¦‚æœä½ å¯¹è¿™æ ·çš„ Hack æ„Ÿå…´è¶£ï¼Œæˆ–è®¸ä½ åº”è¯¥çœ‹çœ‹ Swift ä¸­çš„ <a href="https://developer.apple.com/documentation/swift/mirror" target="_blank" rel="noopener">Mirror</a> ç±»å‹æˆ–è€… <a href="https://github.com/Zewo/Reflection" target="_blank" rel="noopener">Reflection</a> è¿™æ ·çš„ libraryã€‚Use it under your own riskï¼Œæˆ‘çš„å»ºè®®è¿˜æ˜¯èƒ½ä¸ç”¨å°±ä¸è¦ç”¨ï¼Œè¿˜æ˜¯ä»¥å®‰å…¨æ€§ä¸ºä¸»ã€‚</p><h2 id="KeyPath-çš„åº”ç”¨"><a href="#KeyPath-çš„åº”ç”¨" class="headerlink" title="KeyPath çš„åº”ç”¨"></a>KeyPath çš„åº”ç”¨</h2><h3 id="Foundation"><a href="#Foundation" class="headerlink" title="Foundation"></a>Foundation</h3><p>å¯¹äº Foundation ä¸­ä¸€äº›ä½¿ç”¨ String ä½œä¸º KeyPath çš„æ—§ APIï¼ŒSwift æ·»åŠ äº†æ–°çš„ KeyPath&lt;Root, Value&gt; ç±»å‹å‚æ•°çš„æ–° API æ”¯æŒï¼Œæ¯”å¦‚ï¼Œ</p><ul><li><a href="https://github.com/apple/swift/blob/6b68303997d25128c62264371e1ab1c04dc430ed/stdlib/public/SDK/Foundation/NSSortDescriptor.swift#L17" target="_blank" rel="noopener">NSSortDescriptor</a></li><li><a href="https://github.com/apple/swift/blob/6b68303997d25128c62264371e1ab1c04dc430ed/stdlib/public/SDK/Foundation/NSExpression.swift#L26" target="_blank" rel="noopener">NSExpression</a></li><li><a href="https://github.com/apple/swift/blob/6b68303997d25128c62264371e1ab1c04dc430ed/stdlib/public/SDK/Foundation/NSObject.swift#L195" target="_blank" rel="noopener">KVO</a></li></ul><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NSSortDescriptor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">convenience</span> <span class="keyword">init</span>&lt;<span class="type">Root</span>, <span class="type">Value</span>&gt;(keyPath: <span class="type">KeyPath</span>&lt;<span class="type">Root</span>, <span class="type">Value</span>&gt;, ascending: <span class="type">Bool</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NSExpression</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">convenience</span> <span class="keyword">init</span>&lt;<span class="type">Root</span>, <span class="type">Value</span>&gt;(forKeyPath keyPath: <span class="type">KeyPath</span>&lt;<span class="type">Root</span>, <span class="type">Value</span>&gt;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> _KeyValueCodingAndObserving </span>&#123;</span><br><span class="line">    <span class="comment">///when the returned NSKeyValueObservation is deinited or invalidated, it will stop observing</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">observe</span>&lt;Value&gt;<span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="number">_</span> keyPath: KeyPath&lt;<span class="keyword">Self</span>, Value&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">            options: NSKeyValueObservingOptions = [],</span></span></span><br><span class="line"><span class="function"><span class="params">            changeHandler: @escaping <span class="params">(<span class="keyword">Self</span>, NSKeyValueObservedChange&lt;Value&gt;)</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line">        -&gt; <span class="type">NSKeyValueObservation</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…¶å®ƒåº”ç”¨"><a href="#å…¶å®ƒåº”ç”¨" class="headerlink" title="å…¶å®ƒåº”ç”¨"></a>å…¶å®ƒåº”ç”¨</h3><p>è¿˜æœ‰ä¸€äº›å…¶å®ƒä¼˜ç§€çš„å…³äº Swift KeyPath çš„åº”ç”¨ï¼Œå¯ä»¥ç¿»ç¿»çœ‹ï¼Œ</p><ul><li><a href="https://www.objc.io/blog/2018/04/24/bindings-with-kvo-and-keypaths/" target="_blank" rel="noopener">https://www.objc.io/blog/2018/04/24/bindings-with-kvo-and-keypaths/</a></li><li><a href="http://www.chris.eidhof.nl/post/micro-autolayout-dsl/" target="_blank" rel="noopener">http://www.chris.eidhof.nl/post/micro-autolayout-dsl/</a></li><li><a href="https://www.swiftbysundell.com/posts/the-power-of-key-paths-in-swift" target="_blank" rel="noopener">https://www.swiftbysundell.com/posts/the-power-of-key-paths-in-swift</a></li></ul><p>å¸Œæœ›å¤§å®¶ä»æˆ‘åšèµ·ï¼Œæ‹’ç»å­—ç¬¦ä¸²ç¼–ç¨‹ ğŸ™…ğŸ»â€â™‚ï¸</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;KeyPath-in-Objective-C&quot;&gt;&lt;a href=&quot;#KeyPath-in-Objective-C&quot; class=&quot;headerlink&quot; title=&quot;KeyPath in Objective-C&quot;&gt;&lt;/a&gt;KeyPath in Objective-C&lt;/h2&gt;&lt;p&gt;çœ‹ä¸‹é¢ä¸¤æ®µ Objective-C çš„ä»£ç ï¼Œ&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// KVC&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[someObject setValue:someValue forKey:&lt;span class=&quot;string&quot;&gt;@&quot;someKey&quot;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// KVO&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[account addObserver:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          forKeyPath:&lt;span class=&quot;string&quot;&gt;@&quot;balance&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             options:&lt;span class=&quot;built_in&quot;&gt;NSKeyValueObservingOptionNew&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             context:PersonAccountBalanceContext];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸Šé¢çš„ä»£ç å­˜åœ¨çš„ä¸€ä¸ªå…±åŒé—®é¢˜æ˜¯ &lt;code&gt;KeyPath&lt;/code&gt; å‚æ•°çš„ç±»å‹ã€‚&lt;code&gt;NSString *&lt;/code&gt; ä»£è¡¨ä½ å’Œæ‰€è°“çš„ç¼–è¯‘æ£€æŸ¥å°±æ²¡æœ‰ä»€ä¹ˆå…³ç³»äº†ã€‚åœ¨æœªæ¥çš„æŸä¸€å¤©ï¼Œå¦‚æœ property çš„åå­—å‘ç”Ÿäº†å˜åŒ–ï¼Œä»£ç å°±ä¼šå‡ºç°é—®é¢˜ã€‚æ‰€ä»¥ Objective-C ä¸­çš„ KeyPath å¹¶ä¸å®‰å…¨ï¼ˆè¿™æ ·çš„ä¾‹å­åœ¨ Objective-C ä¸­å¹¶ä¸å°‘è§ï¼‰ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Objective-C" scheme="https://x140yu.github.io/tags/Objective-C/"/>
    
      <category term="Swift" scheme="https://x140yu.github.io/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>é¦™æ¸¯å°è±¡</title>
    <link href="https://x140yu.github.io/2018-09-03-trip-to-hk/"/>
    <id>https://x140yu.github.io/2018-09-03-trip-to-hk/</id>
    <published>2018-09-02T16:00:00.000Z</published>
    <updated>2019-08-19T07:43:25.676Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡çš„å¤§éƒ¨åˆ†å…§å®¹éƒ½æ˜¯äº”æœˆä»½åœ¨é¦™æ¸¯çš„æ™‚å€™ç”¨ Notes è¨˜ä¸‹çš„ï¼Œä½†å› ç‚ºæ‡¶ï¼Œæ‹–åˆ°ä»Šå¤©æ‰æ•´ç† ğŸ™ˆ<br>å› ç‚ºå†…å®¹å…³äºé¦™æ¸¯ï¼Œæ‰€ä»¥ç´¢æ€§å°±ç”¨ç¹é«”å¥½äº†</p></blockquote><p>äº”æœˆä¸­æ—¬è¨ˆåŠƒå»æ³°åœ‹ç©ä¸€ç©ï¼Œè¨‚æ©Ÿç¥¨çš„æ™‚å€™ç™¼ç¾å¾é¦™æ¸¯è½‰æ©Ÿå†éå»æ¸…é‚æœƒä¾¿å®œä¸€äº›ï¼Œè€Œä¸”ç¶“éé¦™æ¸¯å»å…¶å®ƒåœ‹å®¶ä¸¦ä¸éœ€è¦æä¾›é¦™æ¸¯çš„ç°½è¨»ï¼Œåªè¦åœ¨å…¥å¢ƒçš„æ™‚å€™æä¾›ä¸€ä¸‹å¾Œé¢çš„è¡Œç¨‹å–®å°±å¯ä»¥äº†ã€‚</p><a id="more"></a><p><a href="https://imgchr.com/i/i9k1IK" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/i9k1IK.md.jpg" alt="æ©Ÿå ´å¿«è»Œ"></a></p><h2 id="å»å¸‚å…§"><a href="#å»å¸‚å…§" class="headerlink" title="å»å¸‚å…§"></a>å»å¸‚å…§</h2><p>åœ¨æ©Ÿå ´å‡ºä¾†ä»¥å¾Œè¨˜å¾—è²·ä¸€å¼µå…«é”é€šï¼Œå›ç¨‹çš„æ™‚å€™åœ¨ç›¸åŒçš„åœ°æ–¹å°±èƒ½é€€æ¬¾ã€‚å…«é”é€šåœ¨é¦™æ¸¯çš„æ‰€æœ‰çš„äº¤é€šå·¥å…·ä¸Šéƒ½èƒ½ä½¿ç”¨ï¼ŒåŒ…æ‹¬åœ°éµã€å·´å£«ã€è¼ªæ¸¡ã€å±±é ‚çºœè»Šç­‰ç­‰ï¼Œä¾¿åˆ©åº—å•¦é¤å»³å•¦ä¹Ÿéƒ½æ”¯æŒä½¿ç”¨ï¼Œå»ºè­°å¤šå……ä¸€é»ã€‚</p><p>å¾æ©Ÿå ´å»å¸‚å…§çš„è©±å¯ä»¥é¸æ“‡æ©Ÿå ´å¿«è»Œæˆ–è€…æ­å·´å£«ã€‚æ©Ÿå ´å¿«è»Œè²´ä¸€äº›ï¼Œä½†é€Ÿåº¦å¿«ä¸å°‘ã€‚ä½†å·´å£«ç·šè·¯é¸æ“‡æœƒå¤šä¸€äº›ï¼Œä¸€è·¯é«˜é€Ÿæ²¿è‘—æµ·ï¼Œé¢¨æ™¯é‚„ä¸éŒ¯ã€‚</p><p>å¾æ©Ÿå ´å¿«è»Œä¸‹ä¾†ä»¥å¾Œï¼Œæƒ³æŒ‰è‘—åœ°åœ–æ­¥è¡Œåˆ°é…’åº—ï¼Œä½†å›°åœ¨ä¸€å€‹èŠ±åœ’ä¼¼çš„å°å€è£ï¼Œæ€éº¼ä¹Ÿæ‰¾ä¸åˆ°å‡ºå£ã€‚å› ç‚ºæ‹–è‘—è¡Œæï¼Œå¯¦åœ¨ä¸æƒ³å†ç¹åœˆå­äº†ï¼Œå°±å‘ä¸€å€‹é˜¿å§¨å•äº†è·¯ã€‚å¥¹çœ‹å‡ºäº†æˆ‘å€‘æ˜¯å¤§é™¸äººï¼Œè©±ä¹Ÿæ²’å¤šèªªï¼Œåšå‡ºã€Œè·Ÿæˆ‘èµ°ã€çš„æ‰‹å‹¢ä¾†ã€‚é˜¿å§¨çš„é€Ÿåº¦å¾ˆå¿«ï¼Œæˆ‘å€‘è·Ÿåœ¨å¥¹çš„å¾Œé¢ä¸€è·¯å°è·‘ã€‚å¥¹èµ°ä¸€æ®µè·¯å°±å›é ­çœ‹ä¸€çœ¼ï¼Œç”Ÿæ€•æˆ‘å€‘æ²’æœ‰è·Ÿä¸Šã€‚åˆ°äº†çµ‚é»é™„è¿‘ï¼Œæ€•æˆ‘å€‘è½ä¸æ‡‚ï¼Œå°±èªªäº†å¹¾å¥è‹±èªï¼Œå‘Šè¨´æˆ‘å€‘æ²¿è‘—é€™æ¢è·¯èµ°å°±å¯ä»¥å‡ºå»ï¼Œç„¶å¾Œå°±è½‰èº«åŸè·¯è¿”å›äº†ã€‚æˆ‘ä¸€ç›´èªªè‘—è¬è¬ï¼Œå¿ƒè£æš–æš–çš„ã€‚</p><p><a href="https://imgchr.com/i/ipPmlR" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipPmlR.md.png" alt="è¡—é“]"></a></p><p>ä¸‹æ¦»çš„é…’åº—çš„é›»æ¢¯å£æœƒæä¾›ä¹¾æ´—çš„æ´—æ‰‹æ¶²ï¼Œè€Œä¸”é›»æ¢¯å…§é‚„è²¼è‘—æ¯å…©å°æ™‚æ¶ˆæ¯’ä¸€æ¬¡çš„æ¨™èªŒã€‚é›–ç„¶å°±æ˜¯å¤§é™¸å¿«æ·é…’åº—çš„æª”æ¬¡ï¼Œä½†åœ¨ä¹¾æ·¨é€™ä¸€é»ä¸Šï¼Œåšå¾—è¶³å¤ è®“äººæ”¾å¿ƒã€‚</p><p><a href="https://imgchr.com/i/ipCUdU" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipCUdU.md.jpg" alt="hotel"></a></p><h2 id="äº¤é€š"><a href="#äº¤é€š" class="headerlink" title="äº¤é€š"></a>äº¤é€š</h2><p>é¦™æ¸¯å¾ˆå¤§ï¼Œä¹Ÿå¾ˆå¯†é›†ã€‚é¡ä¼¼é•·å®‰è¡—é‚£ç¨®å¯¬å¹¾åç±³çš„å¾ˆå¤šæ¢è»Šé“æ˜¯å¹¾ä¹ä¸å­˜åœ¨çš„ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æ¯”è¼ƒçª„çš„è»Šé“ã€‚é›–ç„¶è»Šé“çª„ï¼Œä½†è»Šä¸¦æ²’æœ‰é–‹å¾—å¾ˆæ…¢ã€‚</p><p>è¡Œäººéƒ½æœƒç­‰ç´…ç‡ˆï¼Œè‡³å°‘æˆ‘åœ¨é¦™æ¸¯é€™å…©å¤©æ²’æœ‰çœ‹åˆ°éé—–ç´…ç‡ˆçš„ç¾è±¡ï¼ˆæˆ–è¨±æ˜¯å› ç‚ºè»Šé€Ÿå¤ªå¿«äº†ï¼ŸğŸŒšï¼‰ï¼Œé€™é»è¦çµ¦å€‹å¤§å¤§çš„è´Šã€‚</p><p>æˆ‘å¾ˆå–œæ­¡ä¿¡è™Ÿç‡ˆç™¼å‡ºçš„æç¤ºéŸ³ï¼Œå°æ®˜éšœäººå£«éå¸¸å‹å¥½ã€‚å¦‚æœåœ¨ç­‰ç´…ç‡ˆæ™‚ä½é ­ç©æ‰‹æ©Ÿï¼Œæœ‰äº†é€™å€‹æç¤ºéŸ³ä¹Ÿä¸æœƒéŒ¯éç¶ ç‡ˆã€‚</p><p>å°äº†ï¼Œé‚„æœ‰å¹¾ä¹æ¯æ¢äººè¡Œæ©«é“ä¸Šéƒ½æœƒå°åˆ·çš„ã€Œæœ›å·¦ã€ã€Œæœ›å³ã€æç¤ºè¡Œäººéé¦¬è·¯è¦å·¦å³çœ‹ï¼Œä¹Ÿæ‡‰è©²ç®—é¦™æ¸¯çš„ä¸€å¤§ç‰¹é»ã€‚</p><p><a href="https://imgchr.com/i/ipPuOx" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipPuOx.md.png" alt="æœ›å·¦]"></a></p><p>è»Šæ‡‰è©²æ˜¯é¦™æ¸¯çš„ä¸€å¤§ç‰¹è‰²ã€‚é€™è£çš„è»Šéƒ½å¾ˆå¹¹å‡ˆï¼Œä¸æœƒåƒåŒ—äº¬ä¸€æ¨£ï¼Œå¥½å¤šè»Šéƒ½é«’é«’çš„ã€‚æ”¹è£è»Šçš„æ¯”ä¾‹ä¹Ÿé«˜ä¸€äº›ã€‚</p><p><a href="https://imgchr.com/i/ipCjYQ" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipCjYQ.md.jpg" alt="ipCjYQ.md.jpg"></a></p><p> ğŸ‘† è¼•å¾®çš„æ”¹è£</p><p><a href="https://imgchr.com/i/ipCvWj" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipCvWj.md.jpg" alt="ipCvWj.md.jpg"></a></p><p> ğŸ‘† å¤§è»Šå¥—å°è»Š</p><p><a href="https://imgchr.com/i/ipPiwT" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipPiwT.md.jpg" alt="ipPiwT.md.jpg"></a></p><p> ğŸ‘† èŒèŒçš„é‹è²¨è»Šï¼Œå¤§å®¶çœŸçš„éƒ½å¾ˆæ„›è»Šã€‚</p><p>è»Šç‰Œæ˜¯é¦™æ¸¯çš„ä¸€å¤§äº®é»ã€‚é€™è£çš„è»Šç‰Œå¯ä»¥äº¤æ˜“ï¼Œæ‰€ä»¥æœ‰å¾ˆå¤šå¾ˆé…·ç‚«çš„è»Šç‰Œã€‚æ”¾å¹¾å€‹æˆ‘æ‹åˆ°çš„ï¼Œ</p><p><a href="https://imgchr.com/i/ipCysx" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipCysx.md.jpg" alt="ipCysx.md.jpg"></a></p><p> ğŸ‘† BRZ/86</p><p><a href="https://imgchr.com/i/ipCgeK" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipCgeK.md.jpg" alt="ipCgeK.md.jpg"></a></p><p> ğŸ‘† TT é… TT</p><p><a href="https://imgchr.com/i/ipP9O0" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipP9O0.md.jpg" alt="ipP9O0.md.jpg"></a></p><p> ğŸ‘† Never Say Die ğŸ‘»</p><h2 id="åƒåƒå–å–"><a href="#åƒåƒå–å–" class="headerlink" title="åƒåƒå–å–"></a>åƒåƒå–å–</h2><p>åƒäº†å¥½å¹¾å®¶æ¸¯å¼é¤å»³ï¼Œå…¶å¯¦è·Ÿå¤§é™¸çš„å‘³é“å·®ä¸å¤šï¼Œæœ‰çš„é‚„ä¸å¦‚å¤§é™¸ï¼Œä¹Ÿè¨±æˆ‘å£“æ ¹æ²’åœ¨å¤§é™¸åƒåˆ°éå¥½åƒçš„ ğŸ¤¦ğŸ»â€â™‚ï¸ã€‚ä¹Ÿè¨±çœŸçš„è¦åˆ°ä¸€äº›ç•¶åœ°äººå¸¸å»çš„å°é¤¨å­æ‰èƒ½å“å˜—åˆ°åœ°é“çš„ç¾å‘³å§ã€‚</p><p>é—œæ–¼åƒé‚„æœ‰å¹¾é»éœ€è¦æé†’ã€‚å¹¾ä¹æ‰€æœ‰åƒé£¯çš„åœ°æ–¹åªæ”¯æŒç¾é‡‘æˆ–å…«é”é€šï¼Œåˆ·å¡ä¹Ÿä¸è¡Œã€‚å°æ–¼ç”¨æ…£äº†æ”¯ä»˜å¯¶/å¾®ä¿¡çš„æˆ‘å€‘ä¾†èªªï¼Œç¢ºå¯¦ä¸å¦‚å¤§é™¸æ–¹ä¾¿ã€‚æ‰€ä»¥ä¸€å®šè¦å¤šå¤šæº–å‚™å¥½ç¾é‡‘ã€‚</p><p>å¥½å¤šå°é¤å»³åœ¨å‘¨æ—¥å’Œç¯€å‡æ—¥éƒ½æœƒé—œé–€ã€‚ç‚ºäº†åƒä¸€å®¶è‚¥è…¸å’Œç‰›è…©èµ°äº†å¾ˆé çš„è·¯ï¼Œçµæœå»åƒäº†é–‰é–€ç¾¹ã€‚å¦‚æœè¦åƒæ±è¥¿ä¸€å®šè¦æå‰çœ‹å¥½å®ƒçš„ç‡Ÿæ¥­æ™‚é–“ã€‚</p><p>æœ‰ä¸€å¤©æ—©ä¸Šåœ¨å»åƒé£¯çš„è·¯ä¸Šé‡åˆ°äº†ææ¦®æµ©ï¼Œèº«é‚Šæœ‰å…©å€‹æœ‹å‹ï¼Œä»–æˆ´è‘—å£ç½©ï¼Œçœ¼ç›çœŸå¾—å¥½å°ã€‚æˆ‘è·Ÿä»–æ®äº†æ®æ‰‹ï¼Œä»–ä¹Ÿå¾®ç¬‘åœ°è¿´æ‡‰äº†æˆ‘ï¼Œå¥½å¯æ„› ğŸ˜ ç•¶æ™‚æ‰‹è£æ˜¯æ‹¿è‘—ç›¸æ©Ÿçš„ï¼Œä½†æ˜¯æ²’æ‹ä»–ã€‚ä¸¦ä¸æ˜¯æ¯ä¸€åˆ»éƒ½éœ€è¦è¢«è¨˜éŒ„ä¸‹ä¾†ï¼Œäº«å—å¥½ç•¶æ™‚çš„é‚£ä¸€åˆ»å°±è¶³å¤ äº†ã€‚</p><p><a href="https://imgchr.com/i/ipPFTU" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipPFTU.md.jpg" alt="ç‰›å¥¶å…¬å¸]"></a></p><p>å»äº†ä¸€å®¶éœ€è¦æ’éšŠçš„ç¶²ç´…é¤å»³ï¼ˆæ¾³æ´²ç‰›å¥¶å…¬å¸ ğŸ‘† ï¼‰ï¼Œé€²å»åä¸‹ä»¥å¾Œç™¼ç¾é‚„æ˜¯å¾ˆå—ç•¶åœ°äººæ­¡è¿çš„ï¼Œå‘³é“ä¹Ÿä¸éŒ¯ã€‚ä½†æ˜¯é«”é©—çœŸå¾—å¾ˆå·®ã€‚å› ç‚ºæ¡Œå­å¯¦åœ¨å¤ªå°ï¼Œæœ‹å‹æŠŠæ‰‹æ©Ÿæ”¾åˆ°å‡³å­ä¸Šã€‚ä¸€ä½æœå‹™å“¡åœ¨æŒªå‹•å‡³å­çš„æ™‚å€™ç›´æ¥ç”¨æ‰‹æŠŠæ‰‹æ©Ÿæƒåˆ°åœ°ä¸Šï¼Œè€Œä¸”ä¹Ÿæ²’æœ‰å¹«å¿™æ’¿èµ·ã€‚å¾Œä¾†æˆ‘æ‰¾ä»–ç†è«–ï¼Œä»–çœ‹è‘—æˆ‘ä¸€ç›´çšºçœ‰é ­ï¼Œä¸€å¥è©±ä¹Ÿä¸èªªï¼Œå¯èƒ½æ˜¯è½ä¸æ‡‚æ™®é€šè©±å§ã€‚</p><h2 id="åŸå¸‚èˆ‡äºº"><a href="#åŸå¸‚èˆ‡äºº" class="headerlink" title="åŸå¸‚èˆ‡äºº"></a>åŸå¸‚èˆ‡äºº</h2><p>å› ç‚ºæ™‚é–“çš„åŸå› ï¼Œåªåœ¨é¦™æ¸¯å‘†äº†å…©å¤©ï¼Œå¾ˆéºæ†¾ä¸€äº›å°çœ¾çš„èƒ½æ‹å‡ºæ¥µç¾ç…§ç‰‡çš„åœ°æ–¹æ²’æœ‰é€›åˆ°ï¼Œä½†èƒ½å»çš„ç†±é¬§æ™¯é»éƒ½å„˜å¯èƒ½å»äº†ã€‚</p><h3 id="ä¹é¾"><a href="#ä¹é¾" class="headerlink" title="ä¹é¾"></a>ä¹é¾</h3><p><a href="https://imgchr.com/i/ipChJH" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipChJH.md.jpg" alt="ä½æ•¦"></a></p><p> ğŸ‘† ä½æ•¦åœ°éµç«™é™„è¿‘çš„åå­—è·¯å£</p><p>å¾ä½æ•¦ç«™æ²¿è‘—åœ°éµç·šè·¯ä¸€è·¯å‘å—èµ°ï¼Œæ˜¯ä¸€æ¢éå¸¸ç†±é¬§çš„å•†æ¥­è¡—ã€‚åœ¨é€™æ¢è¡—ä¸Šä½ èƒ½åƒåˆ°éå¸¸å‡ºåçš„åˆ©å¼·è¨˜åŒ—è§’é›è›‹ä»”ï¼Œèƒ½çœ‹åˆ°åœ¨ TVB è£ç¶“å¸¸å‡ºç¾çš„å°–æ²™å’€è­¦ç½²ï¼Œèƒ½çœ‹åˆ°ç†Ÿç·´ç”¨è‹±æ–‡äº¤æµçš„å°å­©å­ï¼Œä¹Ÿèƒ½çœ‹åˆ°åè‘—è¼ªæ¤…ä¹è¨çš„æµæµªè€…ã€‚</p><p><a href="https://imgchr.com/i/ipC0JJ" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipC0JJ.md.jpg" alt="åˆ©å¼·è¨˜åŒ—è§’é›è›‹ä»”"></a></p><p> ğŸ‘† åˆ©å¼·è¨˜åŒ—è§’é›è›‹ä»”</p><p>èµ°åˆ°é ­å†æ²¿è‘—æµ·é‚Šå°±å¯ä»¥åˆ°é”å°–æ²™å’€æµ·æ¿±èŠ±åœ’ï¼Œå°é¢å°±æ˜¯ç¶­æ¸¯</p><p><a href="https://imgchr.com/i/ipPn61" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipPn61.md.png" alt="ipPn61.md.png"></a></p><p> ğŸ‘† æµ·æ¿±èŠ±åœ’çœ‹æµ·æ¿±</p><p>æ™šä¸Šä¸€å®šè¦å»æ—ºè§’ç«™é™„è¿‘çš„å¥³äººè¡—è½‰è½‰ã€‚é€™è£è·Ÿå‚³çµ±æ„ç¾©ä¸Šçš„å¤œå¸‚é‚„æ˜¯æœ‰å¾ˆå¤§å€åˆ¥çš„ã€‚æœ‰å¾ˆå¤šçš„å¤§å”å’Œé˜¿å§¨æœƒåœ¨é€™æ¢è¡—ä¸Šå”±æ­Œè·³èˆï¼Œé›–ç„¶æ­Œè²ä¸è¦‹å¾—æœ‰å¤šå¥½è½ï¼Œèˆå§¿ä¹Ÿä¸¦æ²’æœ‰å¾ˆå„ªç¾ï¼Œä½†ä»–å€‘æ¯å€‹äººçš„è‡‰ä¸Šéƒ½æ´‹æº¢è‘—ç¬‘å®¹ã€‚</p><p><a href="https://imgchr.com/i/ipC6L6" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipC6L6.md.jpg" alt="ipC6L6.md.jpg"></a></p><p> ğŸ‘† å¥³äººè¡—</p><p><a href="https://imgchr.com/i/ipCRoD" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipCRoD.md.jpg" alt="ipCRoD.md.jpg"></a></p><p> ğŸ‘† æ­£åœ¨ K æ­Œçš„å¤§å”</p><h3 id="ä¸­ç’°-amp-å¤ªå¹³å±±"><a href="#ä¸­ç’°-amp-å¤ªå¹³å±±" class="headerlink" title="ä¸­ç’° &amp; å¤ªå¹³å±±"></a>ä¸­ç’° &amp; å¤ªå¹³å±±</h3><p>å¤ªå¹³å±±ä¹Ÿç®—æ˜¯å¿…å»çš„æ™¯é»ä¹‹ä¸€ã€‚</p><p>å¾å°–æ²™å’€çš„è¼ªæ¸¡å¤©æ˜Ÿç¢¼é ­ï¼Œåˆ·å…«é”é€šå°±å¯ä»¥ä¹˜åè¼ªæ¸¡å‰å¾€ä¸­ç’°ã€‚æˆ‘ä¸€å‘å–œæ­¡æœ‰æ°´çš„åŸå¸‚ï¼Œæ°´ä¸ç®¡æ˜¯æ±Ÿæ°´æ²³æ°´é‚„æ˜¯æµ·æ°´ï¼ŒåŸå¸‚ä¸ç®¡æ˜¯å“ˆçˆ¾æ¿±ï¼Œä¸Šæµ·ï¼Œé‡æ…¶é‚„æ˜¯æ›¼è°·ã€‚äº¤é€šå·¥å…·å¤šä¸€é¡ï¼Œå°åŸå¸‚çš„æ„Ÿå—å°±æœƒå¤šä¸€å±¤ã€‚</p><p><a href="https://imgchr.com/i/ipC4Wd" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipC4Wd.md.jpg" alt="ipC4Wd.md.jpg"></a></p><p> ğŸ‘† æ¸¡è¼ª</p><p><a href="https://imgchr.com/i/ipCfFe" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipCfFe.md.jpg" alt="ipCfFe.md.jpg"></a> </p><p> ğŸ‘† å¸¥æ°£çš„èˆ¹é•·</p><p>ä¸‹äº†è¼ªæ¸¡ï¼Œæœƒçœ‹åˆ°ä¸€å€‹å·¨å¤§çš„æ‘©å¤©è¼ªï¼Œæ˜¯ä¸­ç’°çš„æ¨™å¿—æ€§å»ºç¯‰ä¹‹ä¸€ã€‚</p><p><a href="https://imgchr.com/i/ipCqw8" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipCqw8.md.jpg" alt="ipCqw8.md.jpg"></a></p><p> ğŸ‘† é¦™æ¸¯æ‘©å¤©è¼ª</p><p>å»ä¸­ç’°çš„é‚£å¤©æ°å¥½é‡åˆ°é¦¬æ‹‰æ¾æ´»å‹•ï¼Œèµ°åœ¨è·¯ä¸Šçœ‹åˆ°å¥½å¤šè„–å­ä¸Šæ›è‘—çç‰Œçš„å‰›åƒåŠ å®Œæ¯”è³½çš„äººã€‚æ­¥è¡Œåˆ°ä¸€å€‹å•†å ´é–€å£ï¼Œé€²å»è£é¢éœ€è¦å…ˆä¸Šå¹¾ç´šå°éšã€‚ä¸€ä½å¤–åœ‹çš„æ¯è¦ªåœ¨å°éšå‰é¢åœäº†ä¸‹ä¾†ï¼Œæ•´ç†è‘—å¬°å…’è»Šã€‚ä¸€ä½å‰›åƒåŠ å®Œé¦¬æ‹‰æ¾çš„å¥³å­©çœ‹åˆ°äº†é€™ä½æ¯è¦ªï¼Œæ²’æœ‰çŒ¶è±«ï¼Œå¾‘ç›´èµ°åˆ°å¥¹èº«æ—ï¼Œç”¨è‹±èªè©¢å•è‘—æ˜¯å¦éœ€è¦å¹«å¿™ã€‚é‚£ä¸€åˆ»çœŸå¾—å¥½æº«æš–ã€‚</p><p>é‚£å¤©å‰›å¥½é€±æ—¥ï¼Œåœ¨å»çš‡å¾Œåƒå»£å ´çš„è·¯ä¸Šï¼Œçœ‹åˆ°äº†æµ·é‡çš„è²å¾‹è³“å¥³æ€§ï¼Œå¥¹å€‘ååœ¨é‹ªæ»¿ç´™æ¿çš„åœ°ä¸Šï¼Œèšé›†åœ¨åœ°ä¸‹é€šé“è£ï¼Œè¡—é“ä¸Šï¼Œlike everywhereã€‚å¥¹å€‘ä¸€èµ·åœåè‘—åƒå¸¶ä¾†çš„åˆé¤ï¼Œåƒæ˜¯åœ¨åƒåŠ ä¸€å ´ç››å¤§çš„é›†æœƒã€‚åªæœ‰è¦ªè‡ªå»åˆ°ç¾å ´æ‰èƒ½é«”æœƒåˆ°é€™å£¯è§€çš„å ´é¢ã€‚ç•¶æ™‚ä»¥ç‚ºç•¶æ—¥æ˜¯æœ‰ä»€éº¼ç‰¹åˆ¥çš„æ´»å‹•ï¼Œç„¶è€Œå¾Œä¾†ç¶“éæœç´¢æ‰çŸ¥é“ï¼Œå¥¹å€‘å¹¾ä¹æ¯é€±æ—¥éƒ½æœƒä¾†é€™è£ ğŸŒš</p><p>ä¸­ç’°è‡³åŠå±±è‡ªå‹•æ‰¶æ‰‹é›»æ¢¯å¯ä»¥å»è½‰è½‰ï¼Œé‚£é™„è¿‘çš„è¡—é“å¾ˆç¾ã€‚</p><p>ä¸­ç’°é™„è¿‘å•†å ´å¾ˆå¤šï¼Œæœ‰åçš„è¡—é“ä¹Ÿå¾ˆå¤šã€‚å¯ä»¥æ­¥è¡Œåˆ°ç¾…å¤§ä½‘æ­Œè£çš„çš‡å¾Œå¤§é“æ±ï¼Œæ’ä¸Šè€³æ©Ÿæ„Ÿå—ä¸€ä¸‹ç•¶æ™‚äººå€‘å°é¦™æ¸¯ç™¼å±•çš„æ“”æ†‚ï¼Œç„¶å¾Œå†æŠ¬é ­æœ›ä¸€æœ›å¦‚ä»Šç¹è¯çš„é¦™æ¸¯ã€‚</p><p><a href="https://imgchr.com/i/ipCISA" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipCISA.md.jpg" alt="ipCISA.md.jpg"></a></p><p>é€›çš„å·®ä¸å¤šäº†ï¼Œä¸‹åˆ 4ï¼Œ5 é»å°±å¯ä»¥å»å±±é ‚çºœè»Šç«™å‘å¤ªå¹³å±±é€²ç™¼äº†ã€‚å› ç‚ºæ’éšŠçš„äººå¯¦åœ¨æ˜¯å¤ªå¤šï¼Œä¸€å®šè¦åšå¥½å¿ƒç†æº–å‚™ï¼Œæå‰ä¸Šå¥½å»æ‰€ï¼Œæº–å‚™å¥½æ°´ã€‚</p><p><a href="https://imgchr.com/i/ipC7OP" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipC7OP.md.jpg" alt="ipC7OP.md.jpg"></a></p><p>å±±é ‚çºœè»Šå…è¨±æœ‰ç«™è‘—çš„äººï¼Œå¦‚æœæ²’æœ‰æ¶åˆ°åº§ä½ä¸è¦ç°å¿ƒï¼Œç«™è‘—æ˜¯åŒæ¨£æ¨è–¦çš„ã€‚å› ç‚ºä¸­é–“æœ‰ä¸€æ®µè·¯çš„è§’åº¦å¯¦åœ¨æ˜¯åœ¨ï¼Œæ‰€ä»¥ç«™è‘—æœƒè®“ä½ å°é€™æ®µæ—…é€”ç”¢ç”Ÿæ›´åŠ æ·±åˆ»çš„å›æ†¶ã€‚</p><p><a href="https://imgchr.com/i/ipPpyq" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipPpyq.md.jpg" alt="ipPpyq.md.jpg"></a></p><p>åˆ°äº†å±±é ‚ï¼Œå¦‚æœå¤©è‰²é‚„æ²’æœ‰æš—ä¸‹ä¾†ï¼Œå¯ä»¥ä¸ç”¨é‚£éº½è‘—æ€¥å‰å¾€è§€æ™¯è‡ºã€‚å¯ä»¥æ²¿è‘—å¦ä¸€æ¢è·¯å‘ä¸Šèµ°ï¼Œæ™¯è‰²åŒæ¨£è¿·äººã€‚</p><p><a href="https://imgchr.com/i/ipCLTS" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipCLTS.md.jpg" alt="ipCLTS.md.jpg"></a></p><p><a href="https://imgchr.com/i/ipCXFg" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipCXFg.md.jpg" alt="ipCXFg.md.jpg"></a></p><p>è¶è‘—å¤œè‰²å¿«è¦ä¾†è‡¨ï¼Œå°±å¯ä»¥å¾€è§€æ™¯è‡ºæ–¹å‘èµ°äº†ï¼Œå»çœ‹çœ‹é¦™æ¸¯çš„å¤œæ™¯å§ã€‚ï¼ˆç”±æ–¼æ²’å¸¶è…³æ¶ï¼Œæ‰€ä»¥åªæ‹äº†å¹¾å¼µæ¸£æ¸£çš„ç…§ç‰‡ ğŸ˜­</p><p><a href="https://imgchr.com/i/ipPAkF" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipPAkF.md.jpg" alt="ipPAkF.md.jpg"></a></p><p><a href="https://imgchr.com/i/ipCzSs" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipCzSs.md.jpg" alt="ipCzSs.md.jpg"></a></p><p>çœ‹å®Œäº†å¤œæ™¯å°±ä¸è¦å†æ’éšŠå»åå±±é ‚çºœè»Šäº†ï¼Œå‘è‘—ä¸‹å±±çš„æ–¹å‘èµ°ä¸€æ®µï¼Œé‚£è£æœ‰ä¸€å€‹å…¬äº¤å ´ï¼Œæœ‰ç›´é”å¤©æ˜Ÿç¢¼é ­çš„å·´å£«ã€‚ä¸€è·¯éƒ½æ˜¯ç›¤å±±è·¯ï¼Œä½†å¸æ©Ÿé–‹å¾—é£›å¿«ï¼Œåˆºæ¿€ã€‚å†ä¹˜è¼ªæ¸¡è¿”å›å°–æ²™å’€ï¼Œæ¬£è³ä¸€ä¸‹ä¸­ç’°çš„å¤œæ™¯ï¼Œåˆ°äº†é‚£é‚Šï¼Œå¦‚æœæœ‰æ™‚é–“é‚„å¯ä»¥å»æµ·æ¸¯åŸé€›ä¸€é€›ï¼Œè²·è²·è²·ã€‚</p><p><a href="https://imgchr.com/i/ipPEY4" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/05/ipPEY4.md.jpg" alt="ipPEY4.md.jpg"></a></p><p> ğŸ‘† å¤œæ™šçš„ä¸­ç’°</p><h2 id="çµèª"><a href="#çµèª" class="headerlink" title="çµèª"></a>çµèª</h2><p>åœ¨é¦™æ¸¯å‘†é€™å…©å¤©ï¼Œå¹¾ä¹æ¯å¤©éƒ½åœ¨æš´èµ°ï¼Œä½†çµ²æ¯«æ²’æœ‰æ„Ÿåˆ°ç´¯ã€‚æ‹äº†å¤§æ¦‚å¹¾åƒå¼µç…§ç‰‡ï¼Œæ¯å¼µèƒŒå¾Œéƒ½æœ‰ä¸€å€‹æ•…äº‹ã€‚</p><p>é¦™æ¸¯å¸¶çµ¦æˆ‘çš„æ„Ÿå—æ˜¯ç¹è¯å¤šå…ƒèˆ‡ç¾ä»£ï¼Œé¦™æ¸¯äººå¸¶çµ¦æˆ‘çš„æ„Ÿå—æ˜¯æ¨‚æ–¼åŠ©äººï¼Œå¥®é¬¥èˆ‡é™½å…‰ã€‚</p><p>æœ‰æ©Ÿæœƒæˆ‘ä¸€å®šé‚„æœƒå†å»å¹¾æ¬¡ï¼Œå› ç‚ºæˆ‘å¤ªæ„›é€™åº§åŸå¸‚äº†ã€‚</p><p>èªªäº†åŠå¤©å¥½å¹¹å•Šï¼Œ<a href="http://onetake.dafork.com/static/photos/b3j70pm.html" target="_blank" rel="noopener">é»æ“Šé€™è£</a>çœ‹æˆ‘åœ¨é¦™æ¸¯éŒ„ä¸‹çš„ç‰‡æ®µå§ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡çš„å¤§éƒ¨åˆ†å…§å®¹éƒ½æ˜¯äº”æœˆä»½åœ¨é¦™æ¸¯çš„æ™‚å€™ç”¨ Notes è¨˜ä¸‹çš„ï¼Œä½†å› ç‚ºæ‡¶ï¼Œæ‹–åˆ°ä»Šå¤©æ‰æ•´ç† ğŸ™ˆ&lt;br&gt;å› ç‚ºå†…å®¹å…³äºé¦™æ¸¯ï¼Œæ‰€ä»¥ç´¢æ€§å°±ç”¨ç¹é«”å¥½äº†&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;äº”æœˆä¸­æ—¬è¨ˆåŠƒå»æ³°åœ‹ç©ä¸€ç©ï¼Œè¨‚æ©Ÿç¥¨çš„æ™‚å€™ç™¼ç¾å¾é¦™æ¸¯è½‰æ©Ÿå†éå»æ¸…é‚æœƒä¾¿å®œä¸€äº›ï¼Œè€Œä¸”ç¶“éé¦™æ¸¯å»å…¶å®ƒåœ‹å®¶ä¸¦ä¸éœ€è¦æä¾›é¦™æ¸¯çš„ç°½è¨»ï¼Œåªè¦åœ¨å…¥å¢ƒçš„æ™‚å€™æä¾›ä¸€ä¸‹å¾Œé¢çš„è¡Œç¨‹å–®å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="çæ‰¯" scheme="https://x140yu.github.io/tags/%E7%9E%8E%E6%89%AF/"/>
    
      <category term="æ¸¸è®°" scheme="https://x140yu.github.io/tags/%E6%B8%B8%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†æä½¿ç”¨ CocoaPods é¡¹ç›®çš„ä¾èµ–</title>
    <link href="https://x140yu.github.io/2018-08-20-analyze-pods-dependecy/"/>
    <id>https://x140yu.github.io/2018-08-20-analyze-pods-dependecy/</id>
    <published>2018-09-02T14:20:00.000Z</published>
    <updated>2019-08-19T07:43:25.675Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åœ¨å»å¹´ï¼Œæˆ‘æ›¾ç”¨ electron å†™è¿‡ä¸€ä¸ªåˆ†æä½¿ç”¨ CocoaPods é¡¹ç›®ä¾èµ–çš„<a href="https://github.com/X140Yu/development-pods-dependency-checker" target="_blank" rel="noopener">å·¥å…·</a>ï¼Œå½“æ—¶å¯¹ CocoaPods è¿˜ä¸æ€ä¹ˆäº†è§£ï¼Œç”¨äº†ä¸€ç§ã€Œéæ­£å¸¸ã€çš„æ“ä½œè§£å†³äº†æˆ‘å½“æ—¶çš„éœ€æ±‚ã€‚ä¸è¿‡ç°åœ¨ï¼Œæˆ‘æ‰¾åˆ°äº†ä¸€ç§æ›´å¥½çš„è§£å†³æ–¹æ¡ˆ</p></blockquote><h2 id="å…ˆå›é¡¾ä¸€ä¸‹æˆ‘ä»¬çš„éœ€æ±‚"><a href="#å…ˆå›é¡¾ä¸€ä¸‹æˆ‘ä»¬çš„éœ€æ±‚" class="headerlink" title="å…ˆå›é¡¾ä¸€ä¸‹æˆ‘ä»¬çš„éœ€æ±‚"></a>å…ˆå›é¡¾ä¸€ä¸‹æˆ‘ä»¬çš„éœ€æ±‚</h2><p><code>podspec</code> ä¸­åˆ—å‡ºçš„ dependecy åœ¨æŸäº›æƒ…å†µä¸‹è¦è¿œè¿œæ¯”çœ‹èµ·æ¥çš„å¤šå¾—å¤šï¼Œå°¤å…¶æ˜¯åœ¨å¤§é‡ä½¿ç”¨ development pods çš„æƒ…å†µä¸‹ã€‚è€Œæœ‰äº›æƒ…å†µï¼Œéœ€è¦ç¡®è®¤ä¸€ä¸ª pod çš„å…¨éƒ¨ä¾èµ–ï¼ˆæ¯”å¦‚ä¸ºè¿™ä¸ª pod åˆ›å»º Example å·¥ç¨‹çš„æ—¶å€™ï¼‰ï¼Œè¿™æ—¶å°±éœ€è¦ä¸€ä¸ªå·¥å…·æ¥åˆ†æäº†ã€‚æœ€ç»ˆçš„ç›®æ ‡æ˜¯åœ¨æ‹¥æœ‰ä¸€ä¸ª podfile çš„æƒ…å†µä¸‹ï¼ŒæŠŠæ¯ä¸ªä¾èµ–çš„æ‰€æœ‰ä¾èµ–éƒ½æ‰¾å‡ºæ¥</p><a id="more"></a><h2 id="ä¸Šä¸€ä¸ªæ–¹æ¡ˆå­˜åœ¨çš„é—®é¢˜"><a href="#ä¸Šä¸€ä¸ªæ–¹æ¡ˆå­˜åœ¨çš„é—®é¢˜" class="headerlink" title="ä¸Šä¸€ä¸ªæ–¹æ¡ˆå­˜åœ¨çš„é—®é¢˜"></a>ä¸Šä¸€ä¸ªæ–¹æ¡ˆå­˜åœ¨çš„é—®é¢˜</h2><p>å¦‚æœå¿˜è®°äº†ä¹‹å‰åŸç†çš„åŒå­¦å¯ä»¥å¿«é€Ÿåœ°ç¿»ä¸€ä¸‹<a href="https://zhaoxinyu.me/2017-09-16-development-pods-dependency-checker/#Development-Pods-Dependency-Checker" target="_blank" rel="noopener">è¿™ä¸ªéƒ¨åˆ†</a>ï¼Œç›®å‰çœ‹æ¥ï¼Œè¿™ä¸ªæ–¹æ¡ˆæœ‰å‡ ä¸ªé—®é¢˜ï¼Œ</p><ol><li><code>Pods/Local Podspecs</code> é‡Œåªä¼šå­˜åœ¨ä½¿ç”¨ <code>url</code> æ–¹å¼å¼•ç”¨çš„ podã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœæ˜¯ä»¥ç‰ˆæœ¬å·çš„æ–¹å¼å¼•ç”¨çš„ podï¼Œé‚£å®ƒçš„æè¿°å°±ä¸ä¼šå‡ºç°åœ¨é‚£ä¸ªç›®å½•ä¸­ã€‚æ ¹æ®ä¹‹å‰çš„åˆ†æé€»è¾‘ï¼Œæˆ‘ä»¬å°±å‡è®¾å®ƒæ²¡æœ‰ä¾èµ–äº†ï¼Œè¿™æ ·åˆ†æå®Œçš„ä¾èµ–æ˜¯ä¸å…¨çš„</li><li>åˆ†æä¾èµ–éœ€è¦ <code>pod install</code> ä¸€æ¬¡ï¼Œæœ‰äº›é‡</li></ol><p>é‚£æ€æ ·æ‰èƒ½ä¼˜é›…è€Œä¸”æ­£ç¡®åœ°å®ç°è¿™ä¸ªéœ€æ±‚å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ä½¿ç”¨ CocoaPods æœ¬èº« ğŸ¤“</p><h2 id="Analyzer"><a href="#Analyzer" class="headerlink" title="Analyzer"></a>Analyzer</h2><p>é€šè¿‡æŸ¥çœ‹ CocoaPods çš„æºç ï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªç±»å«åš <code>Analyzer</code>ï¼Œå®ƒæœ‰ä¸€ä¸ª <code>analyze</code> æ–¹æ³• ä¼šè¿”å›ä¸€ä¸ª <code>AnalysisResult</code> çš„ç»“æ„ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåå­—å« <code>specifications</code> çš„ Arrayã€‚è¿™å°±åº”è¯¥æˆ‘ä»¬è¦æ‰¾çš„ç­”æ¡ˆ</p><figure class="highlight ruby"><figcaption><span>Analyzer</span><a href="https://github.com/CocoaPods/CocoaPods/blob/355bda2a4b8bd00748650a8d293626f4e118b69a/lib/cocoapods/installer/analyzer.rb#L6" target="_blank" rel="noopener">analyzer.rb</a></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment"># Initialize a new instance</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Analyzes the Podfile, the Lockfile, and the sandbox manifest to generate the information relative to a CocoaPods installation.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Analyzer</span></span></span><br><span class="line">  <span class="comment"># Parameters:</span></span><br><span class="line">  <span class="comment"># sandbox (Sandbox) â€” <span class="doctag">@see</span> sandbox</span></span><br><span class="line">  <span class="comment"># podfile (Podfile) â€” <span class="doctag">@see</span> podfile</span></span><br><span class="line">  <span class="comment"># lockfile (Lockfile) (defaults to: nil) â€” <span class="doctag">@see</span> lockfile</span></span><br><span class="line">  <span class="comment"># plugin_sources (Array&lt;Source&gt;) (defaults to: nil) â€” <span class="doctag">@see</span> plugin_sources</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(sandbox, podfile, lockfile = <span class="literal">nil</span>, plugin_sources = <span class="literal">nil</span>)</span></span> â‡’ Analyzer</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Performs the analysis.</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># The Podfile and the Lockfile provide the information necessary to</span></span><br><span class="line">  <span class="comment"># compute which specification should be installed. The manifest of the</span></span><br><span class="line">  <span class="comment"># sandbox returns which specifications are installed.</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span>  [Bool] allow_fetches</span></span><br><span class="line">  <span class="comment">#         whether external sources may be fetched</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@return</span> [AnalysisResult]</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">analyze</span><span class="params">(allow_fetches = <span class="literal">true</span>)</span></span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">  <span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ç°åœ¨çš„ä»»åŠ¡å°±å˜æˆäº†ï¼Œæ„é€ ä¸€ä¸ª <code>Analyzer</code> ç„¶åè°ƒç”¨å®ƒçš„ <code>analyze</code> æ–¹æ³•ã€‚ä¸è¿‡åœ¨æ“ä½œä¹‹å‰ï¼Œæœ‰ä¸€äº›æ¦‚å¿µéœ€è¦ææ¸…ã€‚</p><h2 id="CocoaPods-ä¸­çš„å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ"><a href="#CocoaPods-ä¸­çš„å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ" class="headerlink" title="CocoaPods ä¸­çš„å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ"></a>CocoaPods ä¸­çš„å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ</h2><h3 id="Pod-Config"><a href="#Pod-Config" class="headerlink" title="Pod::Config"></a><a href="https://github.com/CocoaPods/CocoaPods/blob/355bda2a4b8bd00748650a8d293626f4e118b69a/lib/cocoapods/config.rb#L2" target="_blank" rel="noopener">Pod::Config</a></h3><p>ç”¨äºé…ç½® CocoaPodsï¼Œæ¯”å¦‚æ¯æ¬¡ <code>pod install</code> æ˜¯å¦éœ€è¦æ‰§è¡Œ <code>pod repo update</code>ï¼›specs master repo ä½ç½®ä¹‹ç±»çš„ã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹ <code>~/.cocoapods/config.yaml</code> æ–‡ä»¶æ¥å®ç°è‡ªå®šä¹‰çš„é…ç½®ã€‚</p><h3 id="Pod-Installer"><a href="#Pod-Installer" class="headerlink" title="Pod::Installer"></a><a href="https://github.com/CocoaPods/CocoaPods/blob/355bda2a4b8bd00748650a8d293626f4e118b69a/lib/cocoapods/installer.rb#L31" target="_blank" rel="noopener">Pod::Installer</a></h3><p>æœ€é‡è¦çš„ä¸€ç±»ï¼Œè´Ÿè´£ <code>pod install</code> çš„æ•´ä¸ªæµç¨‹ã€‚è´Ÿè´£è¯»å– <code>Podfile</code> å’Œ <code>Podfile.lock</code> ä¸­çš„ä¾èµ–å†…å®¹ä»¥åŠå¯¹åº”çš„ç‰ˆæœ¬ä¿¡æ¯ï¼ŒæŠŠä¾èµ–å˜æˆ <code>Pods</code> ç›®å½•ä¸­çš„ä¸€ä¸ªä¸ªå®ä½“ï¼Œç„¶åå¯¹ <code>project</code> æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œä»¥ä¾¿æˆ‘ä»¬èƒ½ç›´æ¥åœ¨å·¥ç¨‹é‡Œç”¨ä¸Šè¿™äº›ä¾èµ–ã€‚</p><h3 id="Pod-Sandbox"><a href="#Pod-Sandbox" class="headerlink" title="Pod::Sandbox"></a><a href="https://github.com/CocoaPods/CocoaPods/blob/355bda2a4b8bd00748650a8d293626f4e118b69a/lib/cocoapods/sandbox.rb#L38" target="_blank" rel="noopener">Pod::Sandbox</a></h3><p>å¯ä»¥ç†è§£ä¸ºä¸ <code>Podfile</code> åŒçº§çš„ <code>Pod</code> ç›®å½•çš„æŠ½è±¡</p><h3 id="Pod-Podfile-amp-amp-Pod-Podfile-lock"><a href="#Pod-Podfile-amp-amp-Pod-Podfile-lock" class="headerlink" title="[Pod::Podfile] &amp;&amp; [Pod::Podfile.lock]"></a>[Pod::Podfile] &amp;&amp; [Pod::Podfile.lock]</h3><p>å®ƒä»¬ä¸¤ä¸ªéƒ½åœ¨ cocoaPods-core ä»“åº“ä¸­ï¼Œåˆ†åˆ«ä»£è¡¨ podfile å’Œ podfile.lock</p><h2 id="æäº‹æƒ…"><a href="#æäº‹æƒ…" class="headerlink" title="æäº‹æƒ…"></a>æäº‹æƒ…</h2><p><del>æœ¬æ¥åœ¨å†™è¿™ç¯‡æœ¬æ–‡ä¹‹å‰å·²ç»å†™äº†ä¸€ä¸ªå°è„šæœ¬ä»¥ä¸ºèƒ½å®Œæˆå·¥ä½œï¼Œä½†åœ¨æ–‡ç« å†™äº†ä¸€åŠçš„æ—¶å€™å‘ç°é€»è¾‘å¹¶ä¸å®Œå–„ï¼Œäºæ˜¯æ–‡ç« å°±æç½®äº†</del></p><p>åæ¥èŠ±ä¸€äº›æ—¶é—´å¥½å¥½æŠŠé€»è¾‘ä¼˜åŒ–äº†ä¸€ä¸‹ï¼Œè§‰å¾—å…¶å®ƒäººåº”è¯¥ä¹Ÿèƒ½ç”¨å¾—ä¸Šï¼Œå°±æŠŠä»£ç å‘åˆ°äº† GitHub ä¸Šäº† <a href="https://github.com/X140Yu/cocoapods-dependency" target="_blank" rel="noopener">ï¼ˆç‚¹è¿™é‡ŒæŸ¥çœ‹ï¼‰</a></p><p>ä¸»è¦çš„ä»£ç åœ¨ <a href="https://github.com/X140Yu/cocoapods-dependency/blob/master/lib/cocoapods/analyze.rb" target="_blank" rel="noopener">analyze.rb</a> æ–‡ä»¶ä¸­ï¼Œæ ¸å¿ƒçš„é€»è¾‘å¦‚ä¸‹ï¼Œ</p><ul><li>é€šè¿‡ <code>analyzer</code> æ‰¾å‡ºæ‰€æœ‰çš„ <code>specifications</code></li><li>å¯¹äºæ¯ä¸€ä¸ª <code>specification</code>ï¼ŒæŠŠå®ƒçš„ <code>name</code> ä½œä¸º keyï¼Œå®ƒçš„ä¾èµ–ï¼ˆåœ¨å½“å‰é¡¹ç›®ä¸­ä½¿ç”¨çš„ <code>subsbpec</code> å’Œ <code>dependecies</code> çš„åˆï¼‰ä½œä¸º valueï¼Œç”Ÿæˆä¸€ä¸ª <code>map</code></li><li>å†æ¬¡éå† <code>specification</code>ï¼Œæ ¹æ®å®ƒçš„ä¾èµ–è¿˜æœ‰ä¸Šä¸€æ­¥ç”Ÿæˆçš„ mapï¼Œé€’å½’åœ°å¯»æ‰¾å®ƒçš„å…¨éƒ¨ä¾èµ–</li></ul><h3 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h3><p>è§£å†³äº†ä¸Šä¸€ä¸ªæ–¹æ¡ˆä¸­å‡ºç°çš„æ‰€æœ‰é—®é¢˜</p><ul><li>èƒ½å®Œæ•´åœ°åˆ—å‡ºæ•´ä¸ª podfile ä¸­çš„æ‰€æœ‰ä¾èµ–ï¼ˆä¸å…‰ podfile ä¸­åˆ—å‡ºçš„ï¼Œè¿˜æœ‰ä¾èµ–çš„ä¾èµ–ï¼‰</li><li>å¾ˆå¥½åœ°å¤„ç†äº† subspec çš„é—®é¢˜ï¼Œä¼šæ ¹æ® podfile ä¸­ä¾èµ–çš„ subspec è¾“å‡ºæ­£ç¡®çš„ç»“æœã€‚æ¯”å¦‚ <code>pod &#39;Texture&#39;, &#39;2.7&#39;</code> å’Œ <code>pod &#39;Texture&#39;, &#39;2.7&#39;, subspecs: %w[PINRemoteImage IGListKit Yoga]</code> å°±ä¼šäº§ç”Ÿä¸åŒçš„è¾“å‡º</li><li>ä¸éœ€è¦ <code>pod install</code>ï¼Œéå¸¸è½»é‡</li></ul><h3 id="é™åˆ¶"><a href="#é™åˆ¶" class="headerlink" title="é™åˆ¶"></a>é™åˆ¶</h3><ul><li>åˆ†æçš„é¡¹ç›®ä¸­éœ€è¦åŒ…å« Podfile å’Œå¯¹åº”çš„ xcodeproj æ–‡ä»¶ï¼Œä¸èƒ½åªæœ‰ Podfile</li><li>ç”¨æ³•è¿˜æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦ clone å·¥ç¨‹ç„¶åè¿è¡Œè„šæœ¬æŒ‡å®šè·¯å¾„ï¼Œåç»­è€ƒè™‘åšæˆä¸€ä¸ª pod æ’ä»¶çš„å½¢å¼ï¼Œå‚è€ƒ<a href="https://github.com/X140Yu/cocoapods-dependency/issues/2" target="_blank" rel="noopener">è¿™ä¸ª issue</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;åœ¨å»å¹´ï¼Œæˆ‘æ›¾ç”¨ electron å†™è¿‡ä¸€ä¸ªåˆ†æä½¿ç”¨ CocoaPods é¡¹ç›®ä¾èµ–çš„&lt;a href=&quot;https://github.com/X140Yu/development-pods-dependency-checker&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å·¥å…·&lt;/a&gt;ï¼Œå½“æ—¶å¯¹ CocoaPods è¿˜ä¸æ€ä¹ˆäº†è§£ï¼Œç”¨äº†ä¸€ç§ã€Œéæ­£å¸¸ã€çš„æ“ä½œè§£å†³äº†æˆ‘å½“æ—¶çš„éœ€æ±‚ã€‚ä¸è¿‡ç°åœ¨ï¼Œæˆ‘æ‰¾åˆ°äº†ä¸€ç§æ›´å¥½çš„è§£å†³æ–¹æ¡ˆ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;å…ˆå›é¡¾ä¸€ä¸‹æˆ‘ä»¬çš„éœ€æ±‚&quot;&gt;&lt;a href=&quot;#å…ˆå›é¡¾ä¸€ä¸‹æˆ‘ä»¬çš„éœ€æ±‚&quot; class=&quot;headerlink&quot; title=&quot;å…ˆå›é¡¾ä¸€ä¸‹æˆ‘ä»¬çš„éœ€æ±‚&quot;&gt;&lt;/a&gt;å…ˆå›é¡¾ä¸€ä¸‹æˆ‘ä»¬çš„éœ€æ±‚&lt;/h2&gt;&lt;p&gt;&lt;code&gt;podspec&lt;/code&gt; ä¸­åˆ—å‡ºçš„ dependecy åœ¨æŸäº›æƒ…å†µä¸‹è¦è¿œè¿œæ¯”çœ‹èµ·æ¥çš„å¤šå¾—å¤šï¼Œå°¤å…¶æ˜¯åœ¨å¤§é‡ä½¿ç”¨ development pods çš„æƒ…å†µä¸‹ã€‚è€Œæœ‰äº›æƒ…å†µï¼Œéœ€è¦ç¡®è®¤ä¸€ä¸ª pod çš„å…¨éƒ¨ä¾èµ–ï¼ˆæ¯”å¦‚ä¸ºè¿™ä¸ª pod åˆ›å»º Example å·¥ç¨‹çš„æ—¶å€™ï¼‰ï¼Œè¿™æ—¶å°±éœ€è¦ä¸€ä¸ªå·¥å…·æ¥åˆ†æäº†ã€‚æœ€ç»ˆçš„ç›®æ ‡æ˜¯åœ¨æ‹¥æœ‰ä¸€ä¸ª podfile çš„æƒ…å†µä¸‹ï¼ŒæŠŠæ¯ä¸ªä¾èµ–çš„æ‰€æœ‰ä¾èµ–éƒ½æ‰¾å‡ºæ¥&lt;/p&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="https://x140yu.github.io/tags/iOS/"/>
    
      <category term="ruby" scheme="https://x140yu.github.io/tags/ruby/"/>
    
      <category term="CocoaPods" scheme="https://x140yu.github.io/tags/CocoaPods/"/>
    
  </entry>
  
  <entry>
    <title>å‡çº§ CocoaPods 1.5ï¼Œä½¿ç”¨ Swift Static Framework</title>
    <link href="https://x140yu.github.io/2018-04-28-cocoapods-1-5/"/>
    <id>https://x140yu.github.io/2018-04-28-cocoapods-1-5/</id>
    <published>2018-04-28T11:00:00.000Z</published>
    <updated>2019-08-19T07:43:25.675Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>CocoaPods 1.5 is amazing!</p></blockquote><p><a href="blog.cocoapods.org/CocoaPods-1.5.0/">CocoaPods 1.5</a> åœ¨å‰ä¸€æ®µæ—¶é—´ release äº†ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå¯¹äºä½¿ç”¨äº† Swift çš„é¡¹ç›®éå¸¸é‡è¦ featureï¼Œé‚£å°±æ˜¯æ”¯æŒäº† Swift çš„ Static Frameworkã€‚</p><a id="more"></a><p>è¿™è¿˜è¦è®²è®² Swift Static Framework çš„å†å²ã€‚åœ¨ Xcode 9 ä¹‹å‰ï¼Œå¹¶ä¸æ”¯æŒ Swift Static Frameworkï¼›Xcode 9 ä¹‹åæ”¯æŒäº† Swift çš„ Static Frameworkï¼Œä½†æ˜¯ä½¿ç”¨ Swift + CocoaPods çš„é¡¹ç›®å¹¶æ²¡æœ‰åŠæ³•ä½¿ç”¨ Static Frameworkï¼Œå› ä¸º CocoaPods ä¸æ”¯æŒã€‚åœ¨ CocoaPods release  <a href="http://blog.cocoapods.org/CocoaPods-1.4.0/" target="_blank" rel="noopener">1.4 ç‰ˆæœ¬</a> çš„æ—¶å€™ï¼Œç»ˆäºæ”¯æŒäº†åœ¨ <code>use_framework!</code> çš„æƒ…å†µä¸‹ä½¿ç”¨ Static Frameworkï¼Œä½†æ˜¯å¯¹äº Swift å’Œ Objective-C æ··ç¼–çš„é¡¹ç›®è¿˜æ˜¯æœªèƒ½å®Œç¾æ”¯æŒï¼›ç»ˆäºåœ¨ 1.5 ç‰ˆæœ¬ï¼ŒSwift çš„é¡¹ç›®èƒ½ç”¨ä¸Š Static Framework äº†ï¼</p><p>ä¸ºä»€ä¹ˆè¿™ä»¶äº‹æƒ…ä»¤äººå…´å¥‹å‘¢ï¼Ÿè¿™è¿˜å¾—ä» Dynamic Framework è¯´èµ·ã€‚Apple å®˜æ–¹æ¨èæ¯ä¸ª App ä½¿ç”¨ Dynamic Framework çš„æ•°é‡æ˜¯ <a href="https://developer.apple.com/videos/play/wwdc2016/406/" target="_blank" rel="noopener">6 ä¸ª</a>ï¼Œè¿™æ˜¯æœ‰åŸå› çš„ã€‚å› ä¸ºåœ¨ App å¯åŠ¨çš„æ—¶å€™ï¼Œdyld ä¼šload è¿™äº›åŠ¨æ€åº“ï¼Œè¿™ä¼šé€ æˆå¯åŠ¨æ—¶é—´çš„å¢åŠ ï¼›è€Œä¸”åŠ¨æ€åº“æ•°é‡è¿‡å¤šï¼Œè¿˜ä¼šåœ¨ iOS 9 çš„è®¾å¤‡ä¸Šé€ æˆ dyld çš„ <a href="https://github.com/artsy/eigen/issues/1246" target="_blank" rel="noopener">crash</a>ã€‚æ‰€ä»¥ä½¿ç”¨ Static Framework åº”è¯¥æ˜¯æ¯ä¸ªä½¿ç”¨äº† Swift + CocoaPods çš„é¡¹ç›®éƒ½æœŸæœ›çš„äº‹æƒ…ã€‚</p><p>åœ¨ CocoaPods è¿˜æœªæ”¯æŒè¿™ä»¶äº‹æƒ…çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://github.com/Ruenzuo/cocoapods-amimono" target="_blank" rel="noopener">cocoapods-amimono</a> è¿™ä¸ªæ’ä»¶ã€‚å®ƒä¼šæŠŠæ‰€æœ‰ Dynamic Framework çš„ç¬¦å·æ‹·è´åˆ°æœ€ç»ˆç¨‹åºçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œè§£å†³ä¸Šé¢å‡ºç°çš„ä¸¤ä¸ªé—®é¢˜ã€‚</p><p>æ—¢ç„¶ä½¿ç”¨åŠ¨æ€åº“æœ‰è¿™æ ·é‚£æ ·çš„é—®é¢˜ï¼Œé‚£åœ¨å‡çº§äº† 1.5 ä»¥åï¼Œå…¨éƒ½ä½¿ç”¨é™æ€åº“ä¸å°±å¥½äº†ï¼Ÿäº‹æ˜¯è¿™ä¹ˆå›äº‹ï¼Œä½†ä½¿ç”¨é™æ€åº“ä¹Ÿä¸æ˜¯å®Œç¾çš„ï¼Œå› ä¸ºä½ è¿˜å¯èƒ½ä¼šé‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼š<a href="https://zhaoxinyu.me/2018-04-14-what-happends-if-two-frameworks-defines-same-c-functions/" target="_blank" rel="noopener">ä¸¤ä¸ª Framework ä¸­å¦‚æœå®šä¹‰äº†ç›¸åŒåå­—çš„ C å‡½æ•°ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</a> ï¼Œ<a href="https://twitter.com/_X140Yu/status/984308379173568513" target="_blank" rel="noopener">è°ƒç”¨ category æ–¹æ³•ä¼š crash</a> ç­‰ç­‰ï¼Œä¸è¿‡éƒ½æ¯”è¾ƒå¥½è§£å†³ï¼Œä¸åƒ Dynamic Framework é‚£æ ·æœ‰ç¡¬ä¼¤ã€‚</p><p>æ€»ä½“ä¸Šæ¥è¯´ï¼Œä½¿ç”¨é™æ€åº“è¿˜æ˜¯æ¯”åŠ¨æ€åº“æœ‰ä¼˜åŠ¿çš„ã€‚</p><p>ç„¶è€Œè¦æƒ³åœ¨é¡¹ç›®ä¸­ä½¿ç”¨è¿™ä¸ª featureï¼Œéœ€è¦åœ¨ <code>podspec</code> æ˜¾ç¤ºæŒ‡å®š <code>s.static_framework = true</code>ï¼Œå¯¹äºé›†æˆ 100 å¤šä¸ª pod çš„é¡¹ç›®æ¥è¯´ï¼Œä¸€ä¸ªä¸ªæ”¹èµ·æ¥å¤ªéº»çƒ¦äº†ï¼Œä¹Ÿä¸ç°å®ã€‚ä½†æ˜¯ CocoaPods æ˜¯ Ruby å†™çš„å‘€ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ patch CocoaPods æ¥å®ç°åœ¨åªå†™å‡ è¡Œä»£ç çš„æƒ…å†µä¸‹ï¼ŒæŠŠæ‰€æœ‰ pod å˜æˆ Static Frameworkï¼Œ</p><p>å¾—ç›Šäº Ruby çš„åŠ¨æ€æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ podfile ä¸­ä¹¦å†™ä»¥ä¸‹ä»£ç ï¼Œå®ç°é™æ€åº“çš„ patch è€Œä¸éœ€è¦ä¿®æ”¹ podspecï¼Œ</p><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">pre_install <span class="keyword">do</span> <span class="params">|_|</span></span><br><span class="line">  Pod::PodTarget.send(<span class="symbol">:define_method</span>, <span class="symbol">:static_framework?</span>) &#123; <span class="literal">true</span> &#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å¯¹äº PodTarget çš„ patch å°±ä¼šåœ¨ <code>pod install</code> çš„æ—¶å€™ç”Ÿæ•ˆï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä¸éœ€è¦æ”¹æ¯ä¸ª pod çš„ podspec å°±å¯ä»¥å®ç°æ¯ä¸ª pod éƒ½æ˜¯ <code>static_framework</code> çš„æ•ˆæœäº†ï¼Œenjoy~<br>â€‹</p><h2 id="Revision"><a href="#Revision" class="headerlink" title="Revision"></a>Revision</h2><ul><li>2018-12-25 æŠŠ Static Library æ”¹ä¸º Static Framework</li><li>2018-09-19 æ›´æ–°äº† patch podfile çš„è„šæœ¬</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;CocoaPods 1.5 is amazing!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;blog.cocoapods.org/CocoaPods-1.5.0/&quot;&gt;CocoaPods 1.5&lt;/a&gt; åœ¨å‰ä¸€æ®µæ—¶é—´ release äº†ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå¯¹äºä½¿ç”¨äº† Swift çš„é¡¹ç›®éå¸¸é‡è¦ featureï¼Œé‚£å°±æ˜¯æ”¯æŒäº† Swift çš„ Static Frameworkã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="https://x140yu.github.io/tags/iOS/"/>
    
      <category term="ruby" scheme="https://x140yu.github.io/tags/ruby/"/>
    
      <category term="CocoaPods" scheme="https://x140yu.github.io/tags/CocoaPods/"/>
    
  </entry>
  
  <entry>
    <title>ç®¡ç† iOS é¡¹ç›®çš„ ruby ä¾èµ–</title>
    <link href="https://x140yu.github.io/2018-04-17-bundler-in-ios-proj/"/>
    <id>https://x140yu.github.io/2018-04-17-bundler-in-ios-proj/</id>
    <published>2018-04-16T14:00:00.000Z</published>
    <updated>2019-08-19T07:43:25.675Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨å¤šäººåä½œçš„ç¯å¢ƒé‡Œç®¡ç†ä¾èµ–ä¸€è‡´æ€§æ˜¯ä¸€ä»¶å¾ˆè›‹ç–¼çš„äº‹æƒ…ã€‚</p><a id="more"></a><p>å°±æ‹¿ä½¿ç”¨ CocoaPods çš„å›¢é˜Ÿæ¥è¯´ï¼Œåœ¨æŸä¸ªæ—¶é—´ç‚¹ï¼Œä½ æƒ³æŠŠå®ƒå‡çº§åˆ°æŸä¸ªç‰ˆæœ¬ï¼Œ</p><p>æœ€æŒ«çš„åŠæ³•æ˜¯é€šçŸ¥æ‰€æœ‰äººï¼ˆåŒ…æ‹¬ CIï¼‰éƒ½å‡çº§åˆ°ç‰¹å®šçš„ç‰ˆæœ¬ï¼Œä¿æŒç‰ˆæœ¬çš„ä¸€è‡´ï¼Œä½†è¿™ä¸èƒ½è§£å†³ devï¼Œmaster åˆ†æ”¯çš„é—®é¢˜ï¼Œè¦å‡å°±å¾—å…¨å‡çº§ï¼Œä¸ç„¶ä¸åŒç‰ˆæœ¬é—´ä¼šäº’ç›¸å½±å“ï¼›</p><p>æ¯”è¾ƒå¥½ä¸€ç‚¹çš„æ–¹å¼æ˜¯åœ¨å·¥ç¨‹ setup çš„è„šæœ¬é‡Œé¢æ£€æµ‹ä¾èµ–çš„ç‰ˆæœ¬ï¼Œå¹¶å¸®ä½¿ç”¨è€…è‡ªåŠ¨å‡çº§åˆ°è¯¥ç‰ˆæœ¬ï¼Œæ¯”å¦‚<a href="https://gist.github.com/X140Yu/18195cf17611b38072e908d9efa2dd22" target="_blank" rel="noopener">åƒè¿™æ ·</a>ï¼Œå°±ä¸ç”¨å…³å¿ƒ masterï¼Œdev åˆ†æ”¯ä¾èµ–ä¸€è‡´æ€§çš„é—®é¢˜äº†ï¼Œç”¨å“ªä¸ªåˆ†æ”¯çš„ä»£ç ä¾èµ–çš„å°±æ˜¯å“ªä¸ªç‰ˆæœ¬ï¼Œç¼ºç‚¹æ˜¯éœ€è¦ç¼–å†™è„šæœ¬ï¼Œéº»çƒ¦ï¼›</p><p>æœ€å¥½çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨ <a href="http://bundler.io/" target="_blank" rel="noopener">bundler</a> æ¥ç®¡ç†ä¾èµ–äº†ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ª Gemfileï¼Œæ¯æ¬¡ setup çš„æ—¶å€™æ‰§è¡Œ<br> <code>bundle install</code> ï¼Œæ‰€æœ‰å¼€å‘è€…çš„ ruby ä¾èµ–å°±éƒ½æ˜¯ä¸€è‡´äº†çš„ã€‚</p><h2 id="å¦‚ä½•ä½¿ç”¨"><a href="#å¦‚ä½•ä½¿ç”¨" class="headerlink" title="å¦‚ä½•ä½¿ç”¨"></a>å¦‚ä½•ä½¿ç”¨</h2><p>å¦‚æœä½ çš„å·¥ç¨‹ä»æœªé›†æˆè¿‡ bundlerï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨ <code>bundle init</code> åˆ›å»ºå‡º Gemfileï¼Œ</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; bundle init</span><br><span class="line">Writing new Gemfile to /xxx/Gemfile</span><br></pre></td></tr></table></figure><p>ç„¶åä¿®æ”¹ Gemfileï¼Œå…·ä½“å¯ä»¥åŠ ä»€ä¹ˆå†…å®¹å¯ä»¥<a href="http://bundler.io/gemfile.html" target="_blank" rel="noopener">çœ‹è¿™é‡Œ</a></p><figure class="highlight rb"><table><tr><td class="code"><pre><span class="line">source <span class="string">"https://rubygems.org"</span></span><br><span class="line"></span><br><span class="line">gem <span class="string">'CocoaPods'</span>, <span class="string">'1.5'</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°± ok äº†ï¼Œæ¯æ¬¡ setup å·¥ç¨‹çš„æ—¶å€™ï¼Œæ‰§è¡Œ <code>bundle install</code> å°±å¯ä»¥ä¿è¯å¤§å®¶çš„ä¾èµ–éƒ½æ˜¯ä¸€è‡´çš„ã€‚å‡çº§ç‰ˆæœ¬åªéœ€è¦ä¿®æ”¹ä¸€ä¸‹ç‰ˆæœ¬å·ï¼Œä¸€åˆ‡å°±æ˜¯è¿™æ ·ç®€å•</p><hr><p>å†™åˆ°è¿™é‡Œï¼Œæˆ‘è¿˜æƒ³åˆ†äº«ä¸€ä¸‹æˆ‘ setup å·¥ç¨‹çš„æ–¹å¼ï¼Œé‚£å°±æ˜¯ä½¿ç”¨ <code>Makefile</code>ã€‚<a href="https://zhaoxinyu.me/2017-07-08-ios-oss-1/" target="_blank" rel="noopener">è¿™</a><a href>æ˜¯</a><a href="https://zhaoxinyu.me/2017-07-08-ios-oss-1/" target="_blank" rel="noopener">æˆ‘åœ¨ KickStarter å¼€æºçš„å·¥ç¨‹é‡Œå­¦åˆ°çš„</a>ã€‚ä¸€å±‚ç®€å•çš„å°è£…ä¸å…‰æŠŠåˆå§‹åŒ–ä¸€ä¸ªå·¥ç¨‹çš„ä¸€è¿ä¸²æ“ä½œéƒ½åŒ…åœ¨äº†ä¸€èµ·ï¼Œè¿˜æŠŠè¿™ä¸ªè¿‡ç¨‹åœ°å…¥å£å˜å¾—è¶³å¤Ÿç®€å•ï¼Œä¸€å¥ <code>make</code> è¶³çŸ£ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨å¤šäººåä½œçš„ç¯å¢ƒé‡Œç®¡ç†ä¾èµ–ä¸€è‡´æ€§æ˜¯ä¸€ä»¶å¾ˆè›‹ç–¼çš„äº‹æƒ…ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="https://x140yu.github.io/tags/iOS/"/>
    
      <category term="ruby" scheme="https://x140yu.github.io/tags/ruby/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Ruby Gem åˆ›å»ºå‘½ä»¤è¡Œå·¥å…·</title>
    <link href="https://x140yu.github.io/2018-04-16-create-cli-using-gem/"/>
    <id>https://x140yu.github.io/2018-04-16-create-cli-using-gem/</id>
    <published>2018-04-16T08:54:00.000Z</published>
    <updated>2019-08-19T07:43:25.675Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰æ›¾ç»ä¾èµ–è¿‡ Homebrew Formula <a href="https://zhaoxinyu.me/2018-01-24-homebrew-formula/" target="_blank" rel="noopener">åˆ›å»ºè¿‡åŸºäº Ruby çš„å‘½ä»¤è¡Œå·¥å…·</a>ã€‚ä½†åˆ›å»ºè¿‡ç¨‹ç¹çï¼Œå¯¹äºä¾èµ–çš„å¤„ç†ä¸æ˜¯å¾ˆå‹å¥½è€Œä¸”æ²¡åŠæ³•è®©å…¶å®ƒäººä¾èµ–ç‰¹å®šçš„ç‰ˆæœ¬ã€‚æ—¢ç„¶æ˜¯åšåŸºäº Ruby çš„ CLIï¼Œé‚£ä¸ºä»€ä¹ˆä¸æŠŠå®ƒåšæˆä¸€ä¸ª gemï¼Ÿ</p><a id="more"></a><h2 id="é€šè¿‡-Gem-æ­å»º-CLI"><a href="#é€šè¿‡-Gem-æ­å»º-CLI" class="headerlink" title="é€šè¿‡ Gem æ­å»º CLI"></a>é€šè¿‡ Gem æ­å»º CLI</h2><p>å¦‚æœæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªåå­—å« CLIGem çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒä¾èµ– <code>gli</code> è¿™ä¸ª gemï¼Œå®ƒæä¾›ä¸€ä¸ªå‘½ä»¤ <code>cg</code>ï¼Œåœ¨æ‰§è¡Œåä¼šè¾“å‡ºä¸€å¥è¯ <code>Hello, world!</code>ã€‚åˆ›å»ºä¸€ä¸ªè¿™æ ·çš„ CLI éœ€è¦å“ªäº›è¿‡ç¨‹å‘¢ï¼Ÿ</p><h3 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h3><p>é¦–å…ˆæ‰§è¡Œ <code>bundle gem CLIGem</code> ï¼Œç›¸å½“äºæ‰§è¡Œä¸€ä¸ªè„šæ‰‹æ¶ï¼Œå®ƒä¼šé€šè¿‡æ¨¡æ¿å¸®ä½ åˆ›å»ºå‡ºä¸€ä¸ªå·²ç»æ­å»ºå¥½çš„æ¡†æ¶</p><h3 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h3><p>æ‰“å¼€ <code>CLIGem.gemspec</code>ï¼Œæ·»åŠ  <code>spec.add_dependency &quot;gli&quot;, &quot;~&gt; 2.0&quot;</code> ï¼Œè¿™é‡Œæœ€å¥½è¦æŒ‡å®šç‰ˆæœ¬å·</p><h3 id="æ·»åŠ å‘½ä»¤è¡Œå…¥å£"><a href="#æ·»åŠ å‘½ä»¤è¡Œå…¥å£" class="headerlink" title="æ·»åŠ å‘½ä»¤è¡Œå…¥å£"></a>æ·»åŠ å‘½ä»¤è¡Œå…¥å£</h3><p>é€šè¿‡ä¿®æ”¹ <code>.gemspec</code> çš„ <code>bindir</code> è¿˜æœ‰ <code>executables</code> å­—æ®µå¯ä»¥æŠŠå‘½ä»¤æš´éœ²ç»™å®‰è£…è¿™ä¸ª gem çš„äººï¼Œè¾¾åˆ°æˆä¸ºä¸€ä¸ª CLI çš„ç›®çš„ã€‚</p><figure class="highlight rb"><table><tr><td class="code"><pre><span class="line">spec.bindir        = <span class="string">"exe"</span></span><br><span class="line">spec.executables   = <span class="string">"cg"</span></span><br></pre></td></tr></table></figure><p>éœ€è¦åœ¨è¦ç›®å½•åˆ›å»ºä¸€ä¸ªç›®å½• <code>exe</code>ï¼Œæ·»åŠ ä¸€ä¸ªæ–°æ–‡ä»¶ <code>cg</code> å¹¶æ·»åŠ å¯æ‰§è¡Œçš„æƒé™ã€‚<code>cg</code> çš„å†…å®¹å¦‚ä¸‹ï¼Œ</p><figure class="highlight rb"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/ruby</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">'gli'</span></span><br><span class="line"></span><br><span class="line">puts <span class="string">"Hello, world!"</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>å¦‚æœæŠŠå®ƒå‘å¸ƒå‡ºå»ï¼Œé‚£é€šè¿‡ <code>gem install CLIGem</code> å®‰è£…å°±å¯ä»¥äº†</p><p>ä½†å¦‚æœä¸æƒ³å‘å¸ƒï¼Œè¦å¦‚ä½•å®‰è£…ä½¿ç”¨å‘¢ï¼Ÿ</p><p>æ‰€å¹¸ gem æä¾›äº†é€šè¿‡æºç å®‰è£…çš„æ–¹å¼ã€‚<code>gem build</code> å¯ä»¥æ ¹æ®ä¸€ä¸ª <code>gemspec</code> ç”Ÿæˆä¸€ä¸ª <code>.gem</code> æ–‡ä»¶ä¾› gem å®‰è£…ï¼Œæ‰€ä»¥åœ¨æ‹¥æœ‰æºç çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹å‡ å¥å°±å¯ä»¥å®‰è£…äº†ï¼Œ</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gem build CLIGem.gemspec</span><br><span class="line">gem install *.gem</span><br></pre></td></tr></table></figure><p>å¦‚æœåˆ«äººé€šè¿‡ bundler æ¥ä¾èµ–ä½ ï¼Œé‚£ä¹ˆä»–å¯ä»¥åœ¨å·¥ç¨‹ä¸­çš„ <code>Gemfile</code> ä¸­è¿™æ ·å†™ï¼Œ</p><figure class="highlight rb"><table><tr><td class="code"><pre><span class="line">gem <span class="string">'CLIGem'</span>, <span class="symbol">:git</span> =&gt; <span class="string">'git@git.xxx.com:xxx/CLIGem.git'</span>, <span class="symbol">:tag</span> =&gt; <span class="string">'1.0.1'</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæ¯æ¬¡ <code>bundle install</code>ï¼Œä¾èµ–å°±ä¼šè‡ªåŠ¨å®‰è£…æˆåŠŸäº†</p><h2 id="ä¸-Homebrew-Formula-çš„åŒºåˆ«ï¼ˆéƒ½æ˜¯é€šè¿‡æºç è€Œéå‘å¸ƒçš„å®‰è£…æƒ…å†µä¸‹ï¼‰"><a href="#ä¸-Homebrew-Formula-çš„åŒºåˆ«ï¼ˆéƒ½æ˜¯é€šè¿‡æºç è€Œéå‘å¸ƒçš„å®‰è£…æƒ…å†µä¸‹ï¼‰" class="headerlink" title="ä¸ Homebrew Formula çš„åŒºåˆ«ï¼ˆéƒ½æ˜¯é€šè¿‡æºç è€Œéå‘å¸ƒçš„å®‰è£…æƒ…å†µä¸‹ï¼‰"></a>ä¸ Homebrew Formula çš„åŒºåˆ«ï¼ˆéƒ½æ˜¯é€šè¿‡æºç è€Œéå‘å¸ƒçš„å®‰è£…æƒ…å†µä¸‹ï¼‰</h2><table><thead><tr><th></th><th>Gem</th><th>Homebrew Formula</th></tr></thead><tbody><tr><td>ä¾èµ–å®‰è£…ã€ä¸Šæ‰‹å®¹æ˜“</td><td>âœ…</td><td>âŒ</td></tr><tr><td>ç‰ˆæœ¬ç®¡ç†</td><td>âœ…</td><td>âŒ</td></tr><tr><td>bundler å‹å¥½</td><td>âœ…</td><td>âŒ</td></tr><tr><td>å®‰è£…æ›´æ–°å®¹æ˜“</td><td>âŒ</td><td>âœ…</td></tr></tbody></table><p>æ€»ä½“æ¥çœ‹ï¼Œå¦‚æœæ˜¯ä½¿ç”¨ ruby ç¼–å†™ CLIï¼Œä½¿ç”¨ gem æ¯”ä½¿ç”¨ Homebrew æ­å»ºæ›´åŠ æ–¹ä¾¿ã€‚å³ä½¿å‰è€…å®‰è£…æ›´æ–°éº»çƒ¦ä¸€äº›ï¼ˆéœ€è¦ clone æºç ï¼‰ï¼Œä½†å¯ä»¥é€šè¿‡æŠŠè¿™äº›æ“ä½œå°è£…æˆ shell è„šæœ¬æ¥è§£å†³ã€‚æ€»ä½“æ¥è¯´ï¼Œä½¿ç”¨ Gem ç¼–å†™ CLI ä½“éªŒæ›´å¥½ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¹‹å‰æ›¾ç»ä¾èµ–è¿‡ Homebrew Formula &lt;a href=&quot;https://zhaoxinyu.me/2018-01-24-homebrew-formula/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åˆ›å»ºè¿‡åŸºäº Ruby çš„å‘½ä»¤è¡Œå·¥å…·&lt;/a&gt;ã€‚ä½†åˆ›å»ºè¿‡ç¨‹ç¹çï¼Œå¯¹äºä¾èµ–çš„å¤„ç†ä¸æ˜¯å¾ˆå‹å¥½è€Œä¸”æ²¡åŠæ³•è®©å…¶å®ƒäººä¾èµ–ç‰¹å®šçš„ç‰ˆæœ¬ã€‚æ—¢ç„¶æ˜¯åšåŸºäº Ruby çš„ CLIï¼Œé‚£ä¸ºä»€ä¹ˆä¸æŠŠå®ƒåšæˆä¸€ä¸ª gemï¼Ÿ&lt;/p&gt;
    
    </summary>
    
    
      <category term="ruby" scheme="https://x140yu.github.io/tags/ruby/"/>
    
  </entry>
  
  <entry>
    <title>ä¸¤ä¸ª Framework ä¸­å¦‚æœå®šä¹‰äº†ç›¸åŒåå­—çš„ C å‡½æ•°ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</title>
    <link href="https://x140yu.github.io/2018-04-14-what-happends-if-two-frameworks-defines-same-c-functions/"/>
    <id>https://x140yu.github.io/2018-04-14-what-happends-if-two-frameworks-defines-same-c-functions/</id>
    <published>2018-04-14T13:05:00.000Z</published>
    <updated>2019-08-19T07:43:25.674Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡åŸºäºå¤§é‡çŒœæµ‹ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œè¯·æŒ‡å‡º ğŸ‘»</p></blockquote><h2 id="0x01-èµ·å› "><a href="#0x01-èµ·å› " class="headerlink" title="0x01 èµ·å› "></a>0x01 èµ·å› </h2><p>å‰ä¸€æ®µæ—¶é—´ç»™å…¬å¸çš„é¡¹ç›®å‡çº§ CocoaPods 1.5ï¼Œæ‰“ç®—æŠŠæ‰€æœ‰çš„ Pods ç”± Dynamic å˜ä¸º Static é›†æˆã€‚åœ¨é›†æˆå®Œæ¯•è°ƒè¯•çš„æ—¶å€™ï¼Œåˆ°å¤„ä¹±ç‚¹è§¦å‘äº†ä¸€æ¬¡ Crashï¼Œå †æ ˆå¤§æ¦‚é•¿è¿™æ ·ï¼Œ</p><a id="more"></a><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216225127.png" alt></p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216225146.png" alt></p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216225159.png" alt></p><p>å¤§æ¦‚çš„è¿‡ç¨‹æ˜¯ï¼Œ<code>ZipArchive</code> åœ¨å†…éƒ¨è°ƒç”¨ <code>fill_fopen64_filefunc</code> è¿™ä¸ª C æ–¹æ³•çš„æ—¶å€™ï¼Œè·³åˆ°äº† <code>Instabug</code> çš„åŒåå‡½æ•°å®ç°ä¸­ï¼Œç„¶åå°±å‘ç”Ÿäº† crash</p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216225213.png" alt></p><p>åˆšçœ‹åˆ°è¿™ä¸ªå †æ ˆçš„æ—¶å€™ï¼Œæˆ‘ä¹Ÿæ˜¯ä¸€è„¸æ‡µé€¼ï¼Œåœ¨ä¸€ä¸ª Framework å†…éƒ¨è°ƒç”¨æ–¹æ³•ï¼Œæ€ä¹ˆå°±è°ƒåˆ°å¦ä¸€ä¸ª Framework ä¸­çš„åŒåæ–¹æ³•äº†å‘¢ï¼Ÿéš¾ä¸æˆæ˜¯é™æ€åº“å¯¼è‡´çš„ï¼Ÿ</p><h2 id="0x02-å°è¯•"><a href="#0x02-å°è¯•" class="headerlink" title="0x02 å°è¯•"></a>0x02 å°è¯•</h2><p>æŠ±ç€è¯•ä¸€è¯•çš„å¿ƒæ€ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ª Demo å·¥ç¨‹ï¼Œä»¥ Development Pods çš„å½¢å¼ä¾èµ– Aã€B ä¸¤ä¸ª Podsï¼ˆ<code>use_framework!</code>ï¼‰ï¼Œ</p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216225226.png" alt></p><p>è°ƒç”¨ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•ï¼Œ</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">testA();</span><br><span class="line">testB();</span><br></pre></td></tr></table></figure><p>åœ¨éƒ½ä»¥ Dynamic Libraryï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰é›†æˆ Aï¼ŒB çš„æƒ…å†µä¸‹ï¼Œä¸Šé¢è°ƒç”¨è¾“å‡ºçš„ç»“æœæ˜¯ï¼Œ</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">AAAAAA</span><br><span class="line">BBBBBBB</span><br></pre></td></tr></table></figure><p>å—¯ï¼Œæ„æ–™ä¹‹ä¸­</p><p>ä½¿ç”¨ CocoaPods çš„æ–° featureï¼Œä»¥ Static Library çš„å½¢å¼ä¾èµ– A ä¸ Bï¼Œå†çœ‹çœ‹ä¸Šè¿°è°ƒç”¨çš„ç»“æœï¼Œ</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">BBBBBBB</span><br><span class="line">BBBBBBB</span><br></pre></td></tr></table></figure><p>å› ç¼ºæ€å…ï¼Œçœ‹æ¥å¤ç°äº†æˆ‘ä»¬ä¸€å¼€å§‹é‡åˆ°çš„é—®é¢˜</p><h2 id="0x03-åŸå› "><a href="#0x03-åŸå› " class="headerlink" title="0x03 åŸå› "></a>0x03 åŸå› </h2><p>åŠ¨æ€åº“å’Œé™æ€åº“çš„ä¸€ä¸ªæ˜æ˜¾çš„åŒºåˆ«æ˜¯ï¼Œä¼šä¸ä¼šè¢«é›†æˆåˆ°æœ€åçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­å»ã€‚</p><h3 id="é™æ€åº“"><a href="#é™æ€åº“" class="headerlink" title="é™æ€åº“"></a>é™æ€åº“</h3><p>åœ¨ link é™æ€åº“æ—¶å€™ï¼Œlinker ä¼šæŠŠå®ƒéœ€è¦çš„ä¸œè¥¿å¤åˆ¶åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œç”¨ <code>nm</code> æŸ¥çœ‹ä»¥ä¾èµ– Static Library é›†æˆçš„ binaryï¼Œ</p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216225254.png" alt></p><p>å¯ä»¥å‘ç°ï¼Œåœ¨ Static Library ä¸­çš„å‡½æ•°ç¬¦å·å‡ºç°åœ¨äº†æœ€åçš„ binary ä¸­ï¼ˆT ä»£è¡¨å…¨å±€ä»£ç æ®µç¬¦å·ï¼‰ï¼Œä½†ç”±äºè¿™ä¸¤ä¸ªå‡½æ•°çš„åå­—éƒ½æ˜¯ <code>test</code>ï¼Œæœ€ç»ˆåªæœ‰ä¸€ä¸ªå‡½æ•°å®ç°è¢«åˆå¹¶è¿›å»äº†ã€‚</p><p>è¿™ä¸ª <code>test</code> çš„å®ç°ä¸ºä»€ä¹ˆä¼šæŒ‡å‘ B å‘¢ï¼Ÿé€šè¿‡ä¿®æ”¹ <code>OTHER_LDFLAGS</code> å¤šæ¬¡å®éªŒåå‘ç°ï¼Œè¿™é‡Œçš„å®ç°æŒ‡å‘è·Ÿ link çš„é¡ºåºæœ‰å…³ï¼Œæˆ‘çŒœæµ‹ï¼Œå¦‚æœæ˜¯å link Bï¼Œé‚£ä¹ˆ linker åœ¨å¤åˆ¶ B ä¸­ç¬¦å·çš„æ—¶å€™ä¼šæŠŠå·²ç»å¤åˆ¶è¿‡çš„ A çš„ç¬¦å·è¦†ç›–ï¼Œå¯¼è‡´ A çš„å®ç°å°±ä¸è§äº†ã€‚å¦‚æœå link Aï¼Œé‚£åŒç†ï¼ŒB çš„å®ç°ä¼šè¢«è¦†ç›–ã€‚</p><h3 id="åŠ¨æ€åº“"><a href="#åŠ¨æ€åº“" class="headerlink" title="åŠ¨æ€åº“"></a>åŠ¨æ€åº“</h3><p>åœ¨ä»¥åŠ¨æ€åº“é›†æˆçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç”¨ <code>nm</code> æŸ¥çœ‹ä¸€ä¸‹ <code>xxx.app/xxx</code>ï¼Œ<code>xxx.app/Frameworks/A.framework/A</code> ä»¥åŠ <code>xxx.app/Frameworks/B.framework/B</code>ï¼Œ</p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216225311.png" alt></p><p>å¯ä»¥å‘ç°ï¼Œåœ¨æœ€ç»ˆ binary ä¸­ï¼Œå¹¶æœªåŒ…å« A æˆ– B ä¸­çš„ä»»ä½•ç¬¦å·ï¼ˆU ä»£è¡¨æœªå®šä¹‰ç¬¦å·ï¼‰ï¼ŒçœŸæ­£çš„ç¬¦å·å­˜åœ¨äºå®ƒä»¬å„è‡ªçš„ framework ä¸­ï¼Œå³ä½¿ C å‡½æ•°åé‡å¤ä¹Ÿä¸ä¼šå½±å“çœŸæ­£çš„è°ƒç”¨ã€‚</p><p>å®é™…ä¸Šå…¬å¸çš„é¡¹ç›®çš„åœºæ™¯æ¯”æˆ‘ä¸Šé¢ä»‹ç»çš„è¿˜è¦å¤æ‚ä¸€äº›ï¼ŒInstabug å’Œ ZipArchive éƒ½æ˜¯ç”¨ Pods é›†æˆçš„ï¼Œè¿˜ä½¿ç”¨äº† <a href="https://github.com/Ruenzuo/cocoapods-amimono" target="_blank" rel="noopener">cocoapods-amimono</a> æ’ä»¶ï¼Œåœ¨æ²¡æœ‰å‡çº§åˆ° CocoaPods 1.5 çš„æ—¶å€™æ²¡æœ‰å‡ºç°é—®é¢˜ã€‚</p><p>ä½†å½“æŠŠ cocoapods-amimono æ‹¿æ‰ï¼Œä½¿ç”¨ CocoaPods 1.5 çš„ Static Framework åŠŸèƒ½ï¼Œå°±ä¼šå‘ç° <code>fill_fopen64_filefunc</code> åœ¨ main binary ä¸­æˆäº†æœªå®šä¹‰çš„ç¬¦å·ï¼Œä¹Ÿå°±æ˜¯ ZipArchive ä¸­çš„å‡½æ•°å¹¶æœªå…¨è¢«æ‹·è´è¿›æœ€ç»ˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯æŒ‡å‘äº† Instabug.framework ä¸­ã€‚</p><p>Instabug çš„ä»£ç æ˜¯æå‰ç¼–è¯‘å¥½çš„ï¼Œlinker æ²¡æœ‰åŠæ³•æŠŠè¿™éƒ¨åˆ†ä»£ç åˆå…¥ binaryã€‚åœ¨ ZipArchive æ˜¯é™æ€åº“çš„æƒ…å†µä¸‹ï¼Œlinker å‘ç°äº† Instabug ä¸­å­˜åœ¨äº†è¿™ä¸ªå‡½æ•°ï¼Œå°±æ²¡æœ‰æŠŠ ZipArchive çš„æ‹·è´è¿›å»ï¼ˆéƒ½æ˜¯çŒœçš„ =ã€‚=</p><h2 id="0x04-ç»“è®º"><a href="#0x04-ç»“è®º" class="headerlink" title="0x04 ç»“è®º"></a>0x04 ç»“è®º</h2><p>å¦‚æœä½ çš„åº“ä¸­åŒ…å«æŸäº› C çš„å‡½æ•°æˆ–è€…å…¨å±€å˜é‡ï¼Œå³ä½¿æ²¡æœ‰æš´éœ²åˆ°å¤–é¢ï¼Œä¹Ÿè¦è®°å¾—åŠ å‰ç¼€ã€‚å¯¹äºæ²¡æœ‰ namespace çš„è¯­è¨€ï¼ŒåŠ å‰ç¼€æ€»æ˜¯æ²¡é”™çš„ï¼Œå¦‚æœè¿˜æ˜¯æœ‰é”™ï¼Œé‚£å°±å¤šåŠ å‡ ä½ ğŸ¤£</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡åŸºäºå¤§é‡çŒœæµ‹ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œè¯·æŒ‡å‡º ğŸ‘»&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;0x01-èµ·å› &quot;&gt;&lt;a href=&quot;#0x01-èµ·å› &quot; class=&quot;headerlink&quot; title=&quot;0x01 èµ·å› &quot;&gt;&lt;/a&gt;0x01 èµ·å› &lt;/h2&gt;&lt;p&gt;å‰ä¸€æ®µæ—¶é—´ç»™å…¬å¸çš„é¡¹ç›®å‡çº§ CocoaPods 1.5ï¼Œæ‰“ç®—æŠŠæ‰€æœ‰çš„ Pods ç”± Dynamic å˜ä¸º Static é›†æˆã€‚åœ¨é›†æˆå®Œæ¯•è°ƒè¯•çš„æ—¶å€™ï¼Œåˆ°å¤„ä¹±ç‚¹è§¦å‘äº†ä¸€æ¬¡ Crashï¼Œå †æ ˆå¤§æ¦‚é•¿è¿™æ ·ï¼Œ&lt;/p&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="https://x140yu.github.io/tags/iOS/"/>
    
      <category term="C" scheme="https://x140yu.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>Swift ä¸­çš„æ–¹æ³•è°ƒç”¨ï¼ˆMethod Dispatchï¼‰ï¼ˆä¸€ï¼‰ - æ¦‚è¿°</title>
    <link href="https://x140yu.github.io/2018-04-08-method-dispatch-in-swift-1/"/>
    <id>https://x140yu.github.io/2018-04-08-method-dispatch-in-swift-1/</id>
    <published>2018-04-08T15:25:00.000Z</published>
    <updated>2019-08-19T07:43:25.674Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Objective-C æ–¹æ³•è°ƒç”¨çš„æ–¹å¼æ˜¯å‘æ¶ˆæ¯ï¼Œé‚£ Swift æ–¹æ³•è°ƒç”¨çš„æ–¹å¼æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿææ¸…æ¥š Swift ä¸­æ–¹æ³•è°ƒç”¨çš„æ–¹å¼ï¼Œä¼šå¯¹äºæˆ‘ä»¬ç†è§£ Swift æœ‰æ›´å¥½çš„å¸®åŠ©</p><p>Swift 4 &amp; Xcode 9.2</p></blockquote><p>å…ˆçœ‹ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// DogStruct.swift</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DogStruct</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">makeNoise</span><span class="params">()</span></span> &#123; </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"bark in struct!"</span>) </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ds = <span class="type">DogStruct</span>()</span><br><span class="line">ds.makeNoise()</span><br></pre></td></tr></table></figure><a id="more"></a><p>æˆ‘ä»¬å¦‚ä½•çŸ¥é“ <code>ds.makeNoise()</code> æ˜¯å¦‚ä½•è°ƒç”¨çš„å‘¢ï¼Ÿæ˜¯ <code>objc_msgSend</code> å—ï¼Ÿå…‰é çŒœå¯èƒ½ä¸å¤ªè¡Œï¼Œè¿™é‡Œæˆ‘ä»¬å°±è¦é€šè¿‡ <a href="https://github.com/apple/swift/blob/master/docs/SIL.rst" target="_blank" rel="noopener">SIL</a> æ¥åˆ†æä¸€ä¸‹äº†ã€‚SIL èƒ½å¤Ÿä½“ç° Swift çš„å®ç°ç»†èŠ‚ï¼Œåˆ†æ SIL èƒ½è®©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£ Swift ä»£ç æ‰§è¡Œçš„è¿‡ç¨‹ã€‚</p><p>ä½¿ç”¨ <code>swiftc</code> æŠŠä¸Šé¢è¿™ä¸ªæ–‡ä»¶å¤„ç†ä¸€ä¸‹ï¼Œç”Ÿæˆ <code>DogStuct.sil</code>ï¼Œ</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ swiftc ç”Ÿæˆ SILï¼Œä¸å¼€å¯ç¼–è¯‘å™¨ä¼˜åŒ–</span></span><br><span class="line">swiftc -emit-silgen DogStruct.swift -Onone &gt; DogStruct.sil</span><br></pre></td></tr></table></figure><p>æ‰“å¼€ <code>DogStruct.sil</code>ï¼Œåˆšæ‰çš„ä»£ç è¢«ç¼–è¯‘æˆäº†ä¸€ä¸ª 90 å‡ è¡Œçš„ SIL æ–‡ä»¶ï¼Œä¸‹é¢è¿™å‡ è¡Œä»£è¡¨æˆ‘ä»¬çš„ <code>main</code> å‡½æ•°ï¼ˆå…¶å®ƒéƒ¨åˆ†å·²çœç•¥ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±å°è¯•ç”Ÿæˆï¼‰ï¼Œ</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// main</span><br><span class="line">sil @main : $@convention(c) (Int32, UnsafeMutablePointer&lt;Optional&lt;UnsafeMutablePointer&lt;Int8&gt;&gt;&gt;) -&gt; Int32 &#123;</span><br><span class="line">bb0(%0 : $Int32, %1 : $UnsafeMutablePointer&lt;Optional&lt;UnsafeMutablePointer&lt;Int8&gt;&gt;&gt;):</span><br><span class="line">  alloc_global @_T06vtable2dsAA9DogStructVv       // id: %2</span><br><span class="line">  %3 = global_addr @_T06vtable2dsAA9DogStructVv : $*DogStruct // users: %9, %7</span><br><span class="line">  // function_ref DogStruct.init()</span><br><span class="line">  %4 = function_ref @_T06vtable9DogStructVACycfC : $@convention(method) (@thin DogStruct.Type) -&gt; DogStruct // user: %6</span><br><span class="line">  %5 = metatype $@thin DogStruct.Type             // user: %6</span><br><span class="line">  %6 = apply %4(%5) : $@convention(method) (@thin DogStruct.Type) -&gt; DogStruct // user: %7</span><br><span class="line">  store %6 to [trivial] %3 : $*DogStruct          // id: %7</span><br><span class="line">  // function_ref DogStruct.makeNoise()</span><br><span class="line">  %8 = function_ref @_T06vtable9DogStructV9makeNoiseyyF : $@convention(method) (DogStruct) -&gt; () // user: %10</span><br><span class="line">  %9 = load [trivial] %3 : $*DogStruct            // user: %10</span><br><span class="line">  %10 = apply %8(%9) : $@convention(method) (DogStruct) -&gt; ()</span><br><span class="line">  %11 = integer_literal $Builtin.Int32, 0         // user: %12</span><br><span class="line">  %12 = struct $Int32 (%11 : $Builtin.Int32)      // user: %13</span><br><span class="line">  return %12 : $Int32                             // id: %13</span><br><span class="line">&#125; // end sil function &apos;main&apos;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ 4 ~ 10 è¡Œæ˜¯ <code>let ds = DogStruct()</code> çš„è¿‡ç¨‹ã€‚ç¨‹åºå…ˆä¸º <code>ds</code> åˆ›å»ºäº†ä¸€å—å…¨å±€çš„ç©ºé—´ï¼Œç„¶åç”¨ <code>%3</code> æŒ‡å‘å®ƒï¼›æ‹¿åˆ° <code>DogStruct.init()</code> çš„å‡½æ•°å¼•ç”¨ï¼ˆ<a href="https://github.com/apple/swift/blob/master/docs/SIL.rst#function-ref" target="_blank" rel="noopener">function_ref</a>ï¼Œ<code>%4</code>)ä»¥åŠ <code>DogStruct.Type</code> (<code>%5</code>)ï¼Œè°ƒç”¨ä¹‹å‰è·å–åˆ°çš„ <code>init()</code> æ–¹æ³•å¹¶è·å–åˆ°è¿”å›å€¼ <code>%6</code>ï¼Œæœ€åæŠŠè¿”å›å€¼ï¼ˆ<code>%6</code>ï¼‰å­˜å‚¨åˆ°ä¹‹å‰å¼€è¾Ÿçš„å†…å­˜ç©ºé—´ï¼ˆ<code>%3</code>ï¼‰ä¸­</p><p> 11 ~ 14 ä»£è¡¨è°ƒç”¨ <code>ds.makeNoise()</code> çš„è¿‡ç¨‹ã€‚<code>%8</code> æ˜¯ <code>DogStruct.makeNose()</code> çš„å‡½æ•°å¼•ç”¨ï¼ˆ<a href="https://github.com/apple/swift/blob/master/docs/SIL.rst#function-ref" target="_blank" rel="noopener">function_ref</a>ï¼‰ï¼Œåœ¨è°ƒç”¨å‡½æ•°ä¹‹å‰ï¼Œåˆ›å»ºä¸€ä¸ªä¸´æ—¶å˜é‡ <code>%9</code> å¹¶æŒ‡å‘ <code>ds</code>ï¼Œè°ƒç”¨ <code>%8</code> <code>DogStruct.makeNoise()</code></p><p><code>let ds = DogStruct(); ds.makeNoise()</code> è¿™ä¸¤å¥æ“ä½œåˆ†åˆ«è°ƒç”¨äº†ä¸¤ä¸ªå‡½æ•°ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨è°ƒç”¨å‡½æ•°ä¹‹å‰ï¼Œéœ€è¦å…ˆæ‰¾åˆ°è¿™ä¸ªå‡½æ•°ã€‚é€šè¿‡ç”Ÿæˆçš„ SIL å¯çŸ¥ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°çš„éƒ½æ˜¯åœ¨ç¼–è¯‘æ—¶æœŸå°±è¢«ç¡®å®šçš„ (<code>function_ref</code>) ï¼Œè¿™ç§è°ƒç”¨æ–¹å¼æ˜¯ Static Dispatchï¼ˆé™æ€è°ƒç”¨ï¼‰</p><p>åœ¨ Swift ä¸­ï¼Œé™¤äº† Static Dispatchï¼Œè¿˜æœ‰ Dynamic Dispatchï¼ˆåŠ¨æ€è°ƒç”¨ï¼Œè¢«è°ƒç”¨çš„å‡½æ•°åœ¨ runtime æ‰èƒ½è¢«ç¡®è®¤ï¼‰ï¼Œè€Œ Dynamic Dispatch å®ç°åœ¨æ–¹å¼åˆæœ‰ V-Table Dispatchã€Witness Table Dispatch å’Œ objc_msgSendã€‚è™½ç„¶æ–¹æ³•çš„è°ƒç”¨æ–¹å¼æœ‰å¾ˆå¤šï¼Œä½†ææ¸…æ¥šæ–¹æ³•è°ƒç”¨çš„æ–¹å¼å´æ²¡é‚£ä¹ˆå¤æ‚</p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216224756.png" alt></p><h2 id="æ–¹æ³•çš„æ´¾å‘æ–¹å¼"><a href="#æ–¹æ³•çš„æ´¾å‘æ–¹å¼" class="headerlink" title="æ–¹æ³•çš„æ´¾å‘æ–¹å¼"></a>æ–¹æ³•çš„æ´¾å‘æ–¹å¼</h2><h3 id="é-Protocol-å¯¹è±¡è°ƒç”¨çš„æƒ…å†µ"><a href="#é-Protocol-å¯¹è±¡è°ƒç”¨çš„æƒ…å†µ" class="headerlink" title="é Protocol å¯¹è±¡è°ƒç”¨çš„æƒ…å†µ"></a>é Protocol å¯¹è±¡è°ƒç”¨çš„æƒ…å†µ</h3><p>é€šè¿‡è§‚å¯Ÿç¼–è¯‘ Swift ç”Ÿæˆçš„ SIL ä»£ç ï¼Œæ€»ç»“äº†å®šä¹‰åœ¨ structã€class å’Œ NSObject Subclass çš„å¸¸è§æ–¹æ³•çš„è°ƒç”¨æ–¹å¼ï¼ˆåœ¨æ²¡æœ‰ç¼–è¯‘å™¨ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼‰ï¼Œ</p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216224837.png" alt></p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ç°è±¡ç®€å•æ¨ä¸€ä¸‹åŸå› ï¼Œä¸ºä»€ä¹ˆæ–¹æ³•ä¼šä»¥ä¸åŒçš„æ–¹å¼è¢«è°ƒç”¨ï¼Ÿ</p><h4 id="Struct"><a href="#Struct" class="headerlink" title="Struct"></a>Struct</h4><p>å› ä¸º stuct ä¸æ”¯æŒç»§æ‰¿ï¼Œæ‰€ä»¥å®ƒä¸éœ€è¦ä¸€ä¸ª table æ¥è®°å½•æ–¹æ³•ä¿¡æ¯ã€‚æ‰€ä»¥åœ¨æ–¹æ³•è°ƒç”¨è€…æ˜¯ä¸€ä¸ª struct çš„å‰æä¸‹ï¼Œå®ƒæ‰€æœ‰çš„æ–¹æ³•è°ƒç”¨ï¼ˆåŒ…æ‹¬åè®®æ–¹æ³•ï¼‰ï¼Œéƒ½æ˜¯é™æ€è°ƒç”¨ã€‚</p><p>è™½ç„¶ä¸æ”¯æŒç»§æ‰¿ï¼Œä½† struct èƒ½é€šè¿‡ Protocol å®ç°å¤šæ€</p><h4 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h4><p>å¯¹äºä¸€ä¸ª pure Swift class æ¥è¯´ï¼Œå½±å“å®ƒæ–¹æ³•è°ƒç”¨çš„å…³é”®å­—åªæœ‰ <code>final</code></p><p>å‡½æ•°å¦‚æœè¢«æ ‡è®°æˆ <code>final</code> ï¼Œç¼–è¯‘å™¨å°±ä¼šçŸ¥é“è¿™ä¸ªæ–¹æ³•ä¸ä¼šè¢« <code>override</code>ï¼Œå¹¶æŠŠå®ƒçš„è°ƒç”¨æ–¹å¼æ ‡è®°æˆé™æ€è°ƒç”¨ã€‚è€Œå¯¹äºæœªæ ‡è®°æˆ <code>final</code> å¹¶åœ¨ class å†…éƒ¨ï¼ˆé extensionï¼‰ä¸­å®šä¹‰çš„æ–¹æ³•ï¼ŒSwift ä¼šç”¨ä¸€ç§å«ä½œ Virtual Table çš„æœºåˆ¶æ¥æŸ¥æ‰¾è¿™ä¸ªæ–¹æ³•å¹¶è°ƒç”¨</p><p>å› ä¸ºå®šä¹‰åœ¨ extension ä¸­çš„æ–¹æ³•ç›®å‰è¿˜ä¸æ”¯æŒ <code>override</code>ï¼Œæ‰€ä»¥å®šä¹‰åœ¨å…¶ä¸­çš„æ–¹æ³•éƒ½æ˜¯é™æ€æ´¾å‘çš„ã€‚</p><h4 id="NSObject-Subclass"><a href="#NSObject-Subclass" class="headerlink" title="NSObject Subclass"></a>NSObject Subclass</h4><p>å½±å“è¿™ç§ç±»å‹çš„å‡½æ•°è°ƒç”¨æ–¹å¼çš„å…³é”®å­—æœ‰å¾ˆå¤š</p><p>æ ‡è®°ä¸º <code>final</code> çš„å‡½æ•°æ˜¯ä¸€å®šä¼šé™æ€è°ƒç”¨çš„ï¼ŒåŸå› åŒ classã€‚</p><p>ä¸»ç±»ï¼ˆé extensionï¼‰ä¸­å®šä¹‰çš„æ™®é€šæ–¹æ³•å’Œæ ‡è®°ä¸º <code>@objc</code> çš„æ–¹æ³•éƒ½ä½¿ç”¨ V-Table æœºåˆ¶æ´¾å‘ã€‚ç”¨ Swift ç¼–å†™çš„ç±»æ˜¯ä¸èƒ½è¢« Objective-C ç»§æ‰¿çš„ï¼Œ<code>@objc</code> åªæ˜¯æŠŠæ–¹æ³•æš´éœ²ç»™ Objective-Cï¼Œå¹¶æ²¡æœ‰æ”¹å˜æ–¹æ³•æ´¾å‘çš„æœ¬è´¨</p><p><code>dynamic</code> çš„æ–¹æ³•ä¸ç®¡åœ¨ä¸»ç±»è¿˜æ˜¯ extension ä¸­éƒ½æ˜¯é€šè¿‡å‘æ¶ˆæ¯åŠ¨æ€è°ƒç”¨çš„ï¼Œå› ä¸º <code>dynamic</code> å°±æ˜¯å¹²è¿™ä¸ªäº‹å„¿çš„ã€‚</p><p>Extension ä¸­çš„æ–¹æ³•æ˜¯æ— æ³•åŸºäº V-Table æ´¾å‘çš„ï¼Œè¢«æ ‡è®°ä¸º <code>@objc</code> å’Œ <code>dynamic</code> çš„åˆæ— æ³•ä½¿ç”¨é™æ€æ´¾å‘ï¼Œæ‰€ä»¥åªèƒ½åŸºäº message æ´¾å‘ã€‚</p><p>ä»¥ä¸Šä»‹ç»çš„éƒ½æ˜¯åœ¨<strong>æ²¡æœ‰ç¼–è¯‘å™¨ä¼˜åŒ–</strong>çš„æƒ…å†µä¸‹æ–¹æ³•çš„æ´¾å‘æ–¹å¼ã€‚åœ¨æœ‰ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä¼šå°½å¯èƒ½åœ°æŠŠåŸºäº Table æœºåˆ¶æ´¾å‘çš„æ–¹æ³•å˜æˆé™æ€æ´¾å‘ï¼Œæœ‰çš„æ–¹æ³•ç”šè‡³ä¼šå°±åœ°å±•å¼€ï¼Œå˜æˆ inline çš„å½¢å¼ï¼Œä¸€åˆ‡ä¸ºäº†æ•ˆç‡å˜›</p><h3 id="Protocol-å¯¹è±¡è°ƒç”¨çš„æƒ…å†µ"><a href="#Protocol-å¯¹è±¡è°ƒç”¨çš„æƒ…å†µ" class="headerlink" title="Protocol å¯¹è±¡è°ƒç”¨çš„æƒ…å†µ"></a>Protocol å¯¹è±¡è°ƒç”¨çš„æƒ…å†µ</h3><p>ç”¨ Structã€Class å’Œ NSObject Subclass åˆ†åˆ«å®ç°äº†åŒä¸€ä¸ªåè®®ï¼Œç”¨æœ¬èº«çš„å¯¹è±¡å’Œåè®®å¯¹è±¡è°ƒç”¨åè®®ä¸­çš„æ–¹æ³•ã€‚é€šè¿‡è§‚å¯Ÿç¼–è¯‘åçš„ SILï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼Œ</p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216224849.png" alt></p><p>ç”¨ç±»æœ¬èº«çš„å¯¹è±¡è°ƒç”¨åè®®æ–¹æ³•çš„æ—¶å€™ï¼Œåƒæˆ‘ä»¬ä¸Šé¢å‘ç°çš„ä¸€æ ·ï¼Œè¯¥æ€ä¹ˆæ´¾å‘è¿˜æ˜¯æ€ä¹ˆæ´¾å‘ï¼Œè·Ÿæ­£å¸¸çš„æ–¹æ³•è°ƒç”¨æ²¡æœ‰åŒºåˆ«ï¼›ä½†æ˜¯å½“ç”¨åè®®å¯¹è±¡è°ƒç”¨åè®®æ–¹æ³•çš„æ—¶ï¼Œä¸ç®¡æ˜¯ç»“æ„ä½“è¿˜æ˜¯ç±»ï¼Œæ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯ä½¿ç”¨ä¸€ç§åŸºäº Witness Table çš„å½¢å¼æ´¾å‘</p><p>å®šä¹‰ä¸º <code>@objc</code> çš„åè®®æ–¹æ³•ä¼šåŸºäº message æ´¾å‘çš„</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¸Œæœ›å¤§å®¶èƒ½é€šè¿‡æ­¤æ–‡äº†è§£ä½¿ç”¨ SIL åˆ†æ Swift çš„å®ç°çš„æ–¹æ³•ï¼Œå¹¶åœ¨çœ‹åˆ°ä¸€ä¸ª Swift æ–¹æ³•å°±èƒ½æƒ³åˆ°ï¼Œå®ƒç©¶ç«Ÿæ˜¯åŸºäºä»€ä¹ˆæ–¹å¼è¿›è¡Œæ´¾å‘</p><p>ä¸‹ä¸€ç¯‡æ–‡ç« å¤§æ¦‚ä¼šä»‹ç»ä¸€ä¸‹ V-Table å’Œ Witness Table éƒ½æ˜¯äº›ä»€ä¹ˆä¸œè¥¿ï¼ˆä¸å¤ªç›‘çš„æƒ…å†µä¸‹</p><p>å¦‚æœæœ‰ä»€ä¹ˆå†™é”™çš„åœ°æ–¹æ¬¢è¿æŒ‡å‡º~</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://developer.apple.com/videos/play/wwdc2016/416/" target="_blank" rel="noopener">Understanding Swift Performance - Apple WWDC 2016</a></li><li><a href="https://developer.apple.com/videos/play/wwdc2015/409/" target="_blank" rel="noopener">Optimizing Swift Performance - Apple WWDC 2015</a></li><li><a href="https://www.raizlabs.com/dev/2016/12/swift-method-dispatch/" target="_blank" rel="noopener">Method Dispatch in Swift - Raizlabs</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Objective-C æ–¹æ³•è°ƒç”¨çš„æ–¹å¼æ˜¯å‘æ¶ˆæ¯ï¼Œé‚£ Swift æ–¹æ³•è°ƒç”¨çš„æ–¹å¼æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿææ¸…æ¥š Swift ä¸­æ–¹æ³•è°ƒç”¨çš„æ–¹å¼ï¼Œä¼šå¯¹äºæˆ‘ä»¬ç†è§£ Swift æœ‰æ›´å¥½çš„å¸®åŠ©&lt;/p&gt;
&lt;p&gt;Swift 4 &amp;amp; Xcode 9.2&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…ˆçœ‹ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œ&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// DogStruct.swift&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;DogStruct&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;makeNoise&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;bark in struct!&quot;&lt;/span&gt;) &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; ds = &lt;span class=&quot;type&quot;&gt;DogStruct&lt;/span&gt;()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ds.makeNoise()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="https://x140yu.github.io/tags/iOS/"/>
    
      <category term="Swift" scheme="https://x140yu.github.io/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>ç»™ iOS ç»„ä»¶é›†æˆ GitLab CI</title>
    <link href="https://x140yu.github.io/2018-03-12-ios-gitlab-ci/"/>
    <id>https://x140yu.github.io/2018-03-12-ios-gitlab-ci/</id>
    <published>2018-03-12T06:57:00.000Z</published>
    <updated>2019-08-19T07:43:25.673Z</updated>
    
    <content type="html"><![CDATA[<p>ç›¸ä¿¡æ¯ä¸ªäººéƒ½æœ‰è¿™æ ·ä¸€ä¸ªæ„¿æ™¯ï¼Œå°±æ˜¯å¸Œæœ›è‡ªå·±ç»´æŠ¤çš„æ¯ä¸€ä¸ªç»„ä»¶éƒ½èƒ½è·ŸçŸ¥åçš„å¼€æºé¡¹ç›®ä¸€æ ·ä¼˜ç§€ï¼Œæœ‰é«˜çš„ä»£ç è´¨é‡ï¼Œå®Œæ•´çš„æµ‹è¯•å’Œæ–‡æ¡£ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸€ç›®çš„ï¼Œå°±éœ€è¦æœ‰ CI ä½œä¸ºé¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªç¯èŠ‚ä»‹å…¥ã€‚åœ¨æ¯æ¬¡ push æˆ–è€…æäº¤ Merge Request çš„æ—¶å€™ï¼ŒCI å¯ä»¥ä»£æ›¿äººæ¥åšä¸€äº›äº‹æƒ…ï¼Œç¼–è¯‘é¡¹ç›®ï¼Œè·‘è·‘æµ‹è¯•ï¼Œåšä¸€äº›é™æ€æ£€æµ‹ï¼Œå¸®åŠ©æäº¤è€…å’Œ reviewer åŠæ—¶å‘ç°ä¸€äº›ç®€å•çš„é—®é¢˜ï¼Œæé«˜å·¥ä½œæ•ˆç‡ã€‚CI çš„</p><a id="more"></a><h2 id="CI-éƒ½èƒ½åšäº›ä»€ä¹ˆï¼Ÿ"><a href="#CI-éƒ½èƒ½åšäº›ä»€ä¹ˆï¼Ÿ" class="headerlink" title="CI éƒ½èƒ½åšäº›ä»€ä¹ˆï¼Ÿ"></a>CI éƒ½èƒ½åšäº›ä»€ä¹ˆï¼Ÿ</h2><p>å¯¹äº iOS ç»„ä»¶æ¥è¯´ï¼Œä»¥ä¸‹å‡ ä»¶äº‹åœ¨ CI é˜¶æ®µåšæ˜¯æ¯”è¾ƒæœ‰å¸®åŠ©çš„ï¼Œ</p><ul><li>build é¡¹ç›®å¹¶è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼Œç»™å‡º Code Coverage</li><li>ä½¿ç”¨ lint å·¥å…·å¯¹ä»£ç è¿›è¡Œé™æ€åˆ†æ</li><li>ä½¿ç”¨ <a href="http://danger.systems/ruby/" target="_blank" rel="noopener">danger</a> æ‰¾å‡º MR ä»¥åŠ MR æ”¹åŠ¨ä¸­å¯èƒ½å­˜åœ¨çš„é—®é¢˜</li></ul><p>ä»¥ä¸Šçš„å‡ æ­¥éƒ½ä¼šé€šè¿‡ danger åœ¨ MR ä¸‹é¢ç»™å‡ºè¯„è®ºï¼Œæ•ˆæœå¦‚å›¾ï¼Œ</p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216225508.png" alt></p><h2 id="GitLab-runner"><a href="#GitLab-runner" class="headerlink" title="GitLab runner"></a>GitLab runner</h2><p>é€‰æ‹© GitLab runner ä½œä¸º CI å¹³å°æ˜¯å¾ˆè‡ªç„¶äº‹æƒ…ï¼Œå®ƒ UI å¥½çœ‹ï¼ˆæ˜¯çš„ Jenkins å¤ªå¤å¤äº†ï¼‰ï¼Œé›†æˆç®€å•ï¼Œè€Œä¸”è¿˜å¯ä»¥ä½œä¸º MR çš„åˆå¹¶æµç¨‹çš„å…¶ä¸­ä¸€ç¯ï¼Œæ¯”å¦‚ pipeline æ²¡è¿‡ï¼Œå°±æ— æ³•åˆå¹¶ï¼Œ</p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216225535.png" alt></p><h3 id="gitlab-ci-yml"><a href="#gitlab-ci-yml" class="headerlink" title=".gitlab-ci.yml"></a><code>.gitlab-ci.yml</code></h3><p>æƒ³è¦ runner æ‰§è¡Œä¸Šè¾¹æåˆ°çš„å‡ ä¸ªæ­¥éª¤ï¼Œéœ€è¦åœ¨ä»“åº“çš„æ ¹ç›®å½•æ·»åŠ  <code>.gitlab-ci.yml</code> ï¼Œè¿™ä¸ªæ–‡ä»¶å‘Šè¯‰äº† runnerï¼Œæ¯æ¬¡ push æˆ–è€… MR çš„æäº¤åï¼Œå®ƒåº”è¯¥åšä»€ä¹ˆäº‹æƒ…ã€‚å…³äºè¿™ä¸ªæ–‡ä»¶æ€ä¹ˆå†™ï¼Œ<a href="https://docs.gitlab.com/ce/ci/yaml/" target="_blank" rel="noopener">å®˜ç½‘</a>å†™å¾—æ¯”è¾ƒæ¸…æ¥šï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ï¼Œå°±è°ˆè°ˆæˆ‘è§‰å¾—éœ€è¦æ³¨æ„çš„ä¸€äº›é—®é¢˜å§ï¼Œ</p><ul><li>ä¸€ä¸ª stage è¿‡åäº§å‡ºçš„æ–‡ä»¶æ˜¯ä¸èƒ½è¢«ä¸‹ä¸€ä¸ª stage è·å–åˆ°çš„ï¼Œå¦‚æœæƒ³è¿™æ ·ï¼Œéœ€è¦åœ¨ stage ä¸­æ·»åŠ  <code>artifacts</code> å­—æ®µï¼ŒæŒ‡å®šæ–‡ä»¶çš„è·¯å¾„</li></ul><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">xxx_stage:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">xxx</span></span><br><span class="line"><span class="attr">  artifacts:</span></span><br><span class="line"><span class="attr">    paths:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">xxx.abc</span></span><br></pre></td></tr></table></figure><ul><li>å¯¹äºå¤šä¸ªä»“åº“æƒ³è¦ä½¿ç”¨åŒä¸€ä¸ª runner çš„æƒ…å†µï¼Œéœ€è¦åœ¨æ¯ä¸ª stage ä¸­æ·»åŠ  <code>tags</code> å­—æ®µï¼Œæ ‡ç¤º runner çš„åå­—ï¼Œè€Œä¸”éœ€è¦åœ¨ä»“åº“çš„é…ç½®é‡Œé¢è®¾ç½®ä¸€ä¸‹</li></ul><ul><li>å¦‚æœé‡åˆ°å­—ç¬¦é›†çš„é—®é¢˜ï¼Œå¯ä»¥åœ¨ <code>before_script</code> ä¸­æ·»åŠ ä¸‹é¢è¡Œ</li></ul><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">before_script:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">export</span> <span class="string">LANG=en_US.UTF-8</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">export</span> <span class="string">LANGUAGE=en_US:en</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">export</span> <span class="string">LC_ALL=en_US.UTF-8</span></span><br></pre></td></tr></table></figure><h3 id="lint-amp-Code-Coverage"><a href="#lint-amp-Code-Coverage" class="headerlink" title="lint &amp; Code Coverage"></a>lint &amp; Code Coverage</h3><p>å› ä¸ºé¡¹ç›®æ˜¯ Objective-C å’Œ Swift æ··ç¼–çš„ï¼Œæ‰€ä»¥ä¸¤ç§è¯­è¨€çš„ lint éƒ½è¦æœ‰ã€‚å› ä¸ºè¿˜å¤„äºæ­å»ºçš„åˆæœŸï¼Œè€Œä¸” lint çš„è§„åˆ™è¿˜å¤„äºå˜åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰æŠŠ lint çš„ç»“æœä½œä¸ºä¸€ç§å¾ˆå¼ºçš„çº¦æŸï¼ˆæ¯”å¦‚ lint ä¸è¿‡ï¼Œpipeline å°±ä¼š failï¼‰ï¼Œç›®å‰åªä¼šæŠŠå®ƒçš„ç»“æœä½œä¸ºä¸€ç§æç¤ºï¼Œè¯„è®ºåœ¨ MR çš„ä¸‹é¢ï¼Œåé¢åœ¨è¿™å¥—æµç¨‹èµ°å…¥æ­£è½¨ï¼Œåœ¨ lint å·¥å…·æ”¯æŒçš„æƒ…å†µä¸‹ï¼ˆswiftlintï¼‰ï¼Œä¼šè¡¥ä¸Šè¿™ä¸€åŠŸèƒ½</p><h4 id="OCLint"><a href="#OCLint" class="headerlink" title="OCLint"></a>OCLint</h4><p>Objective-C ç›¸å…³çš„ lint å·¥å…·æ‰¾äº†ä¸€åœˆï¼Œæ²¡æœ‰åˆç®€å•åˆç¾è§‚åˆæ˜“ç”¨çš„ï¼Œåªæœ‰ OCLint èƒ½å°†å°±ç”¨ä¸€ä¸‹ã€‚Lint ç»“æœéœ€è¦åœ¨ build å·¥ç¨‹ä¹‹åæ‰èƒ½ç»™å‡ºï¼Œæ‰€ä»¥ç¨å¾®éº»çƒ¦ä¸€äº›ï¼Œå‰æœŸé…ç½®èŠ±äº†ä¸€äº›æ—¶é—´ï¼Œ</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># .gitlab-ci.yml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build_project:</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">cd</span> <span class="string">Example</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">pod</span> <span class="string">install</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">xcodebuild</span> <span class="string">clean</span> <span class="bullet">-workspace</span> <span class="string">$&#123;POD_NAME&#125;.xcworkspace</span> <span class="bullet">-scheme</span> <span class="string">$&#123;POD_NAME&#125;-Example</span> <span class="string">| xcpretty</span></span><br><span class="line"><span class="string">    # æŒ‡å®š derived data ç›®å½•æ˜¯ä¸æƒ³è®©æ¯æ¬¡ç¼–è¯‘éƒ½è¢«ç¼“å­˜ï¼ŒOCLint å¯¹æ²¡æœ‰æ›´æ–°çš„ build ä¸ä¼šäº§ç”Ÿç»“æœ</span></span><br><span class="line"><span class="string">    - xcodebuild test -workspace $&#123;POD_NAME&#125;.xcworkspace -scheme $&#123;POD_NAME&#125;-Example -destination 'platform=iOS Simulator,name=iPhone X,OS=11.2' -derivedDataPath build_outputs | xcpretty -r json-compilation-database -o compile_commands.json</span></span><br><span class="line"><span class="string">    # åœ¨è¿œç«¯è„šæœ¬æ›´æ–°ä»¥åï¼Œä¸å¸Œæœ›æ¯ä¸€ä¸ªä»“åº“éƒ½ä½œå‡ºåŒæ ·çš„æ›´æ”¹ï¼Œæ‰€ä»¥æŠŠè¿™ä¸ªè„šæœ¬æ”¾åˆ°å¦å¤–ä¸€ä¸ªä»“åº“</span></span><br><span class="line"><span class="string">    - git archive --remote=xxx.git HEAD ci-lint.rb | tar xvf -</span></span><br><span class="line"><span class="string">    - ruby ci-lint.rb</span></span><br></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ci-lint.rb</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_oclint_comment</span></span></span><br><span class="line">  <span class="comment"># ä¸‹è½½ oclint çš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">  download_file(<span class="string">".oclint"</span>)</span><br><span class="line">  <span class="comment"># è®© oc-lint parse åˆšæ‰ build ç”Ÿæˆçš„ `compile_commands.json` æ–‡ä»¶</span></span><br><span class="line">  oclint_output = <span class="string">`oclint-json-compilation-database -v -e Pods`</span></span><br><span class="line">  puts <span class="string">"----- origin OCLint output -----"</span></span><br><span class="line">  puts oclint_output</span><br><span class="line">  <span class="comment"># å¯¹ oclint ç»“æœåšä¸€äº›å¤„ç†ï¼Œæ¯”å¦‚æ‰¾åˆ° `TotalFiles=0` å°±è®¤ä¸º lint success</span></span><br><span class="line">  oclint_comment = parse_oclint_output(oclint_output)</span><br><span class="line">  puts <span class="string">"----- parsed OCLint output -----"</span></span><br><span class="line">  puts oclint_comment</span><br><span class="line">  oclint_comment</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h4 id="swiftlint"><a href="#swiftlint" class="headerlink" title="swiftlint"></a>swiftlint</h4><p>æ¯” OCLint å¥½å¾ˆå¤šï¼Œç®€å•ç¾è§‚ä¸”æ˜“ç”¨ï¼Œç¤¾åŒºæ´»è·ƒï¼Œä¸éœ€è¦ç¼–è¯‘å·¥ç¨‹ï¼›å”¯ä¸€ä¸èƒ½å¤„ç†çš„å°±æ˜¯ä¸€äº›ç¼–è¯‘è¿‡åæ‰èƒ½å‘ç°çš„é—®é¢˜ï¼Œæ¯”å¦‚åµŒå¥—è¿‡æ·±ç­‰ç­‰ï¼ˆå…¶å®è¿™äº›æ£€æµ‹ç»“æœå¤šæ•°æƒ…å†µæ²¡åµç”¨ï¼‰ã€‚<code>.swiftlint</code> åŒæ ·æ”¾åœ¨å…¶å®ƒä»“åº“ï¼Œæ–¹ä¾¿è§„åˆ™å˜æ›´ï¼Œè®°å¾—æŠŠ reporter æ”¹æˆ <code>emoji</code> ï¼Œç»“æœä¼šæ›´å¥½çœ‹ã€‚</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ci-lint.rb</span></span><br><span class="line"><span class="comment"># è·å– swiftlint çš„ç»“æœ</span></span><br><span class="line"></span><br><span class="line"><span class="string">def</span> <span class="string">get_swiftlint_result</span></span><br><span class="line">  <span class="string">swiftlint_comment_content</span> <span class="string">=</span> <span class="string">`swiftlint`</span></span><br><span class="line">  <span class="string">puts</span> <span class="string">"----- origin swift lint content -----"</span></span><br><span class="line">  <span class="string">if</span> <span class="string">not</span> <span class="string">swiftlint_comment_content.include?</span> <span class="string">"Line"</span></span><br><span class="line">    <span class="comment"># ä¸åŒ…å« `Line`ï¼Œæˆ‘ä»¬è®¤ä¸º lint é€šè¿‡</span></span><br><span class="line">    <span class="string">swiftlint_comment_content</span> <span class="string">=</span> <span class="string">"\n## swiftlint report\nâœ… success\n"</span></span><br><span class="line">  <span class="string">else</span></span><br><span class="line">    <span class="comment"># å¦åˆ™ä¸é€šè¿‡</span></span><br><span class="line">    <span class="string">swiftlint_comment_content</span> <span class="string">=</span> <span class="string">"\n## swiftlint report\n```\n"</span> <span class="string">+</span> <span class="string">swiftlint_comment_content</span> <span class="string">+</span> <span class="string">"\n```"</span></span><br><span class="line">  <span class="string">end</span></span><br><span class="line">  <span class="string">swiftlint_comment_content</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"></span><br><span class="line"><span class="string">def</span> <span class="string">get_swiftlint_comment</span></span><br><span class="line">  <span class="comment"># éœ€è¦åœ¨æ ¹ç›®å½•æ‰§è¡Œ</span></span><br><span class="line">  <span class="string">Dir.chdir("../")</span></span><br><span class="line">  <span class="comment"># ä¸‹è½½ swiftlint é…ç½®æ–‡ä»¶</span></span><br><span class="line">  <span class="string">download_file(".swiftlint.yml")</span></span><br><span class="line">  <span class="string">swiftlint_comment</span> <span class="string">=</span> <span class="string">get_swiftlint_result</span></span><br><span class="line">  <span class="string">puts</span> <span class="string">"----- parsed swiftlint content -----"</span></span><br><span class="line">  <span class="string">puts</span> <span class="string">swiftlint_comment</span></span><br><span class="line">  <span class="string">swiftlint_comment</span></span><br><span class="line"><span class="string">end</span></span><br></pre></td></tr></table></figure><h4 id="Code-Coverage"><a href="#Code-Coverage" class="headerlink" title="Code Coverage"></a>Code Coverage</h4><p>ä½¿ç”¨çš„å·¥å…·æ˜¯ <a href="https://github.com/SlatherOrg/slather" target="_blank" rel="noopener">slather</a>ï¼Œé…åˆ GitLab åŸç”Ÿçš„ Code Coverage æ˜¾ç¤ºï¼Œç”¨æ­£åˆ™è¿‡æ»¤ä¸€ä¸‹ output å°±èƒ½è·å–ç»“æœï¼Œ</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># .slather.yml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ CI é˜¶æ®µï¼Œç”¨æ¥è·‘ Code Coverage ä½¿ç”¨çš„é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment"># $&#123;PROJECT_NAME&#125; éœ€è¦è¢«æ›¿æ¢æ‰</span></span><br><span class="line"></span><br><span class="line"><span class="attr">configuration:</span> <span class="string">Debug</span></span><br><span class="line"><span class="attr">input_format:</span> <span class="string">profdata</span></span><br><span class="line"><span class="attr">xcodeproj:</span> <span class="string">$&#123;PROJECT_NAME&#125;.xcodeproj</span></span><br><span class="line"><span class="attr">workspace:</span> <span class="string">$&#123;PROJECT_NAME&#125;.xcworkspace</span></span><br><span class="line"><span class="attr">scheme:</span> <span class="string">$&#123;PROJECT_NAME&#125;-Example</span></span><br><span class="line"><span class="comment"># è¿™ä¸ªç›®å½•æ˜¯ä¸Šé¢ derived data æŒ‡å®šçš„ç›®å½•</span></span><br><span class="line"><span class="attr">build_directory:</span> <span class="string">build_outputs</span></span><br><span class="line"><span class="attr">binary_basename:</span> <span class="string">$&#123;PROJECT_NAME&#125;</span></span><br><span class="line"><span class="attr">ignore:</span> </span><br><span class="line"><span class="bullet">  -</span> <span class="string">"Pods/*"</span></span><br></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ci-lint.rb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æ¯ä¸ªæ–‡ä»¶çš„ coverage æ¯”ä¾‹ç»“æœ</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_coverage_comment</span></span></span><br><span class="line">  slather_yml_file_name = <span class="string">".slather.yml"</span></span><br><span class="line">  <span class="comment"># ä¸‹è½½ slather çš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">  download_file(slather_yml_file_name)</span><br><span class="line">  <span class="comment"># æŠŠ `$&#123;PROJECT_NAME&#125;` æ›¿æ¢æˆ $CI_PROJECT_DIR</span></span><br><span class="line">  modify_slatheryml(slather_yml_file_name)</span><br><span class="line">  <span class="string">"\n## Code Coverage Report\n```\n"</span> + <span class="string">`slather coverage`</span> + <span class="string">"\n```"</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é…ç½® .gitlab-ci.ymlï¼Œå³å¯åœ¨ MR ä¸­æ˜¾ç¤º Code Coverage</span></span><br><span class="line"><span class="attr">build_project:</span></span><br><span class="line"><span class="attr">  coverage:</span> <span class="string">'/\d+(?:\.\d*)?\%$/'</span></span><br></pre></td></tr></table></figure><h3 id="danger"><a href="#danger" class="headerlink" title="danger"></a><a href="https://github.com/danger/danger" target="_blank" rel="noopener">danger</a></h3><p>danger èƒ½å¤Ÿè·å–ä¿¡æ¯éƒ½æ˜¯ä¸ MR æœ‰å…³çš„ï¼Œæ¯”å¦‚ä¿®æ”¹äº†å“ªäº›æ–‡ä»¶ï¼Œæ”¹åŠ¨æœ‰å¤šå°‘è¡Œï¼Œæœ‰æ²¡æœ‰å¡«å†™æè¿°ç­‰ç­‰ï¼Œå…·ä½“çš„å†…å®¹å¯ä»¥çœ‹å®ƒçš„æ–‡æ¡£ã€‚åœ¨ GitLab ä¸Šé›†æˆ danger æœ‰äº›é—®é¢˜ï¼Œå¦‚æœæ˜¯æ˜¯ fork ä»“åº“å‘ä¸»åº“æäº¤ MRï¼Œdanger å°±ä¼šè·å–ä¸åˆ°æ­£ç¡®çš„ <code>project_id</code> å’Œ <code>mr_iid</code>ï¼Œå®ƒå°±ä¸èƒ½æ‰¾åˆ°å¯¹åº”çš„ MR è¿›è¡Œè¯„è®ºï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬å¸®å®ƒæ‰¾åˆ°å¯¹åº”çš„å€¼å¹¶å‘ŠçŸ¥ï¼Œ</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># .gitlab-ci.yml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">danger:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">danger</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">git</span> <span class="string">archive</span> <span class="bullet">--remote=xxx.git</span> <span class="string">HEAD</span> <span class="string">ci-danger.sh</span> <span class="string">| tar xvf -</span></span><br><span class="line"><span class="string">    - sh ci-danger.sh</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ci-danger.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½ Dangerfile</span></span><br><span class="line">git archive --remote=xxxx.git HEAD Dangerfile | tar xvf -</span><br><span class="line"><span class="comment"># ä¸‹è½½è·å– mr_iid çš„è„šæœ¬</span></span><br><span class="line">git archive --remote=xxx.git HEAD ci-mr_iid.rb | tar xvf -</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å– project_id å’Œ mr_iid</span></span><br><span class="line">output=$(ruby <span class="string">"ci-mr_iid.rb"</span>)</span><br><span class="line">project_id=$(cut -d<span class="string">','</span> -f1 &lt;&lt;&lt; <span class="variable">$output</span>)</span><br><span class="line">mr_iid=$(cut -d<span class="string">','</span> -f2 &lt;&lt;&lt; <span class="variable">$output</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œ danger å‘½ä»¤ï¼ŒæŠŠè·å–åˆ°çš„å­—æ®µä½œä¸º ENV ä¼ ç»™ danger</span></span><br><span class="line">DANGER_GITLAB_HOST=git.xxx.com \</span><br><span class="line">  DANGER_GITLAB_API_BASE_URL=https://git.xxx.com/api/v4 \</span><br><span class="line">  DANGER_GITLAB_API_TOKEN=xxx \</span><br><span class="line">  CI_PROJECT_ID=<span class="variable">$project_id</span> \</span><br><span class="line">  CI_MERGE_REQUEST_ID=<span class="variable">$mr_iid</span> \</span><br><span class="line">  danger</span><br></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ci-mr_iid.rb</span></span><br><span class="line"><span class="comment"># ä½œç”¨æ˜¯æ‰¾åˆ°å½“å‰ä»“åº“çš„ project_id å’Œ mr_iid</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">'gitlab'</span></span><br><span class="line"></span><br><span class="line">project_name = ENV[<span class="string">'CI_PROJECT_NAME'</span>]</span><br><span class="line"><span class="comment"># GitLab private token</span></span><br><span class="line">private_token = <span class="string">"xxx"</span></span><br><span class="line"><span class="comment"># æ‰€æœ‰ä»“åº“æ‰€åœ¨çš„ group idï¼Œéœ€è¦ç”¨ API è·å–ä¸€ä¸‹</span></span><br><span class="line">platform_groud_id = <span class="string">"123"</span></span><br><span class="line">commit_sha = ENV[<span class="string">'CI_COMMIT_SHA'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨è¿™ä¸ª group ä¸­å¯»æ‰¾åå­—ä¸€æ ·çš„ projectï¼Œè·å–å®ƒçš„ project_id</span></span><br><span class="line">g = Gitlab.client(<span class="symbol">endpoint:</span> <span class="string">'https://git.xxx.com/api/v4'</span>, <span class="symbol">private_token:</span> private_token)</span><br><span class="line">platform_group = g.group(platform_groud_id)</span><br><span class="line"></span><br><span class="line">project_id = platform_group.projects.find&#123; <span class="params">|p|</span> p[<span class="string">"name"</span>] == project_name &#125;[<span class="string">"id"</span>].to_s</span><br><span class="line"><span class="comment"># è¿™ä¸€æ¬¡ commit çš„ SHAï¼Œç”¨æ¥è·å– mr_iid</span></span><br><span class="line"><span class="comment"># è·å– mr_iid</span></span><br><span class="line">mr_cmd = <span class="string">"curl -s \"https://git.xxx.com/api/v4/projects/<span class="subst">#&#123;project_id&#125;</span>/merge_requests?private_token=<span class="subst">#&#123;private_token&#125;</span>&amp;state=opened\" | jq -r \".[]|select(.sha == \\\"<span class="subst">#&#123;commit_sha&#125;</span>\\\")|.iid\""</span></span><br><span class="line">mr_iid = <span class="string">`<span class="subst">#&#123;mr_cmd&#125;</span>`</span></span><br><span class="line"></span><br><span class="line">ENV[<span class="string">'CI_PROJECT_ID'</span>] = project_id</span><br><span class="line">ENV[<span class="string">'CI_MERGE_REQUEST_ID'</span>] = mr_iid</span><br><span class="line"></span><br><span class="line">puts project_id + <span class="string">","</span> + mr_iid</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šçš„å„ä¸ªæ­¥éª¤ï¼Œé™¤äº† <code>.gitlab-ci.yml</code> ä»¥å¤–çš„è„šæœ¬åŠé…ç½®æ–‡ä»¶ï¼Œéƒ½æ˜¯ä»å…¶å®ƒä»“åº“ä¸‹è½½ä¸‹æ¥çš„ï¼Œè¿™æ ·åšçš„å¥½å¤„æœ‰å¾ˆå¤šï¼Œè®©é…ç½®çš„è§„åˆ™æœ‰åŠ¨æ€æ›´æ–°çš„èƒ½åŠ›ï¼Œè®©æ¯ä¸ªä»“åº“ä¿æŒå¹²å‡€ï¼Œæ²¡æœ‰ä»£ç æ²¡æœ‰å¤šä½™çš„æ— å…³æ–‡ä»¶å¯ä»¥éšè—ç»†èŠ‚ï¼ˆè¿™ä¹Ÿç®—æ˜¯ä¸€ç§ç¨‹åº¦çš„å°è£…å§ğŸ˜†ï¼‰ç­‰ç­‰ã€‚å¦‚æœæœ‰æ›´å¥½çš„æ–¹å¼ï¼Œä»¥åŠä¸Šé¢çš„ä»£ç æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œæ¬¢è¿æå‡ºæ„è§</p><h2 id="pod-template"><a href="#pod-template" class="headerlink" title="pod template"></a><code>pod template</code></h2><p>å¦‚æœè¦è®©æ¯ä¸€ä¸ªç‹¬ç«‹ç»„ä»¶éƒ½é€‚åº”ç±»ä¼¼çš„ <code>.gitlab-ci.yml</code> ï¼Œå°±éœ€è¦åšä¸€ç•ªå¤§æ”¹åŠ¨äº†ã€‚æ¯ä¸ªç»„ä»¶éƒ½æœ‰è‡ªå·±çš„ git ä»“åº“ï¼Œä¸ç®¡å¯¹äºå·²ç»å­˜åœ¨çš„ç»„ä»¶ï¼Œè¿˜æ˜¯æœªæ¥å°†è¦å‡ºç°çš„ç»„ä»¶ï¼Œéƒ½éœ€è¦æä¾›ä¸€å¥—å¿«é€Ÿåˆ›å»ºå‡ºä¸€ä¸ªå¯ä»¥ç›´æ¥æ”¯æŒå½“å‰ CI workflow çš„å·¥ç¨‹æ¨¡ç‰ˆã€‚</p><p>å¯èƒ½å¾ˆå¤šäººéƒ½ä¸çŸ¥é“ï¼ŒCocoaPods è‡ªå¸¦ä¸€æ¡å‘½ä»¤ï¼Œ<code>pod lib create</code>ï¼Œå®ƒå¯ä»¥é€šè¿‡ä¸€ä¸ªæ¨¡æ¿çš„ git é“¾æ¥åˆ›å»ºä¸€ä¸ªç»„ä»¶ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>--template-url</code> æ¥æŒ‡å‘è‡ªå·±éœ€è¦çš„æ¨¡æ¿ï¼Œä»è€Œè¾¾åˆ°å¿«é€Ÿåˆ›å»ºå·¥ç¨‹çš„ç›®çš„ã€‚</p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216225553.png" alt></p><h3 id="pod-template-æ–‡ä»¶ç»„ç»‡"><a href="#pod-template-æ–‡ä»¶ç»„ç»‡" class="headerlink" title="pod template æ–‡ä»¶ç»„ç»‡"></a>pod template æ–‡ä»¶ç»„ç»‡</h3><p>å‡å¦‚æœ‰è¿™æ ·ä¸€ä¸ª pod å« BestFrameworkï¼Œæˆ‘æ˜¯è¿™æ ·ç»„ç»‡å®ƒçš„ç»“æ„çš„ï¼Œ</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">~/D/BestFramework tree . -L 2 -a</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ .gitignore</span><br><span class="line">â”œâ”€â”€ .gitlab-ci.yml</span><br><span class="line">â”œâ”€â”€ BestFramework</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ Classes</span><br><span class="line">â”‚Â Â  â””â”€â”€ Resources</span><br><span class="line">â”œâ”€â”€ BestFramework.podspec</span><br><span class="line">â”œâ”€â”€ Example</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ BestFramework</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ BestFramework.xcodeproj</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ BestFramework.xcworkspace</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ Podfile</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ Podfile.lock</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ Pods</span><br><span class="line">â”‚Â Â  â””â”€â”€ Tests</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â””â”€â”€ _Pods.xcodeproj -&gt; Example/Pods/Pods.xcodeproj</span><br></pre></td></tr></table></figure><p>æŠŠ BestFramework å½“ä½œä¸€ä¸ª Development Pods ä½œä¸º Example çš„ä¾èµ–ï¼Œæµ‹è¯•æ”¾åˆ° <code>Example/Tests</code> ä¸­ï¼Œ<code>gitlab-ci.yml</code> ä¸­çš„å†…å®¹æ˜¯æ ¹æ®åˆ›å»ºæ—¶å€™ç»™å‡ºçš„åå­—åŠ¨æ€åˆ›å»ºçš„ã€‚å…¶å®æ–‡ä»¶å¤¹ç»“æ„è¿™ç§ä¸œè¥¿æ€ä¹ˆç»„ç»‡éƒ½å¯ä»¥ï¼Œåªè¦å¤–é¢èƒ½æ­£ç¡®å¼•ç”¨å°±å¯ä»¥äº†</p><p>æœ€åä»¥è¿™æ ·ä¸€å¹…å›¾ä½œä¸ºæ€»ç»“ï¼Œ</p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216225623.png" alt></p><p>æ‰€ä»¥æˆ‘ä»¬ä¸»è¦è¦†ç›–çš„æ˜¯åˆ›å»ºé¡¹ç›®ä»¥åŠæäº¤ MR ä¸¤ä¸ªé˜¶æ®µï¼Œæä¾›ä¸€äº›æ•ˆç‡å·¥å…·åŠä½¿ç”¨ CI å¸®åŠ©æˆ‘ä»¬æ›´å¥½æ›´å¿«åœ°ä¹¦å†™/reviewä»£ç </p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç›¸ä¿¡æ¯ä¸ªäººéƒ½æœ‰è¿™æ ·ä¸€ä¸ªæ„¿æ™¯ï¼Œå°±æ˜¯å¸Œæœ›è‡ªå·±ç»´æŠ¤çš„æ¯ä¸€ä¸ªç»„ä»¶éƒ½èƒ½è·ŸçŸ¥åçš„å¼€æºé¡¹ç›®ä¸€æ ·ä¼˜ç§€ï¼Œæœ‰é«˜çš„ä»£ç è´¨é‡ï¼Œå®Œæ•´çš„æµ‹è¯•å’Œæ–‡æ¡£ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸€ç›®çš„ï¼Œå°±éœ€è¦æœ‰ CI ä½œä¸ºé¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªç¯èŠ‚ä»‹å…¥ã€‚åœ¨æ¯æ¬¡ push æˆ–è€…æäº¤ Merge Request çš„æ—¶å€™ï¼ŒCI å¯ä»¥ä»£æ›¿äººæ¥åšä¸€äº›äº‹æƒ…ï¼Œç¼–è¯‘é¡¹ç›®ï¼Œè·‘è·‘æµ‹è¯•ï¼Œåšä¸€äº›é™æ€æ£€æµ‹ï¼Œå¸®åŠ©æäº¤è€…å’Œ reviewer åŠæ—¶å‘ç°ä¸€äº›ç®€å•çš„é—®é¢˜ï¼Œæé«˜å·¥ä½œæ•ˆç‡ã€‚CI çš„&lt;/p&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="https://x140yu.github.io/tags/iOS/"/>
    
      <category term="CI" scheme="https://x140yu.github.io/tags/CI/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Homebrew Formula æ­å»ºå‘½ä»¤è¡Œå·¥å…·</title>
    <link href="https://x140yu.github.io/2018-01-24-homebrew-formula/"/>
    <id>https://x140yu.github.io/2018-01-24-homebrew-formula/</id>
    <published>2018-01-24T10:00:00.000Z</published>
    <updated>2019-08-19T07:43:25.673Z</updated>
    
    <content type="html"><![CDATA[<p>å½“å›¢é˜Ÿå·¥ç¨‹ä¸­çš„è„šæœ¬è¿‡å¤šäº†ä»¥åï¼Œå°±åº”è¯¥è€ƒè™‘æŠŠå®ƒä»¬ç»„ç»‡èµ·æ¥ï¼Œåšæˆ CLI äº†ã€‚æ¯”èµ·ä¸€ä¸ªä¸ªç‹¬ç«‹çš„è„šæœ¬ï¼ŒCLI æ›´å®¹æ˜“å‡çº§å’Œç»´æŠ¤ï¼Œä¹Ÿæ›´æ–¹ä¾¿å…±äº«ä»£ç ã€‚</p><p>æˆ‘çš„åˆè¡·å°±æ˜¯æŠŠæ‰€æœ‰çš„è„šæœ¬æ”¾åˆ°ä¸€ä¸ª gitlab çš„ repo ä¸­ï¼Œæ‰€æœ‰æƒ³ä½¿ç”¨è¿™ä¸ªå·¥å…·çš„äººé€šè¿‡å¾ˆç®€å•çš„æ–¹å¼å°±èƒ½å®‰è£…ã€æ›´æ–°å¹¶ä½¿ç”¨å®ƒã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•æŠŠè¿™äº›è„šæœ¬ï¼Œå˜æˆåœ¨å›¢é˜Ÿå†…éƒ¨ï¼Œäººäººéƒ½å¯ä»¥å®‰è£…/å‡çº§çš„ CLI å‘¢ï¼Ÿ</p><p>æˆ‘çš„é€‰æ‹©æ˜¯ Homebrew Formulaã€‚</p><a id="more"></a><h2 id="Homebrew-Formula"><a href="#Homebrew-Formula" class="headerlink" title="Homebrew Formula"></a>Homebrew Formula</h2><p>å› ä¸ºå›¢é˜Ÿå†…éƒ¨ç¼–å†™äº†å¾ˆå¤š ruby è„šæœ¬ï¼Œæ‰€ä»¥é€‰æ‹© Homebrew æ˜¯ä¸€ä»¶å¾ˆ nature çš„äº‹æƒ…ã€‚</p><p>æœ¬æ¥æˆ‘æƒ³æŠŠå®ƒåšæˆä¸€ä¸ª gem å‘å¸ƒå‡ºå»ï¼Œä½†æ˜¯ç”±äº private çš„ gem éœ€è¦æœ‰è‡ªå·±çš„æºï¼ŒæŠ˜è…¾èµ·æ¥å¤ªéº»çƒ¦ï¼Œæ‰€ä»¥å°±æ”¾å¼ƒäº†ã€‚</p><p>åæ¥æœç´¢åˆ°ï¼ŒHomebrew Formula æ˜¯æ”¯æŒ private repo çš„ï¼Œæ‰€ä»¥å°±æ‰“ç®—èµ°è¿™æ¡è·¯è¯•è¯•çœ‹ã€‚</p><p><a href="https://github.com/Homebrew/brew/blob/master/docs/Formula-Cookbook.md" target="_blank" rel="noopener">Formula Cookbook</a> æ˜¯å®˜æ–¹æä¾›çš„ä¸€äº›ä¿¡æ¯ï¼Œä½†æ–‡æ¡£å‡ ä¹æ²¡æœ‰äººçœ‹ï¼Œæˆ‘å°±ç®€å•ä»‹ç»ä¸€ä¸‹è¿™äº›ä¸œè¥¿åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹ã€‚</p><p>æ¯”å¦‚æˆ‘è¦å†™ä¸€ä¸ªå« foo çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨æˆ·å¯ä»¥åœ¨ç»ˆç«¯æ‰§è¡Œ <code>foo hello</code> æ¥è¾“å‡º <code>hello world!</code>ã€‚é‚£æˆ‘å¤§æ¦‚éœ€è¦åšå“ªäº›äº‹æƒ…å‘¢ï¼Ÿ</p><h3 id="1-åˆ›å»ºä¸¤ä¸ªä»“åº“ï¼ˆæˆ–è€…åªåˆ›å»ºä¸€ä¸ªä»“åº“ï¼‰"><a href="#1-åˆ›å»ºä¸¤ä¸ªä»“åº“ï¼ˆæˆ–è€…åªåˆ›å»ºä¸€ä¸ªä»“åº“ï¼‰" class="headerlink" title="1. åˆ›å»ºä¸¤ä¸ªä»“åº“ï¼ˆæˆ–è€…åªåˆ›å»ºä¸€ä¸ªä»“åº“ï¼‰"></a>1. åˆ›å»ºä¸¤ä¸ªä»“åº“ï¼ˆæˆ–è€…åªåˆ›å»ºä¸€ä¸ªä»“åº“ï¼‰</h3><p>ä¸€ä¸ªä»“åº“ç”¨æ¥æ”¾ç½® formula(ç±»ä¼¼äº CocoaPods/Specs)ï¼Œä¸€ä¸ªä»“åº“ç”¨æ¥æ”¾ä»£ç æºæ–‡ä»¶ã€‚å½“ç„¶ï¼Œå¦‚æœä½ ä¸ºäº†çœäº‹ï¼Œå¯ä»¥åƒæˆ‘ä¸€æ ·ï¼Œåªåˆ›å»ºä¸€ä¸ªä»“åº“ã€‚</p><p>æˆ‘åˆ›å»ºäº†ä¸€ä¸ªï¼Œå« <a href="https://github.com/X140Yu/homebrew-foo" target="_blank" rel="noopener">homebrew-foo</a></p><h3 id="2-ç¼–å†™-CLI-çš„ä»£ç "><a href="#2-ç¼–å†™-CLI-çš„ä»£ç " class="headerlink" title="2. ç¼–å†™ CLI çš„ä»£ç "></a>2. ç¼–å†™ CLI çš„ä»£ç </h3><p>è¿™æ˜¯æˆ‘ç¼–å†™å¥½çš„ <a href="https://github.com/X140Yu/homebrew-foo/commit/02c28244f8e7881346f4f902afb2afbfbb0fe2b5" target="_blank" rel="noopener">foo</a>ï¼Œæ³¨æ„ï¼Œéœ€è¦ç»™å®ƒåŠ ä¸Šæ‰§è¡Œæƒé™ã€‚è€Œä¸”è¿™é‡Œæˆ‘ä¾èµ–äº†ä¸€ä¸ªå« <code>gli</code> çš„ gemã€‚</p><h3 id="3-åˆ›å»º-Formula-æ–‡ä»¶"><a href="#3-åˆ›å»º-Formula-æ–‡ä»¶" class="headerlink" title="3. åˆ›å»º Formula æ–‡ä»¶"></a>3. åˆ›å»º Formula æ–‡ä»¶</h3><p><code>formula</code> å¯ä»¥çœ‹ä½œä¸€ä¸ªæè¿°æ–‡ä»¶ï¼Œç”¨æ¥æè¿°è¿™ä¸ªè½¯ä»¶çš„å…·ä½“ä¿¡æ¯ï¼Œç±»ä¼¼äº <a href="https://github.com/CocoaPods/Specs" target="_blank" rel="noopener">https://github.com/CocoaPods/Specs</a> ä¸­çš„ä¸€ä¸ª Sepc</p><p>æˆ‘åœ¨ repo æ ¹ç›®å½•åˆ›å»ºäº†ä¸€ä¸ª Formula æ–‡ä»¶å¤¹ï¼Œåœ¨å®ƒé‡Œé¢æ·»åŠ äº† <code>foo.rb</code> è¿™ä¸ª <a href="https://github.com/X140Yu/homebrew-foo/commit/a2353e3e5934d35cfe66cfb90d7b37c31e693846" target="_blank" rel="noopener">formula</a></p><p>æˆ‘è¿™é‡Œå†™å¾—æ¯”è¾ƒå¤æ‚ï¼Œå› ä¸ºæˆ‘ä¾èµ–äº† gli è¿™ä¸ª gemï¼Œå¦‚æœä½ ä¸ä¾èµ–ä»»ä½• gemï¼Œ<a href="https://github.com/X140Yu/homebrew-foo/commit/dc5617e8c750201965fc3784a9db075eb0d3c0d7" target="_blank" rel="noopener">å°±ä¼šç®€å•å¾ˆå¤š</a></p><h3 id="4-å®‰è£…"><a href="#4-å®‰è£…" class="headerlink" title="4. å®‰è£…"></a>4. å®‰è£…</h3><p>æœ‰äº† formulaï¼Œæœ‰äº†æºä»£ç ï¼Œå…¶å®ç°åœ¨å°±å¯ä»¥ release ç»™å¤§å®¶ç”¨äº†ã€‚</p><p>å®‰è£…æ­¥éª¤å¦‚ä¸‹ï¼Œ</p><p><code>brew tap x140yu/core git@github.com:X140Yu/homebrew-foo.git</code> </p><p>è¿™æ¡å‘½ä»¤ä¼šæŠŠä½  formula æ‰€åœ¨çš„ä»“åº“ clone åˆ° <code>/usr/local/Homebrew/Library/Taps/x140yu/homebre-core</code> é‡Œé¢ã€‚ä¸ºä½ çš„ foo å»ºç«‹æœç´¢èŒƒå›´ã€‚</p><p><code>brew install foo</code></p><p>homebrew ä¼šåœ¨ä¸Šé¢é‚£ä¸ªç›®å½•é‡Œæ‰¾åˆ°ä½ çš„ formulaï¼Œå°±å¯ä»¥å®‰è£…äº†ã€‚</p><p>å¦‚æœä½ åƒæˆ‘ä¸€æ ·è¿›è¡Œäº†ä¸Šé¢çš„æ“ä½œï¼Œé‚£ä½ çš„ CLI å°±å·²ç»å®‰è£…æˆåŠŸå¹¶å¯ä»¥è¿è¡Œäº†ï¼Œ</p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216230308.png" alt></p><h3 id="5-æ›´æ–°"><a href="#5-æ›´æ–°" class="headerlink" title="5. æ›´æ–°"></a>5. æ›´æ–°</h3><p>è½¯ä»¶å‘å¸ƒäº†æ–°ç‰ˆæœ¬æ”¯æŒäº†æ–°åŠŸèƒ½æ€ä¹ˆåŠï¼Ÿ</p><ol><li>æ›´æ–°ä»£ç </li><li>å‡çº§ <code>Formula/foo.rb</code> ä¸­çš„ tag <a href="https://github.com/X140Yu/homebrew-foo/commit/bb58a4de1471294878be45baf4ae191a0064db64" target="_blank" rel="noopener">åƒè¿™æ ·</a></li><li>æŠŠä»£ç  push åˆ°è¿œç¨‹ä»“åº“</li><li>æ‰“ä¸Šä¸åˆšæ‰ä¸€è‡´çš„ tag</li></ol><p>åœ¨å®‰è£…çš„æœºå™¨ä¸Šæ‰§è¡Œ <code>brew update &amp;&amp; brew reinstall foo</code> å°±å¯ä»¥æ›´æ–°åˆ°ä½ ä¿®æ”¹çš„æœ€æ–°ç‰ˆæœ¬äº†</p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216230323.png" alt></p><h3 id="6-å¸è½½"><a href="#6-å¸è½½" class="headerlink" title="6. å¸è½½"></a>6. å¸è½½</h3><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216230338.png" alt></p><p>ç¤ºä¾‹ä»£ç ä»“åº“åœ¨è¿™é‡Œ <a href="https://github.com/X140Yu/homebrew-foo" target="_blank" rel="noopener">https://github.com/X140Yu/homebrew-foo</a> åœ¨æŸäº›å…³é”®çš„åœ°æ–¹æ·»åŠ æ³¨é‡Šï¼Œå¸Œæœ›ä½ èƒ½çœ‹å¾—æ˜ç™½</p><p>æ€ä¹ˆæ ·ï¼Œä¸æ˜¯å¾ˆéº»çƒ¦å§ï¼Œå¦‚æœé‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œæ¬¢è¿ç•™è¨€~</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å½“å›¢é˜Ÿå·¥ç¨‹ä¸­çš„è„šæœ¬è¿‡å¤šäº†ä»¥åï¼Œå°±åº”è¯¥è€ƒè™‘æŠŠå®ƒä»¬ç»„ç»‡èµ·æ¥ï¼Œåšæˆ CLI äº†ã€‚æ¯”èµ·ä¸€ä¸ªä¸ªç‹¬ç«‹çš„è„šæœ¬ï¼ŒCLI æ›´å®¹æ˜“å‡çº§å’Œç»´æŠ¤ï¼Œä¹Ÿæ›´æ–¹ä¾¿å…±äº«ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘çš„åˆè¡·å°±æ˜¯æŠŠæ‰€æœ‰çš„è„šæœ¬æ”¾åˆ°ä¸€ä¸ª gitlab çš„ repo ä¸­ï¼Œæ‰€æœ‰æƒ³ä½¿ç”¨è¿™ä¸ªå·¥å…·çš„äººé€šè¿‡å¾ˆç®€å•çš„æ–¹å¼å°±èƒ½å®‰è£…ã€æ›´æ–°å¹¶ä½¿ç”¨å®ƒã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•æŠŠè¿™äº›è„šæœ¬ï¼Œå˜æˆåœ¨å›¢é˜Ÿå†…éƒ¨ï¼Œäººäººéƒ½å¯ä»¥å®‰è£…/å‡çº§çš„ CLI å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æˆ‘çš„é€‰æ‹©æ˜¯ Homebrew Formulaã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="ruby" scheme="https://x140yu.github.io/tags/ruby/"/>
    
  </entry>
  
  <entry>
    <title>Phantom Types in Swift</title>
    <link href="https://x140yu.github.io/2017-11-14-Phantom-Types/"/>
    <id>https://x140yu.github.io/2017-11-14-Phantom-Types/</id>
    <published>2017-11-14T05:30:00.000Z</published>
    <updated>2019-08-19T07:43:25.672Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ Objc.io ä¸Šçœ‹åˆ°äº†è¿™æ ·<a href="https://talk.objc.io/episodes/S01E71-type-safe-file-paths-with-phantom-types" target="_blank" rel="noopener">ä¸€æœŸè§†é¢‘</a>ã€‚ä¸»è¦ä»‹ç»äº†ä¸€ç§å« Phantom Types çš„æŠ€å·§ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯åœ¨ç±»å‹ï¼ˆtypeï¼‰ï¼Œè€Œä¸æ˜¯å€¼ï¼ˆvalueï¼‰è¿™ä¸ªå±‚é¢ä¸Šæ¥è¡¨ç¤ºçŠ¶æ€ï¼Œè€Œä¸”åœ¨ç¼–è¯‘æ—¶æœŸå¯¹é”™è¯¯ç±»å‹é—´çš„è¿ç®—åšå‡ºæç¤ºã€‚</p><p>Phantom Typesï¼ˆå¹½çµç±»å‹ï¼‰ å…¶å®å°±æ˜¯ç©ºç±»å‹ã€‚æ¯”å¦‚è¿™æ ·ï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Miles</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Kilometers</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>å®ƒæ¯”è¾ƒå®é™…çš„ä¸€ä¸ªåº”ç”¨æ˜¯ï¼Œè®©ç¼–è¯‘å™¨å¸®ä½ æ£€æŸ¥æŸäº›å¯¹è±¡åœ¨ç‰¹å®šçš„çŠ¶æ€ä¸‹èƒ½å¤Ÿè°ƒç”¨å“ªäº›æ–¹æ³•ã€‚ä¹Ÿèƒ½é€šè¿‡ç±»å‹æ¥è¡¨ç¤ºçŠ¶æ€ã€‚</p><a id="more"></a><h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><p>ä¸¾ä¸€ä¸ª Foundation ä¸­ API çš„ä¾‹å­ã€‚æœ‰è¿™æ ·ä¸€ä¸ªç±» <code>NSFileHandle</code>ï¼Œ</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">+ (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)fileHandleForReadingAtPath:(<span class="built_in">NSString</span> *)path;</span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)fileHandleForWritingAtPath:(<span class="built_in">NSString</span> *)path;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSData</span> *)readDataToEndOfFile;</span><br><span class="line">- (<span class="keyword">void</span>)writeData:(<span class="built_in">NSData</span> *)data;</span><br></pre></td></tr></table></figure><p>å®ƒæœ‰å‡ ç§åˆå§‹åŒ–æ–¹æ³•ï¼Œå½“ä½ åˆ›å»ºä¸€ä¸ªè¯»æ–¹å¼çš„ <code>fileHandle</code> æ—¶ï¼Œä½ åªèƒ½è°ƒç”¨è¯»ç›¸å…³çš„ APIï¼Œè°ƒç”¨å†™ç›¸å…³çš„æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚ä½†æ˜¯åœ¨ Objective-C ä¸­ï¼Œä¸è¶³ä»¥åœ¨ç¼–è¯‘æ—¶æœŸæŠŠè¿™ä¸ªé—®é¢˜æå®šï¼Œä½ è¿˜æ˜¯å¯ä»¥å¼€ä¸€ä¸ªè¯»çš„ <code>fileHandle</code>ï¼Œç„¶åå¯¹å®ƒè°ƒç”¨å†™çš„æ–¹æ³•ï¼Œ</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">NSFileHandle</span> *handle = [<span class="built_in">NSFileHandle</span> fileHandleForReadingAtPath:<span class="string">@"path"</span>];</span><br><span class="line"><span class="comment">/// it does't make sense</span></span><br><span class="line">[handle writeData:someData];</span><br></pre></td></tr></table></figure><p>å¦‚ä½•é€šè¿‡ Phantom Types æ¥è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå®ç°çš„æ–¹å¼å¾ˆç®€å•ï¼Œå€ŸåŠ© Swift ä¸­çš„æ³›å‹ï¼ŒæŠŠå½“å‰ç±»å‹ä¸‹èƒ½å¤Ÿè°ƒç”¨çš„æ–¹æ³•å®šä¹‰åœ¨ç±»å‹é™å®šçš„ <code>extension</code> ä¸­å°±å¯ä»¥äº†ã€‚</p><p>æˆ‘ä»¬å®šä¹‰å‡ºä¸¤ä¸ª Phantom Typesï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Write</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Read</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå®šä¹‰å‡ºæ”¯æŒæ³›å‹çš„ <code>FileHandle</code> ç±»ï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">FileHandle</span>&lt;<span class="title">OperationType</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> path: <span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="number">_</span> path: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.path = path</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŠŠä¸åŒç±»å‹ <code>handle</code> å¯ä»¥è°ƒç”¨çš„æ–¹æ³•æ”¾åˆ°ä¸åŒçš„ <code>extension</code> ä¸­ï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">FileHandle</span> <span class="title">where</span> <span class="title">OperationType</span> == <span class="title">Write</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// æŠŠåˆå§‹åŒ–æ–¹æ³•ä¹Ÿæ”¾åˆ°å„è‡ªçš„åŸå› æ˜¯å¯ä»¥è®©ç¼–è¯‘å™¨æ¨å€’ç±»å‹</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">handleWithWirtePath</span><span class="params">(path: String)</span></span> -&gt; <span class="type">FileHandle</span>&lt;<span class="type">Write</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">FileHandle</span>&lt;<span class="type">Write</span>&gt;(path)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">write</span><span class="params">(string: String)</span></span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">FileHandle</span> <span class="title">where</span> <span class="title">OperationType</span> == <span class="title">Read</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">handleWithReadPath</span><span class="params">(path: String)</span></span> -&gt; <span class="type">FileHandle</span>&lt;<span class="type">Read</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">FileHandle</span>&lt;<span class="type">Read</span>&gt;(path)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">read</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨å°±å¾ˆç®€å•äº†ï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> f = <span class="type">FileHandle</span>.handleWithReadPath(path: <span class="string">"path/to/resources"</span>)</span><br><span class="line">f.read()</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ æƒ³è¦é€šè¿‡ä¸Šé¢çš„ <code>handle</code> è°ƒç”¨ <code>write</code> ç›¸å…³çš„æ–¹æ³•ï¼Œç¼–è¯‘å™¨ä¼šç»™å‡ºæç¤ºï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// error: 'FileHandle&lt;Read&gt;' is not convertible to 'FileHandle&lt;Write&gt;'</span></span><br><span class="line">f.write(string: <span class="string">""</span>)</span><br></pre></td></tr></table></figure><h2 id="å†å¤šè¯´ä¸¤å¥"><a href="#å†å¤šè¯´ä¸¤å¥" class="headerlink" title="å†å¤šè¯´ä¸¤å¥"></a>å†å¤šè¯´ä¸¤å¥</h2><p>åœ¨ Haskell ä¸­ï¼Œè¿™ç§åº”ç”¨æ˜¯ä¼šåœ¨ç¼–è¯‘æ—¶æœŸè¢«ä¼˜åŒ–æ‰çš„ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šå¯¹æ€§èƒ½äº§ç”Ÿä»»ä½•å½±å“ã€‚ä¸çŸ¥é“ Swift æ˜¯ä¸æ˜¯ä¹Ÿæ˜¯ä¸€æ ·ï¼ˆbut who caresï¼‰ã€‚</p><p>ä»¥ååœ¨çœ‹åˆ°ä¸€äº›ç©ºç±»å‹çš„å®šä¹‰å¯ä»¥å…ˆæ€€ç–‘å®ƒæ˜¯ä¸æ˜¯ Phantom Types çš„ä¸€ç§åº”ç”¨ï¼Œä¹Ÿè®¸å®ƒçš„å‡ºç°æ˜¯å­˜åœ¨æ„ä¹‰çš„ã€‚è¦å¥½å¥½åˆ©ç”¨ç±»å‹ç³»ç»Ÿçš„å¼ºå¤§ã€‚</p><h2 id="Credits"><a href="#Credits" class="headerlink" title="Credits"></a>Credits</h2><ul><li><a href="https://talk.objc.io/episodes/S01E71-type-safe-file-paths-with-phantom-types" target="_blank" rel="noopener">Type-Safe File Paths with Phantom Types</a></li><li><a href="http://jayeshkawli.ghost.io/using-phantom-types-in-swift/" target="_blank" rel="noopener">Using Phantom Types in Swift</a></li><li><a href="https://www.natashatherobot.com/swift-money-phantom-types/" target="_blank" rel="noopener">Swift: Money with Phantom Types ğŸ‘»</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨ Objc.io ä¸Šçœ‹åˆ°äº†è¿™æ ·&lt;a href=&quot;https://talk.objc.io/episodes/S01E71-type-safe-file-paths-with-phantom-types&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ä¸€æœŸè§†é¢‘&lt;/a&gt;ã€‚ä¸»è¦ä»‹ç»äº†ä¸€ç§å« Phantom Types çš„æŠ€å·§ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯åœ¨ç±»å‹ï¼ˆtypeï¼‰ï¼Œè€Œä¸æ˜¯å€¼ï¼ˆvalueï¼‰è¿™ä¸ªå±‚é¢ä¸Šæ¥è¡¨ç¤ºçŠ¶æ€ï¼Œè€Œä¸”åœ¨ç¼–è¯‘æ—¶æœŸå¯¹é”™è¯¯ç±»å‹é—´çš„è¿ç®—åšå‡ºæç¤ºã€‚&lt;/p&gt;
&lt;p&gt;Phantom Typesï¼ˆå¹½çµç±»å‹ï¼‰ å…¶å®å°±æ˜¯ç©ºç±»å‹ã€‚æ¯”å¦‚è¿™æ ·ï¼Œ&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Miles&lt;/span&gt; &lt;/span&gt;&amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Kilometers&lt;/span&gt; &lt;/span&gt;&amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å®ƒæ¯”è¾ƒå®é™…çš„ä¸€ä¸ªåº”ç”¨æ˜¯ï¼Œè®©ç¼–è¯‘å™¨å¸®ä½ æ£€æŸ¥æŸäº›å¯¹è±¡åœ¨ç‰¹å®šçš„çŠ¶æ€ä¸‹èƒ½å¤Ÿè°ƒç”¨å“ªäº›æ–¹æ³•ã€‚ä¹Ÿèƒ½é€šè¿‡ç±»å‹æ¥è¡¨ç¤ºçŠ¶æ€ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="https://x140yu.github.io/tags/iOS/"/>
    
      <category term="Swift" scheme="https://x140yu.github.io/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>å‡çº§ Swift 4</title>
    <link href="https://x140yu.github.io/2017-09-21-Swift-4/"/>
    <id>https://x140yu.github.io/2017-09-21-Swift-4/</id>
    <published>2017-09-21T14:37:00.000Z</published>
    <updated>2019-08-19T07:43:25.672Z</updated>
    
    <content type="html"><![CDATA[<p>å…¬å¸çš„ CI ç»ˆäºå‡çº§åˆ°äº† Xcode 9ï¼Œæ‰€ä»¥é¡¹ç›®çš„ä»£ç ä¹Ÿå¯ä»¥å‡çº§ä¸€ä¸‹ Swift 4 äº†ã€‚å› ä¸º Xcode 9 æ˜¯æ”¯æŒ Swift 4 å’Œ Swift 3.2 åŒæ—¶å­˜åœ¨çš„ï¼Œå¦‚æœä½ æ‰€æœ‰ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“éƒ½èƒ½å¤Ÿæ”¯æŒåˆ° Swift 3.2 åŠä»¥ä¸Šï¼Œé‚£ä½ çš„é¡¹ç›®å°±èƒ½æ— ç—›å‡çº§äº†ã€‚å¦‚æœçœŸçš„å¸Œæœ›ä¸€åŠæ˜¯ 3.2 ä¸€åŠæ˜¯ 4ï¼Œå¯ä»¥é€šè¿‡<a href="https://gist.github.com/JohnSundell/519cb322978ac59f5ac161ff67e4413b" target="_blank" rel="noopener">è¿™æ ·</a>æ›´æ”¹ <code>Podfile</code> å®ç°è¿™ç§éœ€æ±‚ã€‚</p><a id="more"></a><p>ä½¿ç”¨ Xcode æä¾›çš„è½¬æ¢å·¥å…· <code>Edit - Conver - To current Swift syntaxâ€¦</code>ï¼Œå‹¾é€‰é»˜è®¤çš„é€‰é¡¹ <code>Minimize Inference</code>ï¼Œå°±å¯ä»¥å¼€å§‹è¿›è¡Œç¼–è¯‘å™¨è¾…åŠ©åœ°è½¬æ¢æµç¨‹äº†ã€‚è¿™è¿˜å¯ä»¥å‡å°‘ä¸€å®šçš„åŒ…å¤§å°ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å¯¹äº Objective-C å’Œ Swift æ··åˆçš„é¡¹ç›®ï¼Œåœ¨ Objective-C è°ƒç”¨ Swift ä»£ç ä¹‹å‰æ˜¯éœ€è¦å¼•ç”¨ <code>xxx-Swift.h</code> å¤´æ–‡ä»¶çš„ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ç”±ç¼–è¯‘å™¨åŠ¨æ€ç”Ÿæˆçš„ã€‚åœ¨ Swift 4 ä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”ä¸‹é¢çš„ <code>Match Swift 3 Behavior</code> ï¼Œç¼–è¯‘å™¨ä¼šæ— è„‘æ¨æ–­ï¼ŒæŠŠæ‰€æœ‰çš„ <code>pulic</code> å±æ€§å’Œæ–¹æ³•æš´éœ²ç»™ Objective-Cï¼Œä¹Ÿå°±æ˜¯ä¼šæœ‰å¾ˆå¤š <code>xxx-Swift.h</code> è€Œä¸”æ¯ä¸ªéƒ½å¾ˆå¤§ã€‚ä½†æ˜¯ Swift 4 ä¸­å˜å¾—ä¸¥æ ¼äº†ï¼Œåªæœ‰è¢«æ ‡è®°ä¸º <code>@objc</code> çš„æ–¹æ³•å’Œå±æ€§æ‰ä¼šæš´éœ²ç»™ Objective-Cã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥å‡å°‘ä¸€äº›ä»£ç çš„ç”Ÿæˆï¼Œä»è€Œå‡å°‘åŒ…å¤§å°ã€‚</p><p><img src="http://oo8znht6g.bkt.clouddn.com/20170921223606_7bm7p7_Screenshot.png" alt="Minimize Inference"></p><p>ç‚¹å‡» Nextã€‚ç»è¿‡ä¸€æ®µæ¼«é•¿çš„ç­‰å¾…ï¼ˆéœ€è¦ä¸€æ¬¡å®Œæ•´çš„ç¼–è¯‘ï¼‰ï¼Œç¼–è¯‘å™¨ä¼šå¸®ä½ æŠŠé¡¹ç›®ä¸­å®ƒèƒ½è½¬æ¢çš„ä»£ç éƒ½è½¬æ¢äº†ï¼Œé¡ºä¾¿æŠŠå·¥ç¨‹è®¾ç½®ä¸­çš„ Build Setting - Swift version æ”¹ä¸º 4ã€‚ä½†ä½ ä»¥ä¸ºè¿™æ ·å°±å¤§åŠŸå‘Šæˆäº†å—ï¼ŸToo yongï¼ç¼–è¯‘å™¨èƒ½å¸®ä½ åšçš„åªæ˜¯ä¸€äº›å¾®å°çš„å·¥ä½œï¼Œè€Œä¸”å®ƒè¿˜å¯èƒ½ç»™ä½ æ”¹é”™ï¼ä¸€å®šè¦åœ¨å®ƒæ”¹å®Œä¹‹åå†æ£€æŸ¥ä¸€æ¬¡ï¼Œä»¥å…å‘ç”Ÿé”™è¯¯ã€‚å† build ä¸€æ¬¡ä½ å°±ä¼šå‘ç°å¤§é‡çš„ errorï¼Œå°¤å…¶æ˜¯ä¸€ä¸ª Objective-C å’Œ Swift æ··åˆçš„é¡¹ç›®ï¼Œå‡çº§ Swift 4 å°±æ˜¯ä¸€ä¸ªä¸åœåœ¨ Swift å±æ€§å’Œæ–¹æ³•åå‰åŠ  <code>@objc</code> çš„è¿‡ç¨‹ï¼ŒåŠ åˆ°ä½ æ€€ç–‘äººç”Ÿã€‚ã€‚</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://www.raywenderlich.com/163857/whats-new-swift-4" target="_blank" rel="noopener">Whatâ€™s New in Swift 4?</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å…¬å¸çš„ CI ç»ˆäºå‡çº§åˆ°äº† Xcode 9ï¼Œæ‰€ä»¥é¡¹ç›®çš„ä»£ç ä¹Ÿå¯ä»¥å‡çº§ä¸€ä¸‹ Swift 4 äº†ã€‚å› ä¸º Xcode 9 æ˜¯æ”¯æŒ Swift 4 å’Œ Swift 3.2 åŒæ—¶å­˜åœ¨çš„ï¼Œå¦‚æœä½ æ‰€æœ‰ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“éƒ½èƒ½å¤Ÿæ”¯æŒåˆ° Swift 3.2 åŠä»¥ä¸Šï¼Œé‚£ä½ çš„é¡¹ç›®å°±èƒ½æ— ç—›å‡çº§äº†ã€‚å¦‚æœçœŸçš„å¸Œæœ›ä¸€åŠæ˜¯ 3.2 ä¸€åŠæ˜¯ 4ï¼Œå¯ä»¥é€šè¿‡&lt;a href=&quot;https://gist.github.com/JohnSundell/519cb322978ac59f5ac161ff67e4413b&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;è¿™æ ·&lt;/a&gt;æ›´æ”¹ &lt;code&gt;Podfile&lt;/code&gt; å®ç°è¿™ç§éœ€æ±‚ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="https://x140yu.github.io/tags/iOS/"/>
    
      <category term="Swift" scheme="https://x140yu.github.io/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚æœä½ ä¹Ÿç”¨ Development Pods</title>
    <link href="https://x140yu.github.io/2017-09-16-development-pods-dependency-checker/"/>
    <id>https://x140yu.github.io/2017-09-16-development-pods-dependency-checker/</id>
    <published>2017-09-16T08:50:00.000Z</published>
    <updated>2019-08-19T07:43:25.672Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å¦‚æœä½ çš„ iOS é¡¹ç›®æ˜¯ä½¿ç”¨ Development Pods æ¥åšç»„ä»¶åŒ–çš„è¯ï¼Œè¿™ç¯‡æ–‡ç« æˆ–è®¸å€¼å¾—ä¸€çœ‹ã€‚</p></blockquote><a id="more"></a><h2 id="èµ·æº"><a href="#èµ·æº" class="headerlink" title="èµ·æº"></a>èµ·æº</h2><p>çŸ¥ä¹çš„ iOS é¡¹ç›®å¤§æ¦‚åœ¨ 2016 å¹´ Q4 å¼€å§‹è¿›è¡Œç»„ä»¶åŒ–çš„å·¥ä½œï¼Œå½“æ—¶çš„è®¡åˆ’å°±æ˜¯æŠŠä¸» target å†…çš„æ–‡ä»¶ä»¥ Development Pods çš„å½¢å¼æ‹†åˆ†ä¸º Basicï¼ŒCoreï¼ŒMiddlewareï¼ŒModule å››ç§ç±»åˆ«çš„ Development Pods ä¾›ä¸» target è¿›è¡Œä¾èµ–ã€‚</p><p>è¿™å‡ å±‚ç»“æ„ä¹‹é—´æœ‰ä¸‹é¢è¿™ä¸ªä¸‹é¢è¿™ä¸ªçº¦æŸå…³ç³»ï¼ŒPods åªèƒ½ä¾èµ–æ¯”å®ƒä»¬å±‚çº§ä½çš„è€Œä¸èƒ½ä¾èµ–æ¯”å®ƒä»¬å±‚çº§é«˜çš„ï¼Œè€Œä¸”åŒå±‚é—´ä¹Ÿå°½é‡é¿å…ä¾èµ–å…³ç³»ã€‚æ¢åè¯è¯´ï¼ŒCore å¯ä»¥ä¾èµ– Basic ä½†æ˜¯ Basic ä¸èƒ½ä¾èµ– Coreã€‚è¿™æ ·åšçš„åŸå› å¾ˆç®€å•ï¼Œå°±æ˜¯é¿å…å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216230012.png" alt></p><p>ç»„ä»¶åŒ–çš„ç›®çš„ä¹‹ä¸€æ˜¯å‡å°‘ä¾èµ–ï¼Œå¯ä»¥è®©ä¸€ä¸ªç»„ä»¶ç‹¬ç«‹äºä¸» target ä¹‹å¤–ç‹¬ç«‹è¿è¡Œï¼Œè¿™æ ·ä¸ºäº†è¿™ä¸ªç»„ä»¶å»ºç«‹å•ç‹¬çš„å·¥ç¨‹ï¼Œç‹¬ç«‹ç¼–è¯‘ã€å¼€å‘ï¼Œæå‡æ•ˆç‡ã€‚</p><h2 id="ä¸ºæŸä¸ª-Development-Pods-åˆ›å»ºç‹¬ç«‹å·¥ç¨‹"><a href="#ä¸ºæŸä¸ª-Development-Pods-åˆ›å»ºç‹¬ç«‹å·¥ç¨‹" class="headerlink" title="ä¸ºæŸä¸ª Development Pods åˆ›å»ºç‹¬ç«‹å·¥ç¨‹"></a>ä¸ºæŸä¸ª Development Pods åˆ›å»ºç‹¬ç«‹å·¥ç¨‹</h2><p>ä½†æ˜¯å½“æˆ‘ä¸ºä¸€ä¸ªç»„ä»¶å•ç‹¬åˆ›å»ºå·¥ç¨‹çš„æ—¶å€™ï¼Œé‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå§‘ä¸”æŠŠå®ƒå«ä½œç»„ä»¶ R å§ã€‚ä½œä¸ºä¸€ä¸ª Podï¼ŒR çš„ä¾èµ–å…³ç³»æ˜¯ç”± R.podspec ä½“ç°çš„ï¼Œå®ƒåªéœ€è¦å…³å¿ƒå®ƒç›´æ¥ä¾èµ–çš„ä¸œè¥¿å°±å¥½äº†ï¼Œå¯¹äºå®ƒä¾èµ–çš„ä¾èµ–å®ƒæ˜¯ä¸éœ€è¦å…³å¿ƒçš„ï¼ŒCocoapods å·²ç»å¸®æˆ‘ä»¬å¤„ç†å¥½äº†ã€‚</p><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">Pod::Spec.new <span class="keyword">do</span> <span class="params">|s|</span></span><br><span class="line">  s.name = <span class="string">"R"</span></span><br><span class="line">  <span class="comment"># some other fields...</span></span><br><span class="line">  s.dependency <span class="string">'A'</span></span><br><span class="line">  s.dependency <span class="string">'C'</span></span><br><span class="line">  s.dependency <span class="string">'E'</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ï¼Œä¸Šå›¾çš„ R ä¾èµ–äº† Aã€Cã€E ä¸‰ä¸ª Podsã€‚</p><p>ä¸º R åˆ›å»ºä¾èµ–ç‹¬ç«‹å·¥ç¨‹çš„æ—¶å€™ï¼Œéœ€è¦æŠŠ R ä½œä¸ºè¿™ä¸ªå·¥ç¨‹çš„ä¸€ä¸ªä¾èµ–ï¼Œä½¿ç”¨è·¯å¾„çš„å½¢å¼å¼•å…¥ã€‚</p><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Podfile</span></span><br><span class="line"></span><br><span class="line">target <span class="string">'Example'</span> <span class="keyword">do</span></span><br><span class="line">  pod <span class="string">'R'</span>, <span class="symbol">:path</span> =&gt; <span class="string">'../../R'</span>,</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ä»¥ä¸ºè¿™æ ·å†™å°±å¤§åŠŸå‘Šæˆäº†ï¼Œå°±å¤§é”™ç‰¹é”™äº†ã€‚æ‰§è¡Œ <code>pod install</code> åå°±ä¼šå‘ç° <code>æœªèƒ½æ‰¾åˆ° A</code> ç±»ä¼¼çš„é”™è¯¯ã€‚ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜å‘¢ï¼Ÿå…¶å®æˆ‘ä¹Ÿä¸çŸ¥é“å…·ä½“çš„åŸå› ğŸ˜‚ï¼Œä½†æ˜¯ä¸€ä¸ªå¯èƒ½çš„çŒœæµ‹æ˜¯<br> <code>Podfile</code> ä¸­çš„ä¾èµ–å…³ç³»å¿…é¡»è¦æ˜ç¡®ï¼Œå°¤å…¶æ˜¯è¿™äº› pods éƒ½æ˜¯ä»¥æœ¬åœ°è·¯å¾„å…³ç³»ç›¸äº’ä¾èµ–çš„æƒ…å†µä¸‹ã€‚è€Œ <code>podspec</code> ä¸­çš„ä¾èµ–ä¸éœ€è¦é‚£ä¹ˆæ˜ç¡®ï¼ŒCocoapods ä¼šå¸®ä½ å¤„ç†ã€‚</p><p>å› ä¸ºæˆ‘ä»¬ä½¿ç”¨ Development Podsï¼Œæ‰€ä»¥æ‰€æœ‰çš„ Pods å¿…ç„¶ä»¥æœ¬åœ°è·¯å¾„çš„å…³ç³»è¿›è¡Œä¾èµ–ã€‚æ‰€ä»¥åœ¨ä¸º R åˆ›å»ºç‹¬ç«‹å·¥ç¨‹çš„æ—¶å€™ï¼Œéœ€è¦æŠŠ R ä¾èµ–çš„æ‰€æœ‰ Pods çš„è·¯å¾„æ ‡è®°å‡ºæ¥ç»™ CocoaPods çœ‹ã€‚æ‰€ä»¥ä½ å¯èƒ½ä¼šå†™å‡ºä¸‹é¢çš„ <code>Podfile</code> ï¼Œ</p><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">target <span class="string">'Example'</span> <span class="keyword">do</span></span><br><span class="line">  pod <span class="string">'R'</span>, <span class="symbol">:path</span> =&gt; <span class="string">'../../R'</span></span><br><span class="line">  pod <span class="string">'A'</span>, <span class="symbol">:path</span> =&gt; <span class="string">'../../A'</span></span><br><span class="line">  pod <span class="string">'C'</span>, <span class="symbol">:path</span> =&gt; <span class="string">'../../C'</span></span><br><span class="line">  pod <span class="string">'E'</span>, <span class="symbol">:path</span> =&gt; <span class="string">'../../E'</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>æ»¡æ¬£æ¬¢å–œåœ°è·‘å» <code>pod install</code> ï¼Œç»“æœåˆå¤±è´¥äº†ï¼ŒåŸæ¥ C è¿˜ä¾èµ–äº† Bï¼äºæ˜¯ä½ åˆè·‘å»ç»™ <code>podfile</code> åŠ äº†ä¸€è¡Œï¼Œ</p><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">target <span class="string">'Example'</span> <span class="keyword">do</span></span><br><span class="line">  pod <span class="string">'R'</span>, <span class="symbol">:path</span> =&gt; <span class="string">'../../R'</span></span><br><span class="line">  pod <span class="string">'A'</span>, <span class="symbol">:path</span> =&gt; <span class="string">'../../A'</span></span><br><span class="line">  pod <span class="string">'B'</span>, <span class="symbol">:path</span> =&gt; <span class="string">'../../B'</span></span><br><span class="line">  pod <span class="string">'C'</span>, <span class="symbol">:path</span> =&gt; <span class="string">'../../C'</span></span><br><span class="line">  pod <span class="string">'E'</span>, <span class="symbol">:path</span> =&gt; <span class="string">'../../E'</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>å¥½å§ï¼Œä½ åˆå¤±è´¥äº†ï¼ŒE è¿˜ä¾èµ–äº† Dâ€¦â€¦ Stop! å¦‚æœæ€»æ˜¯è¿™æ ·ä¸€æ¬¡åˆä¸€æ¬¡ <code>pod install</code> æ‰èƒ½çŸ¥é“è‡ªå·±å…¨éƒ¨ä¾èµ–çš„ Pods æœ‰ä»€ä¹ˆæ˜¯ä¸æ˜¯å¤ªæ“äº†ï¼Ÿå¦‚æœä¾èµ–å°‘è¿˜å¥½ï¼Œä½†æ˜¯å¯¹äºä¾èµ–å¾ˆå¤šæƒ…å†µï¼Œè¿™æ ·ä¸€æ¬¡æ¬¡å¤„ç†å°±æœ‰ç‚¹ 2 äº†ã€‚èƒ½ä¸èƒ½æœ‰ä»€ä¹ˆåˆ«çš„æ–¹æ³•èƒ½ä¸€æ¬¡æ€§çŸ¥é“æŸä¸ª Development Pod çš„å…¨éƒ¨ä¾èµ–å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç›´æ¥ç§»æ­¥è¿™é‡Œ <a href="https://github.com/X140Yu/development-pods-dependency-checker" target="_blank" rel="noopener">X140Yu/development-pods-dependency-checker</a> </p><h2 id="Development-Pods-Dependency-Checker"><a href="#Development-Pods-Dependency-Checker" class="headerlink" title="Development Pods Dependency Checker"></a>Development Pods Dependency Checker</h2><p>æ•ˆæœåœ¨ repo é‡Œçš„ README å°±å¯ä»¥çœ‹åˆ°äº†ï¼Œå®ƒèƒ½æ‰¾å‡ºå·¥ç¨‹ä¸­çš„æ‰€æœ‰ä¾èµ–ï¼Œå¹¶ä¸”æŠŠæ¯ä¸ª Pod çš„ä¾èµ–å±•å¼€ï¼Œæ˜¾ç¤ºå‡ºå®ƒçš„å…¨éƒ¨ä¾èµ–ï¼Œè€Œä¸æ˜¯ podspec ä¸­çš„é‚£ä¸€å°éƒ¨åˆ†ã€‚</p><p>å®ƒçš„åŸç†å¾ˆç®€å•ï¼Œåœ¨ <code>pod install</code> æˆåŠŸä¹‹åï¼Œ <code>Pods/Local Podspecs</code> ç›®å½•ä¸­ä¼šå‡ºç°ä¸€å † <code>*.podspec.json</code> æ–‡ä»¶ï¼Œä½ å¯ä»¥æŠŠå®ƒä»¬ç†è§£ä¸º <code>podspec</code> çš„ JSON ç‰ˆæœ¬ï¼Œè¿™å¯¹ JS å¤„ç†æ›´åŠ å‹å¥½ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// R.podspec.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"R"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"0.0.1"</span>,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="string">"dependencies"</span>: &#123;</span><br><span class="line">  <span class="string">"A"</span>: [],</span><br><span class="line">  <span class="string">"C"</span>: [],</span><br><span class="line">  <span class="string">"E"</span>: []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œä½œä¸º localpods çš„ A, C, E ä¹Ÿä¼šæœ‰ç±»ä¼¼è¿™æ ·çš„æ–‡ä»¶ã€‚æ‰€ä»¥æˆ‘ä»¬è¦åšçš„äº‹æƒ…å°±å¾ˆç®€å•äº†ï¼ŒæŒ¨ä¸ª parse å„ä¸ª JSON æ–‡ä»¶ï¼Œé€’å½’å¤„ç† <code>dependencies</code> ä¸­çš„æ¯ä¸€é¡¹ï¼Œç›´åˆ°å®ƒçš„ <code>dependencies</code> æ˜¯ç©ºä¸ºæ­¢ã€‚å…¶å®æ ¸å¿ƒçš„é€»è¾‘ä¹Ÿå°±ä¸‹é¢è¿™ä¸€å°æ®µï¼Œ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trigger</span>(<span class="params">pods</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> podsRet =[]</span><br><span class="line">  pods.forEach(<span class="function"><span class="params">ele</span> =&gt;</span> &#123;</span><br><span class="line">    podsRet.push(recursiveFindDependencies(ele, pods))</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> podsRet</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">recursiveFindDependencies</span>(<span class="params">ele, pods</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> pod =&#123;&#125;</span><br><span class="line">  <span class="keyword">if</span> (ele.name == <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  pod.name = ele.name</span><br><span class="line">  pod.dependencies =[]</span><br><span class="line">  ele.dependencies.forEach(<span class="function"><span class="params">dep</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (pod.dependencies.filter(<span class="function"><span class="params">es</span> =&gt;</span> es == dep).length == <span class="number">0</span>) &#123;</span><br><span class="line">      pod.dependencies.push(dep)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> deps = findDependencies(pods, dep).forEach(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">Array</span>.prototype.push.apply(pod.dependencies, recursiveFindDependencies(e, pods))</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">if</span> (pod.dependencies.filter(<span class="function"><span class="params">es</span> =&gt;</span> es == e).length == <span class="number">0</span>) &#123;</span><br><span class="line">        pod.dependencies.push(e)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> pod</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰äº†è¿™ä¸ªå·¥å…·ä»¥åï¼Œå°±èƒ½å¤Ÿçœ‹æ¸…ä¸€ä¸ª pod åˆ°åº•ä¾èµ–äº†ä»€ä¹ˆï¼Œé¦–å…ˆå®ƒæ›´ä¾¿äºä¸º pod åˆ›å»ºç‹¬ç«‹è¿è¡Œçš„å·¥ç¨‹ï¼Œå…¶æ¬¡ï¼Œä¹Ÿèƒ½åœ¨å¼€å‘é˜¶æ®µçŸ¥é“ä¾èµ–å…³ç³»ï¼Œé¿å…åŒå±‚ä¾èµ–åŠä½å±‚å‘æ›´é«˜å±‚çš„ pod ä¾èµ–ã€‚</p><p>å…³äºè¿™ä¸ªå°å·¥å…·ï¼Œè¿˜æƒ³è¯´ä¸¤å¥ã€‚å®ƒæ˜¯ç”¨ <a href="https://electron.atom.io/" target="_blank" rel="noopener">electron</a> å†™çš„ï¼Œå…¶å®è¿™ä¸œè¥¿å®Œå…¨ç”¨ä¸ä¸Š electron çš„è·¨å¹³å°ä¾¿åˆ©æ€§ï¼Œå› ä¸ºå®ƒåªå¯èƒ½åœ¨ mac ä¸Šè¿è¡Œï¼Œä½†æˆ‘è¿˜æ˜¯è„‘ä¸€æŠ½ç”¨å®ƒå†™äº†ï¼Œæ¯•ç«Ÿ HTML &amp; CSS æ¯”åŸç”Ÿå¼€å‘æ•ˆç‡é«˜å¾—å¤šã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;å¦‚æœä½ çš„ iOS é¡¹ç›®æ˜¯ä½¿ç”¨ Development Pods æ¥åšç»„ä»¶åŒ–çš„è¯ï¼Œè¿™ç¯‡æ–‡ç« æˆ–è®¸å€¼å¾—ä¸€çœ‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="https://x140yu.github.io/tags/iOS/"/>
    
      <category term="electron" scheme="https://x140yu.github.io/tags/electron/"/>
    
  </entry>
  
  <entry>
    <title>ä¸ºä½ çš„ pod æ·»åŠ æµ‹è¯•</title>
    <link href="https://x140yu.github.io/2017-08-05-add-test-to-your-pod/"/>
    <id>https://x140yu.github.io/2017-08-05-add-test-to-your-pod/</id>
    <published>2017-08-05T14:00:00.000Z</published>
    <updated>2019-08-19T07:43:25.671Z</updated>
    
    <content type="html"><![CDATA[<p>å‰å‡ å¤© Cocoapods release äº† <a href="http://link.zhihu.com/?target=http%3A//blog.cocoapods.org/CocoaPods-1.3.0/" target="_blank" rel="noopener">1.3.0</a> ï¼Œä¸€ä¸ªæ¯”è¾ƒä»¤äººæ¿€åŠ¨çš„åŠŸèƒ½æ˜¯å¯ä»¥åœ¨ pod å†…éƒ¨æ·»åŠ æµ‹è¯•äº†ã€‚</p><a id="more"></a><h2 id="è¿‡å»æˆ‘ä»¬å¦‚ä½•æ·»åŠ æµ‹è¯•"><a href="#è¿‡å»æˆ‘ä»¬å¦‚ä½•æ·»åŠ æµ‹è¯•" class="headerlink" title="è¿‡å»æˆ‘ä»¬å¦‚ä½•æ·»åŠ æµ‹è¯•"></a>è¿‡å»æˆ‘ä»¬å¦‚ä½•æ·»åŠ æµ‹è¯•</h2><p>åœ¨è¿‡å»ä¸æ”¯æŒè¿™ä¸ªåŠŸèƒ½çš„æ—¶å€™ï¼Œå¦‚æœè¦ä¸ºä¸€ä¸ª pod æ·»åŠ æµ‹è¯•å°±éœ€è¦å¦å¤–ä¸€ä¸ªå·¥ç¨‹ä¾èµ–ä¹‹ï¼Œç„¶åæŠŠæµ‹è¯•æ–‡ä»¶éƒ½æ·»åŠ åˆ°ç¦»æ­¤ pod åä¸‡å…«åƒé‡Œçš„åœ°æ–¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ</p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216225914.png" alt></p><p>è¿™æ ·å­çš„å¼Šç«¯æ˜¯ååˆ†æ˜æ˜¾çš„ï¼Œ</p><p>é¦–å…ˆå°±æ˜¯<strong>ä»£ç å’Œæµ‹è¯•åˆ†ç¦»äº†</strong>ï¼ˆå…³äºä¸ºä»€ä¹ˆè¦æŠŠä»£ç å’Œæµ‹è¯•æ”¾åˆ°ä¸€èµ·ï¼Œ<a href="http://link.zhihu.com/?target=https%3A//kickstarter.engineering/why-you-should-co-locate-your-xcode-tests-c69f79211411" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>è§£é‡Šåœ°å¾ˆæ¸…æ¥šï¼‰ã€‚è¿™ç§åˆ†ç¦»è¿˜ä¸æ˜¯åŒä¸€ä¸ª project ä¸­ä¸åŒ target çš„åˆ†ç¦»ï¼Œè€Œæ˜¯ä¸åŒ project çš„é‚£ç§åˆ†ç¦»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä¸ºäº†çœ‹åˆ°è¿™ä¸ª pod ä¸­çš„æµ‹è¯•ï¼Œè¿˜å¿…é¡»è¦ä¸‹è½½å¯¹åº”çš„ project æ‰“å¼€æ‰èƒ½çœ‹åˆ°ã€‚</p><p>å…¶æ¬¡ï¼Œè¿™ä¸ª pod ä¸­çš„æµ‹è¯•æ²¡æ³•åŠä½œä¸ºä¸€ä¸ª target å•ç‹¬è¿è¡Œã€‚å½“ç„¶äº†ï¼Œè¿™åªæ˜¯ä¸ªå°é—®é¢˜ã€‚</p><h2 id="ç°åœ¨æˆ‘ä»¬å¦‚ä½•æ·»åŠ æµ‹è¯•"><a href="#ç°åœ¨æˆ‘ä»¬å¦‚ä½•æ·»åŠ æµ‹è¯•" class="headerlink" title="ç°åœ¨æˆ‘ä»¬å¦‚ä½•æ·»åŠ æµ‹è¯•"></a>ç°åœ¨æˆ‘ä»¬å¦‚ä½•æ·»åŠ æµ‹è¯•</h2><p>é‚£ CocoaPods 1.3 ä¹‹åæ˜¯æ€æ ·äº†å‘¢ï¼Ÿ</p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216225929.png" alt></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæºç å’Œæµ‹è¯•å·²ç»åœ¨ä¸€èµ·äº†ã€‚å¦‚æœæˆ‘ä»¬æƒ³çœ‹åˆ°å¯¹åº” pod ä¸­çš„æµ‹è¯•ï¼Œç°åœ¨å·²ç»ä¸éœ€è¦ä¸‹è½½å®ƒ Example æˆ–è€… Demo çš„ project æ¥çœ‹äº†ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥åœ¨å¯¹åº”çš„ pod æ–‡ä»¶å¤¹ä¸­çœ‹åˆ°ï¼Œååˆ†æ–¹ä¾¿ã€‚è€Œä¸”è¿™ä¸ª pod ä¸­çš„æµ‹è¯•å¯ä»¥é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„ target è¿è¡Œèµ·æ¥ï¼ˆå¦‚æœçœ‹ä¸åˆ°éœ€è¦åœ¨ <code>Manage Schemes</code> ä¸­æŠŠæµ‹è¯• target å‹¾é€‰ <code>show</code>ï¼‰ã€‚äºæ˜¯ä¸Šé¢ä¸¤ä¸ªé—®é¢˜éƒ½å¾—åˆ°äº†è§£å†³ã€‚</p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216225942.png" alt></p><h2 id="ä¸¾ä¸ªä¾‹å­"><a href="#ä¸¾ä¸ªä¾‹å­" class="headerlink" title="ä¸¾ä¸ªä¾‹å­"></a>ä¸¾ä¸ªä¾‹å­</h2><p>æˆ‘çš„ä¸€ä¸ª pod <a href="http://link.zhihu.com/?target=https%3A//github.com/X140Yu/pangu.Swift" target="_blank" rel="noopener">pangu.Swift</a> æ”¶åˆ°äº†ä¸€æ¡æ¥è‡ª <a href="http://www.zhihu.com/people/ce825ce5cb9e00b0c9046197f9edbcbd" target="_blank" rel="noopener">@Gao JiJi</a> çš„ issueï¼Œ</p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216225952.png" alt></p><p>ä½œä¸ºä¸€ä¸ªæœ‰è¿½æ±‚çš„ engineerï¼Œæ€ä¹ˆä¼šä¸å†™æµ‹è¯•å‘¢ï¼Ÿæˆ‘ä»¬å°±ä»¥è¿™ä¸ª repo ä¸ºä¾‹ï¼Œçœ‹çœ‹å¦‚ä½•ä¸ºè¿™ä¸ª pod æ·»åŠ æµ‹è¯•ã€‚</p><p>é¦–å…ˆä½ è¦ç¡®ä¿ Cocoapods çš„ç‰ˆæœ¬ &gt;= 1.3ï¼Œç‰ˆæœ¬ä¸å¤Ÿçš„åŒå­¦å¯ä»¥æ‰§è¡Œï¼Œ</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gem install cocoapods</span><br></pre></td></tr></table></figure><p>æ‰“å¼€å¯¹åº”çš„ podspecï¼Œæ·»åŠ ä¸‹é¢å‡ è¡Œï¼Œ</p><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">Pod::Spec.new <span class="keyword">do</span> <span class="params">|s|</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line">  s.test_spec <span class="string">'Tests'</span> <span class="keyword">do</span> <span class="params">|test_spec|</span></span><br><span class="line">    test_spec.source_files = <span class="string">'Tests/*.swift'</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>æ„æ€æ˜¯æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªå« <code>Tests</code> çš„ <code>test_spec</code>ï¼Œé‡Œé¢æµ‹è¯•æ–‡ä»¶çš„ä½ç½®åœ¨ <code>Tests/*.swift</code>ã€‚</p><p>å¦‚æœä½ çš„æµ‹è¯•éœ€è¦ä¾èµ–å…¶å®ƒ podsï¼Œå¯ä»¥åƒ sub_spec ä¸€æ ·ï¼Œæ·»åŠ  test_spec çš„ dependencyï¼Œå…·ä½“åšæ³• cocoapods ä¸­çš„é‚£ç¯‡æ–‡ç« ä¸­æœ‰å†™ã€‚</p><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥åœ¨ <code>Tests</code> ç›®å½•ä¸­æ·»åŠ æµ‹è¯•æ–‡ä»¶äº†ï¼Œæ·»åŠ å®Œæ¯•ååˆ«å¿˜è®°è‡ªå·±æµ‹è¯•ä¸€ä¸‹ï¼Œç„¶åå°±å¯ä»¥å‡çº§ä¸ªç‰ˆæœ¬ç„¶å push åˆ° spec repo ä¸­äº†ã€‚æ˜¯çš„ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ã€‚</p><p>å¯¹äºæ­¤ pod ä½¿ç”¨è€…ï¼Œå¦‚æœä½ ä¸æƒ³çœ‹åˆ°å®ƒçš„æµ‹è¯•ï¼Œé‚£ä»€ä¹ˆéƒ½ä¸ç”¨åšå°±å¥½äº†ã€‚ä½†æ˜¯å¦‚æœä½ æƒ³åœ¨å·¥ç¨‹é‡Œçœ‹åˆ°å¹¶è¿è¡Œå¯¹åº”çš„æµ‹è¯•ï¼Œå°±éœ€è¦ç»™ Podfile ä¸­çš„å¼•ç”¨æ·»åŠ ä¸€ä¸ªå‚æ•° <code>testspecs</code>ï¼Œ</p><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">target <span class="string">'Demo'</span> <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">  pod <span class="string">'Pangu-Swift'</span>, <span class="symbol">:testspecs</span> =&gt; [<span class="string">'Tests'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‚æ•°å¯¹åº”çš„æ˜¯å®ƒ podspec ä¸­çš„ â€˜Testsâ€™ã€‚</p><p>æ›´æ”¹ä¹‹åè®°å¾— <code>pod install</code>ï¼Œè¿™æ ·ï¼Œæ­¤ pod ä¸­çš„æµ‹è¯•æ–‡ä»¶å°±éƒ½è¢«å¼•å…¥äº†ï¼Œè€Œä¸”è¿˜å¤šä¸€ä¸ªæµ‹è¯•çš„ target ä»¥æ”¯æŒå•ç‹¬è¿è¡Œã€‚</p><h2 id="Something-else"><a href="#Something-else" class="headerlink" title="Something else"></a>Something else</h2><ul><li>testspec å’Œ subspec ä¸€æ ·ï¼Œéƒ½æ”¯æŒå¤šä¸ªã€‚å¦‚æœä½ çš„ pod æµ‹è¯•å¤ªå¤šï¼Œå¯ä»¥æŠŠå®ƒä»¬æ‹†åˆ°ä¸åŒçš„ testspec ä¸­</li><li>å†™æµ‹è¯•æ˜¯ä¸€ç§ç¾å¾·</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‰å‡ å¤© Cocoapods release äº† &lt;a href=&quot;http://link.zhihu.com/?target=http%3A//blog.cocoapods.org/CocoaPods-1.3.0/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;1.3.0&lt;/a&gt; ï¼Œä¸€ä¸ªæ¯”è¾ƒä»¤äººæ¿€åŠ¨çš„åŠŸèƒ½æ˜¯å¯ä»¥åœ¨ pod å†…éƒ¨æ·»åŠ æµ‹è¯•äº†ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="https://x140yu.github.io/tags/iOS/"/>
    
      <category term="Swift" scheme="https://x140yu.github.io/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>èŠèŠ Result è¿™ä¸ª Swift Âµframework</title>
    <link href="https://x140yu.github.io/2017-07-23-result/"/>
    <id>https://x140yu.github.io/2017-07-23-result/</id>
    <published>2017-07-23T14:51:33.000Z</published>
    <updated>2019-08-19T07:43:25.671Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº† <a href="https://github.com/antitypical/Result" target="_blank" rel="noopener">Result</a> è¿™ä¸ª Swift çš„ Âµframework è§£å†³çš„é—®é¢˜ä»¥åŠå…¶åŸºæœ¬çš„ä½¿ç”¨ã€‚</p></blockquote><a id="more"></a><p>å…ˆæ¥çœ‹ä¸€æ®µæˆ‘ä»¬æ›¾ç»å†™è¿‡æ— æ•°æ¬¡çš„ä»£ç ï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">login</span><span class="params">(userName: String, password: String, completionHandler: @escaping <span class="params">(token: String?, error: Error?)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">    <span class="comment">// network request ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¹ˆçœ‹å¯èƒ½çœ‹ä¸å‡ºä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘ä»¬æ¥è¯•ç€è°ƒç”¨ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•å§ï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">RequestHelper</span>.login(username: <span class="string">"123"</span>, password: <span class="string">"123"</span>) &#123; (token, error) <span class="keyword">in</span></span><br><span class="line">    <span class="comment">/// how to handle token &amp; error?</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>completionHandler</code> ä¸­çš„ token å’Œ error æ˜¯åŒ…åœ¨ä¸€ä¸ªæ‹¬å·é‡Œçš„ï¼ŒåŒ…åœ¨ä¸€ä¸ªæ‹¬å·é‡Œè¯´æ˜å®ƒä»¬æ„æˆä¸€ä¸ª tuppleï¼Œtupple ä»£è¡¨ <code>and</code> çš„æ„æ€ï¼Œè€Œä¸”è¿™ä¸¤ä¸ªå‚æ•°è¿˜éƒ½æ˜¯ optional çš„ï¼Œä¹Ÿå°±è¯´æ˜è¿™ä¸ª completion çš„å‚æ•°æœ‰ä»¥ä¸‹å››ç§æƒ…å†µï¼Œ</p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216230112.png" alt></p><p>å¯ä»¥çœ‹å‡ºï¼Œåªæœ‰ (1) å’Œ (4) çš„å‚æ•°ç»„åˆå¯¹äºè°ƒç”¨è€…æ˜¯æœ‰æ„ä¹‰çš„ã€‚ä½ å¯èƒ½ä¼šæå‡ºç–‘é—®ï¼Œ(2) å’Œ (3) çš„ç»„åˆåº”è¯¥ä¸ä¼šæœ‰äººå»åˆ¤æ–­å§ï¼Ÿçš„ç¡®ï¼Œä½†æ˜¯è¿™æ˜¯å› ä¸ºä½ çš„åˆ¤æ–­å»ºç«‹åœ¨å¤§å®¶æˆ–è€…å›¢é˜Ÿçš„ã€Œéšæ€§ã€çº¦å®šä¹‹ä¸Šï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™ä¸¤ç§æƒ…å½¢çš„ç»„åˆæ˜¯ä¸åº”å½“å­˜åœ¨ï¼Œæ‰€ä»¥æ‰ä¸å»åˆ¤æ–­ï¼Œè€Œä¸æ˜¯è®©ä»£ç æ˜ç¡®åœ°è¯´æ˜æ ¹æœ¬æ²¡æœ‰è¿™ä¸¤ç§ç»„åˆçš„æƒ…å†µã€‚</p><p>è¿™ä¸ª <code>completionHandler</code> å‚æ•°çš„è¯­æ„ä»£è¡¨çš„åº”å½“æ˜¯ <code>token | error</code> è€Œä¸æ˜¯ <code>token? &amp; error?</code> æ—¢ç„¶ tuple æ˜¯ä»£è¡¨ <code>&amp;</code>ï¼Œé‚£ä»€ä¹ˆä»€ä¹ˆä»£è¡¨ <code>|</code> å‘¢ï¼Ÿ</p><p>æ²¡é”™ï¼Œå°±æ˜¯ enumï¼</p><p><a href="https://github.com/antitypical/Result" target="_blank" rel="noopener">Result</a> è¿™ä¸ªç®€å•çš„ library å°±æ˜¯è§£å†³è¿™ç±»é—®é¢˜çš„ã€‚</p><h2 id="Result-è§£å†³äº†ä»€ä¹ˆé—®é¢˜"><a href="#Result-è§£å†³äº†ä»€ä¹ˆé—®é¢˜" class="headerlink" title="Result è§£å†³äº†ä»€ä¹ˆé—®é¢˜"></a>Result è§£å†³äº†ä»€ä¹ˆé—®é¢˜</h2><p>åœ¨ä½¿ç”¨äº† Result ä¹‹åï¼Œå‡½æ•°çš„å®šä¹‰åŠå®ç°å˜æˆäº†è¿™æ ·ï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">LoginError</span>: <span class="title">Error</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> noNetwork</span><br><span class="line">    <span class="keyword">case</span> wrongUsername</span><br><span class="line">    <span class="keyword">case</span> wrongPassword</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">login</span>(<span class="title">username</span>: <span class="title">String</span>, <span class="title">password</span>: <span class="title">String</span>, <span class="title">completion</span>: @<span class="title">escaping</span> (<span class="title">Result</span>&lt;<span class="title">String</span>, <span class="title">LoginError</span>&gt;) -&gt; <span class="title">Void</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// network request</span></span><br><span class="line">    completion(.success(<span class="string">"123jl123"</span>))</span><br><span class="line">    <span class="comment">// or</span></span><br><span class="line">    completion(.failure(.wrongPassword))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨è€…è§†è§’ï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">RequestHelper</span>.login(username: <span class="string">"123"</span>, password: <span class="string">"123"</span>) &#123; (result) <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">switch</span> result &#123;</span><br><span class="line">    <span class="keyword">case</span> .success(<span class="keyword">let</span> token):</span><br><span class="line">        <span class="comment">// do something with token</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">        <span class="keyword">switch</span> error &#123;</span><br><span class="line">        <span class="keyword">case</span> .noNetwork:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> .wrongUsername:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> .wrongPassword:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸è§‰å¾—ç”Ÿæ´»æ›´ç¾å¥½äº†å—ï¼Ÿè¿™å…¶ä¸­æ²¡æœ‰éšæ€§çš„çº¦å®šï¼Œæ²¡æœ‰å‡ºç°ç†è§£ä¸äº†çš„æƒ…å†µç»„åˆï¼Œåªéœ€è¦æŒ‰ç…§ swich é‡Œé¢çš„ case å¤„ç†å¯¹åº”çš„æƒ…å†µå°±å¥½äº†ã€‚</p><p>æ‰€ä»¥ Result è§£å†³äº†ä¸€ç±»é—®é¢˜ï¼Œå°±æ˜¯æŠŠ<em>å¯èƒ½æˆåŠŸ</em>æˆ–è€…<em>å¯èƒ½å¤±è´¥</em>çš„æƒ…å†µç»„åˆä» tuple å˜ä¸ºäº† enumã€‚</p><p>Swift çš„ç½‘ç»œè¯·æ±‚åº“ <a href="https://github.com/Moya/Moya/blob/master/Moya.podspec#L26" target="_blank" rel="noopener">Moya</a> ä¾èµ–äº†è¿™ä¸ªå°æ¡†æ¶ï¼Œå¦ä¸€ä¸ªè‘—åçš„ç½‘ç»œåº“ <a href="https://github.com/Alamofire/Alamofire/blob/master/Source/Result.swift" target="_blank" rel="noopener">Alamofire</a> ä¹Ÿæœ‰ç±»ä¼¼çš„è®¾è®¡ã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœåªæ˜¯ä¸ºäº†ä¸€ä¸ª enum çš„å®šä¹‰ï¼Œæˆ‘ä»¬æœ‰ä»€ä¹ˆç†ç”±ä¾èµ–ä¸€ä¸ª framework å‘¢ï¼Ÿ</p><h2 id="Result-ä¸­çš„é«˜é˜¶å‡½æ•°"><a href="#Result-ä¸­çš„é«˜é˜¶å‡½æ•°" class="headerlink" title="Result ä¸­çš„é«˜é˜¶å‡½æ•°"></a>Result ä¸­çš„é«˜é˜¶å‡½æ•°</h2><p>çœ‹æ–‡æ¡£ä¼šçŸ¥é“ Result ç±»å‹å®ç°äº† <code>map</code> å’Œ <code>flatMap</code> å‡½æ•°ï¼Œæ‰€ä»¥ Result æ˜¯ä¸ª Monadï¼ˆå¦‚æœä½ ä¸çŸ¥é“ä»€ä¹ˆæ˜¯ Monad æ²¡æœ‰å…³ç³»ï¼Œæˆ‘åªæ˜¯è·©äº†ä¸€ä¸ªåè¯ï¼Œåƒä¸‡ä¸è¦ä¸€è§åˆ° Monad å°±å®³æ€•äº†ï¼Œå…¶å®æ²¡æœ‰ä»€ä¹ˆå¤æ‚çš„ä¸œè¥¿ï¼‰ã€‚æˆ‘ä»¬ç®€å•åœ°çœ‹ä¸€ä¸‹ Result çš„ <code>map</code> å’Œ <code>flatMap</code> éƒ½åšäº†ä»€ä¹ˆï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// Returns a new Result by mapping `Success`esâ€™ values using `transform`, or re-wrapping `Failure`sâ€™ errors.</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">map</span>&lt;U&gt;<span class="params">(<span class="number">_</span> transform: <span class="params">(<span class="keyword">Self</span>.Value)</span></span></span> -&gt; <span class="type">U</span>) -&gt; <span class="type">Result</span>.<span class="type">Result</span>&lt;<span class="type">U</span>, <span class="type">Self</span>.<span class="type">Error</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Returns the result of applying `transform` to `Success`esâ€™ values, or re-wrapping `Failure`â€™s errors.</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">flatMap</span>&lt;U&gt;<span class="params">(<span class="number">_</span> transform: <span class="params">(<span class="keyword">Self</span>.Value)</span></span></span> -&gt; <span class="type">Result</span>.<span class="type">Result</span>&lt;<span class="type">U</span>, <span class="type">Self</span>.<span class="type">Error</span>&gt;) -&gt; <span class="type">Result</span>.<span class="type">Result</span>&lt;<span class="type">U</span>, <span class="type">Self</span>.<span class="type">Error</span>&gt;</span><br></pre></td></tr></table></figure><p>å‡å¦‚æˆ‘ä»¬çš„ç±»å‹æ˜¯è¿™æ ·çš„ï¼Œ<code>Result&lt;T, E&gt;</code>ï¼ˆT æ˜¯ value çš„ç±»å‹ï¼ŒE æ˜¯ Error çš„ç±»å‹ï¼‰ï¼Œè§‚å¯Ÿä¸Šé¢çš„å‡½æ•°ç­¾åï¼Œ</p><p>å¯¹å®ƒè°ƒç”¨ <code>map</code> æ–¹æ³•ï¼Œä¼šè¿”å›ä¸€ä¸ªæ–°çš„ <code>Result&lt;U, E&gt;</code>ï¼Œä¹Ÿå°±æ˜¯ Value ç±»å‹å‘ç”Ÿäº†æ”¹å˜ï¼Œè€Œ Error çš„ç±»å‹è¿˜è·ŸåŸæ¥ä¸€æ ·ã€‚</p><p>å¯¹å®ƒè°ƒç”¨ <code>flatMap</code> æ–¹æ³•ï¼Œä¼šè¿”å›ä¸€ä¸ªæ–°çš„ <code>Result&lt;U, F&gt;</code>ï¼Œvalue å’Œ error çš„ç±»å‹éƒ½å¯ä»¥è¢«æ”¹å˜ï¼Œ</p><p>é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥ç†è§£ä¸€ä¸‹ã€‚æ¯”å¦‚æœ‰è¿™æ ·ä¸€ä¸ª Resultï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> loginResult = <span class="type">Result</span>&lt;<span class="type">String</span>, <span class="type">LoginError</span>&gt;(<span class="string">"123"</span>)</span><br></pre></td></tr></table></figure><p>å¯¹å®ƒè°ƒç”¨ <code>map</code>ï¼Œ<code>transform</code> å‡½æ•°ç»™äº†ä½ ä¸€ä¸ªæ”¹å˜ value ç±»å‹çš„æœºä¼šï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">loginResult.<span class="built_in">map</span> &#123; token -&gt; <span class="type">U</span> <span class="keyword">in</span></span><br><span class="line">    <span class="comment">/// transform token to any type you like</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹å®ƒè°ƒç”¨ <code>flatMap</code>ï¼Œ<code>transform</code> å‡½æ•°ç»™äº†ä½ ä¸€ä¸ªè¿”å›ä¸€ä¸ªç±»å‹å®Œå…¨ä¸ä¸€æ ·çš„ <code>Result</code> çš„æœºä¼šï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">loginResult.flatMap &#123; token -&gt; <span class="type">Result</span>&lt;<span class="type">U</span>, <span class="type">E</span>&gt; <span class="keyword">in</span></span><br><span class="line">    <span class="comment">// trnasform token or error to any type you like</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆå¤š framwork ä¸­çš„ç±»å‹éƒ½å®ç°äº† <code>map</code> å’Œ <code>flatMap</code>ï¼Œæ¯”å¦‚ RxSwift ä¸­çš„ <code>Observable</code>ï¼ŒPromise ä¸­çš„ <code>Promise</code>ï¼ˆè™½ç„¶å‘½åå¯èƒ½æ˜¯ <code>then</code> ä½†è·Ÿ <code>flatMap</code> çš„ç­¾åæ˜¯ç±»ä¼¼çš„ï¼‰ã€‚</p><p>æœ‰äº†è¿™äº›æ–¹æ³•å°±å¯ä»¥å¯¹ Result è¿›è¡Œæ›´å¤šçš„å˜æ¢æ“ä½œï¼Œä»è€ŒæŠŠä¸€ä¸ªä¸çŸ¥é“ä»ä»€ä¹ˆåœ°æ–¹é£æ¥çš„ Result å˜æˆä¸€ä¸ªä½ çœŸæ­£éœ€è¦çš„ Resultã€‚</p><h2 id="Result-çš„ä»·å€¼"><a href="#Result-çš„ä»·å€¼" class="headerlink" title="Result çš„ä»·å€¼"></a>Result çš„ä»·å€¼</h2><p>å®ƒ repo ä¸­çš„ README æœ‰è¿™æ ·ä¸€å¥è¯ï¼Œ</p><blockquote><p>Using this Âµframework instead of rolling your own Result type allows you to easily interface with other frameworks that also use Result.</p></blockquote><p>å¯¹äºå¾ˆå¤š framework æ¥è¯´ï¼Œå®ƒä»¬éƒ½éœ€è¦åƒ Result ç±»ä¼¼çš„æ•°æ®ç»“æ„æ¥ä»£è¡¨å¯èƒ½æˆåŠŸå¯èƒ½å¤±è´¥çš„ç»“æœã€‚æ‰€ä»¥ Result çš„æ„¿æ™¯æ˜¯ï¼Œä¸å¸Œæœ›å¤§å®¶å†å®šä¹‰å±äºè‡ªå·±çš„ Result ç±»å‹ï¼Œè€Œæ˜¯ä½¿ç”¨æˆ‘ï¼Œè¿™æ ·åœ¨ Result ä¹‹é—´çš„è½¬æ¢ä¹Ÿæ¯”è¾ƒè½»æ¾ï¼Œè€Œä¸”è¿˜çœå»äº†å¾ˆå¤šç±»ä¼¼çš„å†—ä½™ä»£ç ã€‚</p><p>å¦‚æœä½ ä¾èµ–çš„ framwork å·²ç»ä¾èµ–äº† Resultï¼Œé‚£ä¹ˆåœ¨å†™ä¸‹ä¸€ä¸ªç±»ä¼¼ <code>login</code> çš„å‡½æ•°æ—¶ï¼Œè¯•è¯•è¿”å›ä¸€ä¸ª Resultï¼›æ²¡æœ‰ä¾èµ–ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œåœ¨å†™ä¸‹ä¸€ä¸ªè¿”å›å¯èƒ½æˆåŠŸå¯èƒ½å¤±è´¥çš„å¤šä¸ªå‚æ•°çš„å‡½æ•°æ—¶ï¼Œç”¨ <code>enum</code> ä»£æ›¿ <code>tuple</code> å§ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡ä¸»è¦ä»‹ç»äº† &lt;a href=&quot;https://github.com/antitypical/Result&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Result&lt;/a&gt; è¿™ä¸ª Swift çš„ Âµframework è§£å†³çš„é—®é¢˜ä»¥åŠå…¶åŸºæœ¬çš„ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="https://x140yu.github.io/tags/iOS/"/>
    
      <category term="Swift" scheme="https://x140yu.github.io/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•æ­£ç¡®ä¹¦å†™ iOS ä¸­çš„ Initializer</title>
    <link href="https://x140yu.github.io/2017-07-16-iOS-initializers/"/>
    <id>https://x140yu.github.io/2017-07-16-iOS-initializers/</id>
    <published>2017-07-16T08:46:33.000Z</published>
    <updated>2019-08-19T07:43:25.671Z</updated>
    
    <content type="html"><![CDATA[<p>å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå†™ Initializer åº”è¯¥æ˜¯æ—¥å¸¸ã€‚ä¼šå†™çš„å¯ä»¥ç›´æ¥ä¸çœ‹ã€‚å¦‚æœæ²¡æœ‰å¥½å¥½äº†è§£è¿‡å¦‚ä½•å†™ Initializerï¼Œæ¯æ¬¡éƒ½å‡­ç€æ„Ÿè§‰å†™è€Œä¸”è¿˜æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯´æ˜å…¶ä¸­çš„ã€Œç„æœºã€ä½ å·²ç»æŒæ¡äº†ï¼Œå¯ä»¥å¤§æ¦‚æ‰«ä¸€æ‰«ã€‚ä½†æ˜¯æ¯æ¬¡å†™ Initializer éƒ½è¦æŸ¥ Googleï¼Œé‚£è¿™ç¯‡æ–‡ç« å°±æ˜¯ç»™ä½ ï¼ˆæˆ‘ğŸŒšï¼‰å‡†å¤‡çš„</p><a id="more"></a><h2 id="Initializer-çš„ç§ç±»"><a href="#Initializer-çš„ç§ç±»" class="headerlink" title="Initializer çš„ç§ç±»"></a>Initializer çš„ç§ç±»</h2><p>ä¸€ä¸ªç±»ä¸­å¯èƒ½ä¼šæœ‰å¤šä¸ª Initializerï¼Œä½†ä¸ç®¡æœ‰å¤šå°‘ï¼Œéƒ½åªä¼šæ˜¯ä¸‹é¢ä¸¤ç§ç±»å‹ä¸­çš„ä¸€ç§ã€‚</p><h3 id="Designated-Initializer-æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•"><a href="#Designated-Initializer-æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•" class="headerlink" title="Designated Initializer (æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•)"></a>Designated Initializer (æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•)</h3><p>æ˜¯ç±»ä¸­çš„ä¸€ç­‰ Initializerï¼Œä¼šæŠŠç±»ä¸­æ‰€æœ‰ç›¸å…³çš„å±æ€§éƒ½åˆå§‹åŒ–ã€‚éœ€è¦è°ƒç”¨çˆ¶ç±»çš„ Designated Initializerã€‚</p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216225707.png" alt></p><h3 id="Convenience-Initializer-ä¾¿æ·åˆå§‹åŒ–æ–¹æ³•"><a href="#Convenience-Initializer-ä¾¿æ·åˆå§‹åŒ–æ–¹æ³•" class="headerlink" title="Convenience Initializer (ä¾¿æ·åˆå§‹åŒ–æ–¹æ³•)"></a>Convenience Initializer (ä¾¿æ·åˆå§‹åŒ–æ–¹æ³•)</h3><p>æ˜¯ç±»ä¸­çš„äºŒç­‰ Initializerï¼Œä¼šè°ƒç”¨ç±»ä¸­çš„ Designated Initializer æˆ– Convenience Initializerï¼ŒæŠŠå…¶å®ƒæ²¡æœ‰ä¼ è¿›æ¥çš„å±æ€§åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚ä¸»è¦æ˜¯ç»™è°ƒç”¨è€…ä»¥æ–¹ä¾¿ã€‚è¢«å…¶å®ƒ Convenience Initializer è°ƒç”¨çš„ Convenience Initializerï¼Œå¿…é¡»è°ƒç”¨åŒç±»ä¸­çš„ Designated Initializerã€‚</p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216225718.png" alt></p><p>é‚£ä¹ˆå¦‚ä½•åŒºåˆ†ç±»ä¸­çš„åˆå§‹åŒ–æ–¹æ³•æ˜¯ designated çš„è¿˜æ˜¯ convenience çš„å‘¢ï¼Ÿæœ‰å‡ ä¸ªæ–¹æ³•ï¼Œ</p><ul><li>é€šå¸¸æ¥è¯´ï¼ŒDesignated Initializer çš„å‚æ•°è¦æ¯” Convenience Initializer å¤šï¼Œå› ä¸ºæŒ‡å®šåˆå§‹åŒ–æ–¹æ³•å¸Œæœ›æŠŠè¿™ä¸ªç±»ä¸­çš„ç›¸å…³å±æ€§éƒ½åˆå§‹åŒ–æ‰ï¼Œè€Œä¾¿æ·åˆå§‹åŒ–æ–¹æ³•åªä¼šåˆå§‹åŒ–æ‰ä¸€éƒ¨åˆ†ï¼Œå…¶ä½™ä¸å¤ªè¦ç´§çš„å±æ€§åˆ™ä¼šæä¾›é»˜è®¤å€¼ã€‚</li><li>çœ‹è¿™ä¸ªæ–¹æ³•çš„å£°æ˜é‡Œæœ‰æ²¡æœ‰ä½¿ç”¨ <code>NS_DESIGNATED_INITIALIZER</code> æ ‡è®°ã€‚</li></ul><p>ç»“åˆä¸€ä¸ª <code>UIViewController</code> å­ç±»ï¼Œçœ‹çœ‹ Initializer åˆ°åº•è¯¥æ€ä¹ˆå†™ã€‚</p><h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><p>ä¸è€ƒè™‘ä½¿ç”¨ StoryBoard çš„æƒ…å†µ</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ProfileViewController</span> : <span class="title">UIViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *userID;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *gender; <span class="comment">// "0" or "1"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p>åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œ<code>userID</code> æ˜¯å¿…é¡»è¦è¢«åˆå§‹åŒ–çš„ï¼Œè€Œ <code>gender</code> åœ¨ä¸çŸ¥é“çš„æƒ…å†µä¸‹å¯ä»¥è¢«åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ï¼Œåç»­å¯ä»¥é€šè¿‡ç½‘ç»œè¯·æ±‚æ›´æ–°è¿™ä¸ªå€¼ã€‚é‚£ä¹ˆè¿™ä¸ªç±»çš„åˆå§‹åŒ–æ–¹æ³•å¤§æ¦‚åº”è¯¥é•¿æˆè¿™ä¸ªæ ·å­ï¼Œ</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">+ (<span class="keyword">instancetype</span>)new <span class="built_in">NS_UNAVAILABLE</span>; <span class="comment">// (1)</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)init <span class="built_in">NS_UNAVAILABLE</span>; <span class="comment">// (2)</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithCoder:(<span class="built_in">NSCoder</span> *)aDecoder <span class="built_in">NS_UNAVAILABLE</span>; <span class="comment">// (3)</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithNibName:(<span class="built_in">NSString</span> *)nibNameOrNil bundle:(<span class="built_in">NSBundle</span> *)nibBundleOrNil <span class="built_in">NS_UNAVAILABLE</span>; <span class="comment">// (4)</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithUserID:(<span class="built_in">NSString</span> *)userID gender:(<span class="built_in">NSUInteger</span>)gender <span class="built_in">NS_DESIGNATED_INITIALIZER</span>; <span class="comment">// (5)</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithUserID:(<span class="built_in">NSString</span> *)userID; <span class="comment">// (6)</span></span><br></pre></td></tr></table></figure><p>ä»ä¸Šå¾€ä¸‹çœ‹ï¼Œ(1) ~ (4) éƒ½æ˜¯ä»çˆ¶ç±»ä¸­ç»§æ‰¿æ¥çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œè™½ç„¶æˆ‘ä»¬çš„ç±»èƒ½å¤Ÿä½¿ç”¨è¿™äº›æ–¹æ³•åˆå§‹åŒ–ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸å¸Œæœ›è°ƒç”¨è€…ä½¿ç”¨è¿™äº›æ–¹æ³•ï¼Œå› ä¸ºè¿™ä¼šå¯¼è‡´ <code>userID</code> æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œé€»è¾‘å°±ä¼šä¸æ­£ç¡®äº†ï¼Œä½œä¸ºä¸€ä¸ªæœ‰èŠ‚æ“çš„ programmerï¼ŒæŠŠè¿™äº›æ–¹æ³•æ ‡è®°ä¸º <code>NS_UNAVAILABLE</code>ï¼Œå‘Šè¯‰è°ƒç”¨è€…ï¼Œä¸è¦ä½¿ç”¨è¿™äº›æ–¹æ³•åˆå§‹åŒ–ï¼ŒXcode ä¹Ÿä¼šæœ‰è°ƒç”¨è¿™äº›æ–¹æ³•çš„åœ°æ–¹æŠ›å‡ºé”™è¯¯ã€‚</p><p>(5) ä¼šåˆå§‹åŒ–æ‰æ‰€æœ‰ç›¸å…³çš„å±æ€§ï¼Œæ‰€ä»¥å®ƒæ˜¯ä½œä¸º Designated Initializer çš„å­˜åœ¨ï¼ŒåŒæ ·ä½œä¸ºä¸€ä¸ªæœ‰èŠ‚æ“çš„ programmerï¼Œæˆ‘ä»¬æŠŠå®ƒæ ‡è®°ä¸º <code>NS_DESIGNATED_INITIALIZER</code>ï¼Œè¿™ä¸ªæ ‡è®°ä¼šåšä»¥ä¸‹å‡ ä»¶äº‹æƒ…ï¼Œ</p><ul><li>åœ¨å®ç°è¿™ä¸ªæŒ‡å®šåˆå§‹åŒ–æ–¹æ³•æ—¶ï¼Œå¦‚æœæ²¡æœ‰è°ƒç”¨çˆ¶ç±»çš„ Designated Initializerï¼ŒXcode ä¼šæŠ›å‡ºè­¦å‘Šã€‚</li><li>Xcode ä¼šæŠŠå…¶å®ƒæ²¡æœ‰è¿™ä¸ªæ ‡è®°çš„åˆå§‹åŒ–æ–¹æ³•è‡ªåŠ¨è®¤ä¸ºæ˜¯ Convenience Initializerï¼ŒåŒ…æ‹¬ä»çˆ¶ç±»ç»§æ‰¿æ¥çš„ Designated Initializerï¼Œå¹¶åœ¨å®ç°çš„æ—¶å€™æ£€æŸ¥å‡½æ•°å†…æœ‰æ²¡æœ‰è°ƒç”¨åŒç±»ä¸­çš„å…¶å®ƒåˆå§‹åŒ–æ–¹æ³• (Convenience å’Œ Designated éƒ½å¯ä»¥)ã€‚</li></ul><p>æ‰€ä»¥è¿™ä¸ªæ ‡è®°æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå¦‚æœä½ åœ¨é€‚å½“çš„åˆå§‹åŒ–æ–¹æ³•å‰é¢åŠ äº†è¿™ä¸ªæ ‡è®°ï¼Œè€Œä¸”å®ç°ç±»ä¸­çš„æ‰€æœ‰åˆå§‹åŒ–æ–¹æ³•åè¿˜æ²¡æœ‰è­¦å‘Šï¼Œé‚£ä¹ˆå‡ºé”™å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚æ‰€ä»¥åœ¨å®ç°æ–°ç±»åˆå§‹åŒ–æ–¹æ³•çš„æ—¶å€™éƒ½åº”è¯¥æ·»åŠ è¿™ä¸ªæ ‡è®°ï¼Œè®©ç¼–è¯‘å™¨æé†’ä½ åˆ°åº•åº”è¯¥åšä»€ä¹ˆäº‹æƒ…ï¼Œå‡å°‘çŠ¯é”™è¯¯çš„å¯èƒ½ã€‚</p><p>(6) æ˜¯ä¸€ä¸ª Convenience Initializerã€‚</p><p>çœ‹åˆ°è¿™é‡Œï¼Œå®ç°ä¸Šé¢ç±»ä¸­çš„ä¸¤ä¸ªåˆå§‹åŒ–æ–¹æ³•åº”è¯¥å¾ˆå®¹æ˜“äº†å§ï¼Œ</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">instancetype</span>)initWithUserID:(<span class="built_in">NSString</span> *)userID &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> initWithUserID:userID gender:<span class="string">@"1"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithUserID:(<span class="built_in">NSString</span> *)userID gender:(<span class="built_in">NSString</span> *)gender &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithNibName:<span class="string">@""</span> bundle:<span class="literal">nil</span>]) &#123;</span><br><span class="line">        _userID = userID;</span><br><span class="line">        _gender = gender;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€å¥è¯æ€»ç»“ï¼Œå­ç±»çš„æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•å¿…é¡»è°ƒçˆ¶ç±»çš„æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ï¼›å­ç±»çš„ä¾¿æ·åˆå§‹åŒ–æ–¹æ³•å¿…é¡»è°ƒç”¨åŒç±»çš„å…¶å®ƒåˆå§‹åŒ–æ–¹æ³•ã€‚</p><h2 id="Swift"><a href="#Swift" class="headerlink" title="Swift"></a>Swift</h2><p>Swift è·Ÿ Objective-C ä¸å¤ªä¸€æ ·ï¼Œä¸ä¼šé»˜è®¤è¦æ±‚ä½ é‡å†™çˆ¶ç±»çš„æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ã€‚å¦‚æœè¦†å†™äº†çˆ¶ç±»ä¸­çš„æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ï¼Œä¸€å®šè¦åŠ ä¸Š <code>override</code> å…³é”®å­—ã€‚</p><p>åŠ äº† <code>convience</code> å…³é”®å­—çš„å°±æ˜¯ Convenience Initializerï¼Œè§„åˆ™ä¸ Objective-C çš„ç›¸åŒã€‚</p><p>å¯¹äºåˆå§‹åŒ–æ–¹æ³•å‰é¢æ²¡æœ‰ <code>convience</code> å…³é”®å­—çš„ï¼Œç¼–è¯‘å™¨éƒ½ä¼šæŠŠå®ƒå½“ä½œ Designated Initializerï¼Œè·Ÿ Objective-C åˆå§‹åŒ–æ–¹æ³•å‰é¢åŠ  <code>NS_DESIGNATED_INITIALIZER</code> æ˜¯ä¸€æ ·çš„ã€‚åœ¨å®ç°è¿™äº›æ–¹æ³•æ—¶ï¼Œå¯ä»¥å‚è€ƒä¸Šé¢çš„è§„åˆ™ã€‚</p><p>å¯¹äºå¯èƒ½å¤±è´¥çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œéœ€è¦æŠŠ <code>init</code> å…³é”®å­—æ¢æˆ <code>init?</code>ï¼Œè°ƒç”¨æ­¤ç±»åˆå§‹åŒ–æ–¹æ³•æ—¶ï¼Œè¿”å›å€¼ä¹Ÿä¼šä»ç¡®è®¤æœ‰å€¼ï¼Œå˜æˆä¸€ä¸ª optionalã€‚</p><p>æ‰€ä»¥ä¸€ä¸ª Swift çš„ UIViewController å­ç±»å¤§æ¦‚éœ€è¦è¿™æ ·å†™ï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProfileViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> userID: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> gender: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(userID: <span class="type">String</span>, gender: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.userID = userID</span><br><span class="line">        <span class="keyword">self</span>.gender = gender</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(nibName: <span class="literal">nil</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">"init(coder:) has not been implemented"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> æ„Ÿè°¢ <a href="https://twitter.com/kemchenj" target="_blank" rel="noopener">@å››å¨˜</a> <a href="https://twitter.com/kemchenj/status/941151493557596161" target="_blank" rel="noopener">æé†’</a>ï¼Œæ‰€ä»¥é‡å†™ <code>init(nibName, bundle)</code> å¹¶ä¸å¿…è¦</p><h2 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h2><p>Q: ä¸ºå•¥å†™ä¸ªåˆå§‹åŒ–æ–¹æ³•è¿˜æœ‰è¿™ä¹ˆå¤šè®²ç©¶ï¼Ÿ<br>A: ä¿è¯è°ƒç”¨åˆå§‹åŒ–æ–¹æ³•åï¼Œç”±è¿™ä¸ªç±»å¼•å…¥çš„ property éƒ½æ­£ç¡®åœ°è¢«åˆå§‹åŒ–ï¼Œä»è€Œç¡®ä¿é€»è¾‘æ­£ç¡®ã€‚</p><p>Q: Convenience Initializer åˆ°åº•æœ‰å•¥ç”¨ï¼Ÿ<br>A: å°±æ˜¯ç»™è°ƒç”¨è€…å›¾ä¸ªæ–¹ä¾¿å˜›ã€‚æ¯”å¦‚ Texture ä¸­çš„ ASDisplayNode å°±æä¾›äº† 4 ä¸ª Convenience Initializerï¼Œä¸éœ€è¦åˆå§‹åŒ–ä¹‹åå† <code>node.xxxBlock = ^() {};</code> ï¼Œè€Œæ˜¯æŠŠå¸¸ç”¨çš„ block property åœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±ç»™ä½ äº†ï¼Œå°±æ˜¯ä¸ºäº†æ–¹ä¾¿ã€‚</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">instancetype</span>)init <span class="built_in">NS_DESIGNATED_INITIALIZER</span>;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithViewBlock:(ASDisplayNodeViewBlock)viewBlock;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithViewBlock:(ASDisplayNodeViewBlock)viewBlock didLoadBlock:(<span class="keyword">nullable</span> ASDisplayNodeDidLoadBlock)didLoadBlock;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithLayerBlock:(ASDisplayNodeLayerBlock)layerBlock;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithLayerBlock:(ASDisplayNodeLayerBlock)layerBlock didLoadBlock:(<span class="keyword">nullable</span> ASDisplayNodeDidLoadBlock)didLoadBlock;</span><br></pre></td></tr></table></figure><p>Q: çˆ¶ç±»ä¸­çš„ Designated Initializer åœ¨å­ç±»ä¸­è¿˜æ˜¯ Designated Initializer å—ï¼Ÿ<br>A: çˆ¶ç±»ä¸­çš„ Designated Initializer åœ¨å­ç±»ä¸­ä¸ä¸€å®šå¿…é¡»æ˜¯ Designated Initializerã€‚å¦‚æœåœ¨å¤´æ–‡ä»¶ä¸­æ²¡å¯¹æ–¹æ³•è¿›è¡Œä»»ä½•æ ‡è®°ï¼Œé‚£ä¹ˆçˆ¶ç±»ä¸­çš„ Designated Initializer åœ¨å­ç±»ä¸­ä¾æ—§æ˜¯ Designated Initializerï¼Œå¦‚æœåœ¨å­ç±»æ²¡æœ‰è¦†å†™è¿™ä¸ªæ–¹æ³•ï¼Œç¼–è¯‘å™¨ä¼šç»™å‡ºè­¦å‘Šï¼›ä½†å¦‚æœåœ¨å­ç±»ä¸­å¯¹çˆ¶ç±»çš„ Designated Initializer æ ‡è®°ä¸º <code>NS_UNAVAILABLE</code>ï¼Œé‚£ä¹ˆçˆ¶ç±»ä¸­çš„è¿™ä¸ªæ–¹æ³•åœ¨å­ç±»ä¸­ä¸å†æ˜¯ Designated Initializerï¼Œå³ä½¿ä¸è¦†å†™ï¼Œç¼–è¯‘å™¨ä¹Ÿä¸ä¼šæœ‰ä»»ä½•è­¦å‘Šã€‚</p><p>Q: Objective-C ä¸­çš„åˆå§‹åŒ–æ–¹æ³•ä¸­ï¼Œå¼•ç”¨ propery çš„æ—¶å€™ï¼Œåˆ°åº•è¯¥ä½¿ç”¨ä¸‹åˆ’çº¿çš„æ–¹å¼è¿˜æ˜¯ <code>self.</code> çš„æ–¹å¼ï¼Ÿ<br>A: Prefer <code>_userID</code> to  <code>self.userID</code>ã€‚</p><p>Q: ä¸ºä½•åœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­ï¼Œ Swift ç±»çš„å˜é‡éœ€è¦åœ¨è°ƒç”¨çˆ¶ç±»çš„åˆå§‹åŒ–æ–¹æ³•ä¹‹å‰åˆå§‹åŒ–ï¼Ÿ<br>A:<br>æ ¹æ®æ–‡æ¡£ï¼Œ</p><blockquote><p>Class initialization in Swift is a two-phase process. In the first phase, each stored property is assigned an initial value by the class that introduced it. Once the initial state for every stored property has been determined, the second phase begins, and each class is given the opportunity to customize its stored properties further before the new instance is considered ready for use.</p></blockquote><p>æ ¹ Objective-C åˆå§‹åŒ–ä¸åŒçš„åœ°æ–¹åœ¨ç¬¬ä¸€æ­¥ï¼Œå°±æ˜¯æŠŠæ­¤ç±»åŠ å…¥çš„ property éƒ½åˆå§‹åŒ–æ‰ã€‚å› ä¸º Swift å¹¶ä¸ä¼šåƒ Objective-C ä¸€æ ·ï¼Œåœ¨æ²¡æœ‰æ˜¾å¼åˆå§‹åŒ–è¿™äº› property çš„æ—¶å€™ï¼Œè‡ªåŠ¨æŠŠå®ƒä»¬è®¾ä¸º <code>nil</code> æˆ– <code>0</code>ã€‚</p><p>ä¸¾ä¸ªä¾‹å­è§£é‡Šä¸‹ä¸Šé¢çš„æƒ…å†µã€‚æ–°æ‰‹å†™ Swift é€šå¸¸ä¼šé‡åˆ°è¿™æ ·çš„æƒ…å†µï¼Œ</p><p><img src="http://blog-1258178021.cosbj.myqcloud.com/blog/20181216225737.png" alt></p><p>ç¼–è¯‘å™¨æŠ±æ€¨ <code>userID</code> éœ€è¦åœ¨ <code>super.init</code> ä¹‹å‰è¢«åˆå§‹åŒ–ï¼Œå°±æ˜¯å› ä¸º <code>userID</code> æ²¡æœ‰é»˜è®¤å€¼ï¼Œå¦‚æœåœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜æ²¡ç»™å®ƒæä¾›å€¼ï¼Œé‚£å°±ä¼šäº§ç”Ÿé—®é¢˜äº†(ä»ç¼–è¯‘å™¨çš„è§’åº¦æ¥çœ‹ï¼Œåˆå§‹åŒ–çš„æ—¶å€™éœ€è¦ç¡®ä¿æ‰€æœ‰ property éƒ½ç¡®è®¤æœ‰å€¼(nil ä¹Ÿç®—ç¡®è®¤æœ‰å€¼)ã€‚ä½†ä½ ç°åœ¨å¹¶æ²¡æœ‰å‘Šè¯‰æˆ‘å®ƒçš„å€¼æ˜¯ä»€ä¹ˆã€‚ )å¯æ˜¯ç¼–è¯‘å™¨ä¸ºä½•æ²¡æœ‰æŠ±æ€¨ <code>gender</code> å’Œ <code>age</code> å‘¢ï¼Ÿå› ä¸ºå®ƒä»¬éƒ½æœ‰é»˜è®¤å€¼ï¼ˆoptional åœ¨é»˜è®¤çš„æƒ…å†µä¸‹ä¸º nilï¼‰ã€‚</p><p>Q: ä¸ºä»€ä¹ˆæ¯æ¬¡åˆ›å»º Swift UIViewController å­ç±»ï¼Œåªè¦æ·»åŠ äº†ä»»ä½•ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•ï¼ŒXcode éƒ½ä¼šæé†’è¦æ·»åŠ  <code>required init?(coder:)</code> æ–¹æ³•ï¼Ÿ<br>A: å› ä¸º UIViewController ç¬¦åˆäº† <code>NSCoding</code> åè®®ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯ Designated Initializerï¼Œå­ç±»å¿…é¡»è¦å®ç°è¿™ä¸ªåè®®çš„åˆå§‹åŒ–æ–¹æ³•ã€‚</p><p>Q: ä¸€ä¸ªç±»å¯èƒ½ä¼šæœ‰å¤šä¸ª Designated Initializer å—ï¼Ÿ<br>A: å¯èƒ½ã€‚æ¯”å¦‚ <code>NSArray</code> å°±æœ‰ä¸‰ä¸ªã€‚ä½†ä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯åªæœ‰ä¸€ä¸ªã€‚</p><p>ä¸Šé¢åªæ˜¯ä¸€äº›æˆ‘è‡ªå·±çš„å›°æƒ‘ï¼Œå¦‚æœä½ ä¹Ÿæœ‰å›°æƒ‘ï¼Œæ¬¢è¿ç•™è¨€ã€‚</p><p>è¿™ä¸‹åº”è¯¥å¯ä»¥å¼€å¼€å¿ƒå¿ƒåœ°å†™ Initializer äº†å§ :]</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå†™ Initializer åº”è¯¥æ˜¯æ—¥å¸¸ã€‚ä¼šå†™çš„å¯ä»¥ç›´æ¥ä¸çœ‹ã€‚å¦‚æœæ²¡æœ‰å¥½å¥½äº†è§£è¿‡å¦‚ä½•å†™ Initializerï¼Œæ¯æ¬¡éƒ½å‡­ç€æ„Ÿè§‰å†™è€Œä¸”è¿˜æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯´æ˜å…¶ä¸­çš„ã€Œç„æœºã€ä½ å·²ç»æŒæ¡äº†ï¼Œå¯ä»¥å¤§æ¦‚æ‰«ä¸€æ‰«ã€‚ä½†æ˜¯æ¯æ¬¡å†™ Initializer éƒ½è¦æŸ¥ Googleï¼Œé‚£è¿™ç¯‡æ–‡ç« å°±æ˜¯ç»™ä½ ï¼ˆæˆ‘ğŸŒšï¼‰å‡†å¤‡çš„&lt;/p&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="https://x140yu.github.io/tags/iOS/"/>
    
      <category term="Objective-C" scheme="https://x140yu.github.io/tags/Objective-C/"/>
    
      <category term="Swift" scheme="https://x140yu.github.io/tags/Swift/"/>
    
  </entry>
  
</feed>
